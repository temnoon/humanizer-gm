/**
 * Humanizer Web App Styles
 *
 * App-specific styles that extend the @humanizer/ui design system.
 * All values MUST use tokens from tokens.css.
 */

/* Import @humanizer/ui design system */
@import '../../../packages/ui/styles/tokens.css';
@import '../../../packages/ui/styles/reset.css';

/* Import @humanizer/ui component styles */
@import '../../../packages/ui/styles/components/sentence.css';
@import '../../../packages/ui/styles/components/selection.css';
@import '../../../packages/ui/styles/components/containers.css';
@import '../../../packages/ui/styles/components/media.css';
@import '../../../packages/ui/styles/components/book-editor.css';

/* ═══════════════════════════════════════════════════════════════════
   APP LAYOUT
   ═══════════════════════════════════════════════════════════════════ */

.app-container {
  min-height: 100vh;
  display: flex;
  flex-direction: column;
  background: var(--color-surface-primary);
}

.app-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: var(--space-medium) var(--space-large);
  background: var(--color-surface-secondary);
  border-bottom: var(--border-width-thin) solid var(--color-border-subtle);
}

.app-header__logo {
  font-size: var(--text-size-large);
  font-weight: var(--font-weight-bold);
  color: var(--color-text-primary);
  text-decoration: none;
}

.app-header__logo:hover {
  color: var(--color-primary);
}

.app-main {
  flex: 1;
  display: flex;
  flex-direction: column;
}

/* ═══════════════════════════════════════════════════════════════════
   LANDING PAGE
   ═══════════════════════════════════════════════════════════════════ */

.landing {
  flex: 1;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: var(--space-xlarge);
  text-align: center;
}

.landing__title {
  font-size: var(--text-size-display);
  font-weight: var(--font-weight-bold);
  color: var(--color-text-primary);
  margin-bottom: var(--space-medium);
  letter-spacing: var(--letter-spacing-tight);
}

.landing__subtitle {
  font-size: var(--text-size-large);
  color: var(--color-text-secondary);
  max-width: var(--width-content-narrow);
  line-height: var(--line-height-relaxed);
  margin-bottom: var(--space-xlarge);
}

.landing__quote {
  font-family: var(--font-family-reading);
  font-size: var(--text-size-body);
  font-style: italic;
  color: var(--color-text-tertiary);
  max-width: var(--width-content-medium);
  line-height: var(--line-height-reading);
  margin-top: var(--space-huge);
  padding: var(--space-large);
  border-left: var(--border-width-thick) solid var(--color-primary);
  text-align: left;
}

/* ═══════════════════════════════════════════════════════════════════
   BUTTONS
   ═══════════════════════════════════════════════════════════════════ */

.button {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: var(--space-small);
  padding: var(--space-small) var(--space-large);
  min-height: var(--touch-target);
  font-size: var(--text-size-body);
  font-weight: var(--font-weight-medium);
  border-radius: var(--radius-medium);
  cursor: pointer;
  transition: all var(--duration-fast) var(--ease-out);
  text-decoration: none;
}

.button:focus-visible {
  box-shadow: var(--shadow-focus);
  outline: none;
}

.button--primary {
  background: var(--color-primary);
  color: var(--color-text-inverse);
  border: none;
}

.button--primary:hover {
  background: var(--color-primary-hover);
}

.button--secondary {
  background: transparent;
  color: var(--color-primary);
  border: var(--border-width-thin) solid var(--color-primary);
}

.button--secondary:hover {
  background: var(--color-primary-subtle);
}

/* ═══════════════════════════════════════════════════════════════════
   SIC COMPONENTS
   ═══════════════════════════════════════════════════════════════════ */

.sic-badge {
  display: inline-flex;
  align-items: center;
  padding: var(--space-tiny) var(--space-small);
  border-radius: var(--radius-full);
  font-size: var(--text-size-small);
  font-weight: var(--font-weight-semibold);
}

.sic-badge--high {
  background: var(--color-sic-high-subtle);
  color: var(--color-sic-high);
}

.sic-badge--medium {
  background: var(--color-sic-medium-subtle);
  color: var(--color-sic-medium);
}

.sic-badge--low {
  background: var(--color-sic-low-subtle);
  color: var(--color-sic-low);
}

/* ═══════════════════════════════════════════════════════════════════
   CARDS
   ═══════════════════════════════════════════════════════════════════ */

.card {
  background: var(--color-surface-secondary);
  border: var(--border-width-thin) solid var(--color-border-subtle);
  border-radius: var(--radius-large);
  padding: var(--space-medium);
  box-shadow: var(--shadow-small);
}

.card__title {
  font-size: var(--text-size-large);
  font-weight: var(--font-weight-semibold);
  color: var(--color-text-primary);
  margin-bottom: var(--space-small);
}

.card__content {
  color: var(--color-text-secondary);
  line-height: var(--line-height-relaxed);
}

/* ═══════════════════════════════════════════════════════════════════
   RESPONSIVE
   ═══════════════════════════════════════════════════════════════════ */

/* ═══════════════════════════════════════════════════════════════════
   ANALYZE SECTION
   ═══════════════════════════════════════════════════════════════════ */

.analyze-section {
  width: 100%;
  max-width: var(--width-content-medium);
  display: flex;
  flex-direction: column;
  gap: var(--space-medium);
}

.analyze-input {
  width: 100%;
  min-height: 150px;
  padding: var(--space-medium);
  font-family: var(--font-family-body);
  font-size: var(--text-size-body);
  line-height: var(--line-height-relaxed);
  color: var(--color-text-primary);
  background: var(--color-surface-secondary);
  border: var(--border-width-thin) solid var(--color-border-default);
  border-radius: var(--radius-medium);
  resize: vertical;
  transition: border-color var(--duration-fast) var(--ease-out);
}

.analyze-input:focus {
  outline: none;
  border-color: var(--color-border-focus);
  box-shadow: var(--shadow-focus);
}

.analyze-input::placeholder {
  color: var(--color-text-tertiary);
}

/* ═══════════════════════════════════════════════════════════════════
   RESULT SECTION
   ═══════════════════════════════════════════════════════════════════ */

.result-container {
  max-width: var(--width-content-medium);
  margin: 0 auto;
  padding: var(--space-xlarge);
}

.result-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: var(--space-xlarge);
}

.result-header h2 {
  font-size: var(--text-size-heading-2);
  font-weight: var(--font-weight-bold);
  color: var(--color-text-primary);
}

.result-score {
  display: flex;
  align-items: center;
  gap: var(--space-large);
  padding: var(--space-large);
  background: var(--color-surface-secondary);
  border-radius: var(--radius-large);
  margin-bottom: var(--space-large);
}

.score-display {
  display: flex;
  align-items: baseline;
  gap: var(--space-small);
}

.score-value {
  font-size: var(--text-size-display);
  font-weight: var(--font-weight-bold);
  color: var(--color-text-primary);
}

.score-label {
  font-size: var(--text-size-body);
  color: var(--color-text-secondary);
}

.result-interpretation {
  padding: var(--space-large);
  background: var(--color-surface-secondary);
  border-radius: var(--radius-large);
  margin-bottom: var(--space-large);
}

.result-interpretation h3 {
  font-size: var(--text-size-large);
  font-weight: var(--font-weight-semibold);
  color: var(--color-text-primary);
  margin-bottom: var(--space-small);
}

.result-interpretation p {
  color: var(--color-text-secondary);
  line-height: var(--line-height-relaxed);
}

.result-signals h3 {
  font-size: var(--text-size-large);
  font-weight: var(--font-weight-semibold);
  color: var(--color-text-primary);
  margin-bottom: var(--space-medium);
}

.signals-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
  gap: var(--space-medium);
}

.signal-group {
  padding: var(--space-medium);
  background: var(--color-surface-secondary);
  border-radius: var(--radius-large);
}

.signal-group h4 {
  font-size: var(--text-size-body);
  font-weight: var(--font-weight-semibold);
  margin-bottom: var(--space-small);
}

.signal-list {
  display: flex;
  flex-direction: column;
  gap: var(--space-tiny);
}

.signal-item {
  display: flex;
  align-items: center;
  gap: var(--space-small);
  font-size: var(--text-size-small);
}

.signal-name {
  flex: 1;
  color: var(--color-text-secondary);
}

.signal-score {
  font-weight: var(--font-weight-medium);
  color: var(--color-text-primary);
}

.signal-count {
  color: var(--color-text-tertiary);
}

/* ═══════════════════════════════════════════════════════════════════
   RESPONSIVE
   ═══════════════════════════════════════════════════════════════════ */

@media (max-width: 767px) {
  .landing {
    padding: var(--space-large);
  }

  .landing__title {
    font-size: var(--text-size-heading-1);
  }

  .landing__subtitle {
    font-size: var(--text-size-body);
  }
}

/* ═══════════════════════════════════════════════════════════════════
   BOOK READER
   Beautiful, readable book typography inspired by print design
   ═══════════════════════════════════════════════════════════════════ */

.book-reader {
  min-height: 100vh;
  display: flex;
  flex-direction: column;
  transition: background-color 0.3s ease, color 0.3s ease;
}

/* Theme: Sepia (default) */
.book-reader--sepia {
  --book-bg: #f8f4e9;
  --book-text: #433422;
  --book-text-secondary: #6b5c4a;
  --book-accent: #8b6914;
  --book-quote-bg: #f0e8d6;
  --book-quote-border: #c9a227;
  --book-hr: #d4c4a8;
  --book-control-bg: rgba(248, 244, 233, 0.95);
}

/* Theme: Light */
.book-reader--light {
  --book-bg: #ffffff;
  --book-text: #1a1a1a;
  --book-text-secondary: #555555;
  --book-accent: #0066cc;
  --book-quote-bg: #f5f5f5;
  --book-quote-border: #cccccc;
  --book-hr: #e0e0e0;
  --book-control-bg: rgba(255, 255, 255, 0.95);
}

/* Theme: Dark */
.book-reader--dark {
  --book-bg: #1a1a1a;
  --book-text: #e0e0e0;
  --book-text-secondary: #a0a0a0;
  --book-accent: #7db8ff;
  --book-quote-bg: #252525;
  --book-quote-border: #404040;
  --book-hr: #333333;
  --book-control-bg: rgba(26, 26, 26, 0.95);
}

.book-reader {
  background-color: var(--book-bg);
  color: var(--book-text);
}

/* Controls bar */
.book-reader__controls {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  z-index: 100;
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 0.75rem 1.5rem;
  background: var(--book-control-bg);
  backdrop-filter: blur(10px);
  border-bottom: 1px solid var(--book-hr);
  transition: opacity 0.3s ease, transform 0.3s ease;
}

.book-reader__controls--hidden {
  opacity: 0;
  transform: translateY(-100%);
  pointer-events: none;
}

.book-reader__controls-left,
.book-reader__controls-right {
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

.book-reader__controls-center {
  flex: 1;
  text-align: center;
}

.book-reader__title {
  font-family: Georgia, 'Times New Roman', serif;
  font-size: 0.875rem;
  font-style: italic;
  color: var(--book-text-secondary);
}

.book-reader__btn {
  padding: 0.5rem 0.75rem;
  font-size: 0.875rem;
  font-family: inherit;
  color: var(--book-text);
  background: transparent;
  border: 1px solid var(--book-hr);
  border-radius: 4px;
  cursor: pointer;
  transition: background 0.2s ease;
}

.book-reader__btn:hover {
  background: var(--book-quote-bg);
}

.book-reader__select {
  padding: 0.5rem 0.75rem;
  font-size: 0.875rem;
  font-family: inherit;
  color: var(--book-text);
  background: transparent;
  border: 1px solid var(--book-hr);
  border-radius: 4px;
  cursor: pointer;
}

/* Book content area */
.book-reader__content {
  flex: 1;
  padding: 6rem 1.5rem 4rem;
  overflow-y: auto;
}

.book-reader__article {
  max-width: 38rem;
  margin: 0 auto;
  font-family: Georgia, 'Times New Roman', serif;
  line-height: 1.7;
}

/* Typography */
.book-reader__article h1 {
  font-size: 2.25em;
  font-weight: normal;
  text-align: center;
  margin: 0 0 0.5em;
  letter-spacing: -0.02em;
}

.book-reader__article h2 {
  font-size: 1.5em;
  font-weight: normal;
  margin: 2.5em 0 1em;
  padding-top: 1em;
  border-top: 1px solid var(--book-hr);
}

.book-reader__article h3 {
  font-size: 1.25em;
  font-weight: normal;
  font-style: italic;
  margin: 2em 0 0.75em;
}

.book-reader__article p {
  margin: 0 0 1.2em;
  text-align: justify;
  hyphens: auto;
}

/* First paragraph after heading - drop cap */
.book-reader__article h2 + p::first-letter,
.book-reader__article h3 + p::first-letter {
  float: left;
  font-size: 3.5em;
  line-height: 0.8;
  padding-right: 0.1em;
  margin-top: 0.05em;
  color: var(--book-accent);
}

/* Emphasis */
.book-reader__article em {
  font-style: italic;
}

.book-reader__article strong {
  font-weight: 600;
  color: var(--book-text);
}

/* Blockquotes - notebook fragments */
.book-reader__article blockquote {
  margin: 1.5em 0;
  padding: 1.25em 1.5em;
  background: var(--book-quote-bg);
  border-left: 3px solid var(--book-quote-border);
  font-style: italic;
  color: var(--book-text-secondary);
}

.book-reader__article blockquote p {
  text-align: left;
  margin-bottom: 0.75em;
}

.book-reader__article blockquote p:last-child {
  margin-bottom: 0;
}

/* Horizontal rules - section breaks */
.book-reader__article hr {
  border: none;
  text-align: center;
  margin: 2.5em 0;
}

.book-reader__article hr::before {
  content: '* * *';
  color: var(--book-text-secondary);
  letter-spacing: 1em;
}

/* Lists */
.book-reader__article ul,
.book-reader__article ol {
  margin: 1em 0;
  padding-left: 1.5em;
}

.book-reader__article li {
  margin-bottom: 0.5em;
}

/* Code blocks (for appendix) */
.book-reader__article code {
  font-family: 'Menlo', 'Monaco', monospace;
  font-size: 0.85em;
  background: var(--book-quote-bg);
  padding: 0.15em 0.3em;
  border-radius: 3px;
}

/* Opening poem - centered */
.book-reader__article h1 + p > em:only-child {
  display: block;
  text-align: center;
  font-size: 1.1em;
  margin-bottom: 2em;
}

/* Responsive */
@media (max-width: 767px) {
  .book-reader__content {
    padding: 5rem 1rem 3rem;
  }

  .book-reader__article {
    line-height: 1.6;
  }

  .book-reader__article h1 {
    font-size: 1.75em;
  }

  .book-reader__article h2 {
    font-size: 1.25em;
  }

  .book-reader__article h2 + p::first-letter,
  .book-reader__article h3 + p::first-letter {
    font-size: 2.5em;
  }
}

/* Print styles */
@media print {
  .book-reader__controls {
    display: none;
  }

  .book-reader__content {
    padding: 0;
  }

  .book-reader__article {
    max-width: none;
  }
}

/* ═══════════════════════════════════════════════════════════════════
   STUDIO - Sepia workspace with hover panels
   ═══════════════════════════════════════════════════════════════════ */

.studio {
  --studio-bg: #f8f4e9;
  --studio-text: #433422;
  --studio-text-secondary: #6b5c4a;
  --studio-accent: #8b6914;
  --studio-quote-bg: #f0e8d6;
  --studio-border: #d4c4a8;
  --studio-panel-bg: #fffdf8;
  --studio-hover: rgba(139, 105, 20, 0.1);

  min-height: 100vh;
  background: var(--studio-bg);
  color: var(--studio-text);
  font-family: Georgia, 'Times New Roman', serif;
  position: relative;
  overflow: hidden;
}

/* ═══════════════════════════════════════════════════════════════════
   TOP BAR
   ═══════════════════════════════════════════════════════════════════ */

.studio-topbar {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  z-index: 100;
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 0.75rem 1.5rem;
  background: rgba(var(--studio-panel-bg-rgb, 248, 244, 233), 0.95);
  backdrop-filter: blur(10px);
  border-bottom: 1px solid var(--studio-border);
  transition: opacity 0.3s ease, transform 0.3s ease, background 0.3s ease;
}

.studio-topbar--hidden {
  opacity: 0;
  transform: translateY(-100%);
  pointer-events: none;
}

.studio-topbar__left {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  justify-content: flex-start;
  flex-shrink: 0;
}

.studio-topbar__right {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  justify-content: flex-end;
  flex-shrink: 0;
}

/* Center section: absolutely positioned for TRUE viewport centering */
.studio-topbar__center {
  position: absolute;
  left: 50%;
  top: 50%;
  transform: translate(-50%, -50%);
  display: flex;
  align-items: center;
  gap: 0.5rem;
  z-index: 1;
}

/* Nav variant - inherits absolute centering */
.studio-topbar__center--nav {
  /* Inherits from .studio-topbar__center */
}

/* Title wrapper - centered by parent, no special positioning needed */
.studio-topbar__title-wrapper {
  display: flex;
  align-items: center;
  justify-content: center;
  flex-shrink: 0;
}

/* Navigation buttons group */
.studio-topbar__nav-group {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  flex-shrink: 0;
}

/* Breadcrumb container */
.studio-topbar__breadcrumb {
  display: flex;
  align-items: center;
  gap: 0.25rem;
  min-width: 0;
  overflow: hidden;
  font-family: -apple-system, BlinkMacSystemFont, sans-serif;
  font-size: 0.875rem;
}

.studio-topbar__breadcrumb-item {
  display: flex;
  align-items: center;
  gap: 0.25rem;
  min-width: 0;
}

.studio-topbar__breadcrumb-sep {
  color: var(--studio-text-tertiary, #999);
  flex-shrink: 0;
}

.studio-topbar__breadcrumb-link {
  background: none;
  border: none;
  padding: 0.25rem 0.5rem;
  font-size: inherit;
  font-family: inherit;
  color: var(--studio-text-secondary);
  cursor: pointer;
  border-radius: 4px;
  transition: color 0.15s ease, background 0.15s ease;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  max-width: 200px;
}

.studio-topbar__breadcrumb-link:hover {
  color: var(--studio-text);
  background: var(--studio-hover);
}

.studio-topbar__title {
  font-size: 0.9375rem;
  font-weight: 500;
  color: var(--studio-text);
  letter-spacing: 0.02em;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

/* Legacy logo style - kept for compatibility */
.studio-topbar__logo {
  font-size: 1.125rem;
  font-weight: normal;
  letter-spacing: 0.05em;
  color: var(--studio-text);
}

.studio-topbar__btn {
  min-height: var(--touch-target-min, 44px);
  padding: 0.5rem 0.875rem;
  font-family: -apple-system, BlinkMacSystemFont, sans-serif;
  font-size: 0.8125rem;
  color: var(--studio-text-secondary);
  background: transparent;
  border: 1px solid var(--studio-border);
  border-radius: var(--radius-md, 6px);
  cursor: pointer;
  transition: all 0.2s ease;
}

.studio-topbar__btn:hover {
  background: var(--studio-hover);
  color: var(--studio-text);
}

.studio-topbar__nav {
  min-width: var(--touch-target-min, 44px);
  min-height: var(--touch-target-min, 44px);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1rem;
  color: var(--studio-text-secondary);
  background: transparent;
  border: 1px solid var(--studio-border);
  border-radius: var(--radius-md, 6px);
  cursor: pointer;
  transition: all 0.2s ease;
}

.studio-topbar__nav:hover:not(:disabled) {
  background: var(--studio-hover);
  color: var(--studio-text);
}

.studio-topbar__nav:disabled {
  opacity: 0.3;
  cursor: not-allowed;
}

/* ═══════════════════════════════════════════════════════════════════
   MAIN WORKSPACE
   ═══════════════════════════════════════════════════════════════════ */

.studio__main {
  min-height: 100vh;
  padding: 5rem 1.5rem 3rem;
}

/* Remove padding when showing full-screen views like graph or media */
.studio__main:has(.workspace--graph),
.studio__main:has(.workspace--media) {
  padding: 3.5rem 0 0;
}

/* ═══════════════════════════════════════════════════════════════════
   WORKSPACE - Main content area with width-responsive layout
   Responds to [data-editor-width] attribute on document root
   ═══════════════════════════════════════════════════════════════════ */

.workspace {
  /* Width controlled by editor width setting */
  --workspace-width-narrow: min(50rem, 95vw);  /* ~800px for comfortable reading */
  --workspace-width-medium: min(64rem, 95vw);
  --workspace-width-wide: 100%;

  /* Default to narrow for reading mode - centered on viewport */
  width: 100%;
  max-width: var(--workspace-width-narrow);
  margin-left: auto;
  margin-right: auto;
  min-height: calc(100vh - var(--space-3xl, 4rem) * 2);
  padding: 0 var(--space-medium);
  transition: max-width var(--duration-normal) var(--ease-out);
  text-align: left; /* Keep text left-aligned within centered container */
}

/* Width variations based on theme setting */
[data-editor-width="narrow"] .workspace {
  max-width: var(--workspace-width-narrow);
}

[data-editor-width="medium"] .workspace {
  max-width: var(--workspace-width-medium);
}

[data-editor-width="wide"] .workspace {
  max-width: var(--workspace-width-wide);
  padding: 0 var(--space-large);
}

/* Edit mode: always use wider layout for split view */
.workspace:has(.workspace__split-view) {
  max-width: var(--workspace-width-wide);
  padding: 0 var(--space-medium);
}

/* Width-specific split view behavior */
[data-editor-width="narrow"] .workspace:has(.workspace__split-view) {
  max-width: min(64rem, 98vw);
}

[data-editor-width="medium"] .workspace:has(.workspace__split-view) {
  max-width: min(80rem, 98vw);
}

[data-editor-width="wide"] .workspace:has(.workspace__split-view) {
  max-width: 100%;
}

.workspace--empty {
  display: flex;
  align-items: center;
  justify-content: center;
}

.workspace__placeholder {
  text-align: center;
  color: var(--color-text-secondary, var(--studio-text-secondary));
}

.workspace__placeholder h1 {
  font-size: var(--text-size-heading-1, 2.5rem);
  font-weight: var(--font-weight-normal, normal);
  letter-spacing: 0.1em;
  margin-bottom: var(--space-small);
}

.workspace__tagline {
  font-style: italic;
  font-size: var(--text-size-large, 1.125rem);
  margin-bottom: var(--space-xl);
}

.workspace__divider {
  color: var(--color-text-secondary);
  letter-spacing: 0.5em;
  margin: var(--space-xlarge, 32px) 0;
}

/* When divider is an hr element (semantic) */
hr.workspace__divider {
  border: none;
  height: 1px;
  background: var(--color-border-subtle);
  width: 60px;
  margin: var(--space-xlarge, 32px) auto;
}

/* ═══════════════════════════════════════════════════════════════════
   WELCOME SCREEN - Drag & Drop File Indexing
   Uses tokens from packages/ui/styles/tokens.css
   ═══════════════════════════════════════════════════════════════════ */

.welcome-screen {
  position: relative;
  transition: background-color var(--duration-fast, 150ms);
}

.welcome-screen--drag-active {
  background: linear-gradient(
    135deg,
    hsla(var(--hue-primary, 220), var(--sat-primary, 60%), 45%, 0.05) 0%,
    hsla(var(--hue-primary, 220), var(--sat-primary, 60%), 45%, 0.1) 100%
  );
}

.welcome-screen__drop-hint {
  margin-top: var(--space-xlarge, 32px);
}

.welcome-screen__instruction {
  font-size: var(--text-size-large, 1.125rem);
  color: var(--color-text-secondary);
  margin-bottom: var(--space-medium, 16px);
}

.welcome-screen__alt {
  font-size: var(--text-size-body, 1rem);
  color: var(--color-text-tertiary);
}

.welcome-screen__picker-btn {
  background: none;
  border: none;
  color: var(--color-primary);
  text-decoration: underline;
  cursor: pointer;
  font-size: inherit;
  font-family: inherit;
  padding: 0;
  min-height: var(--touch-target, 44px);
  transition: color var(--duration-fast, 150ms);
}

.welcome-screen__picker-btn:hover,
.welcome-screen__picker-btn:focus-visible {
  color: var(--color-primary-hover);
}

.welcome-screen__picker-btn:focus-visible {
  outline: 2px solid var(--color-primary);
  outline-offset: 2px;
  border-radius: var(--radius-small, 4px);
}

.welcome-screen__nav-hint {
  margin-top: var(--space-huge, 48px);
  font-size: var(--text-size-small, 0.875rem);
  color: var(--color-text-tertiary);
  opacity: 0.7;
}

/* Progress indicator */
.welcome-screen__progress {
  margin-top: var(--space-xlarge, 32px);
  width: 100%;
  max-width: 400px;
}

.welcome-screen__progress-status {
  font-size: var(--text-size-body, 1rem);
  color: var(--color-text-primary);
  margin-bottom: var(--space-medium, 16px);
}

.welcome-screen__progress-bar {
  width: 100%;
  height: 4px;
  background: var(--color-surface-tertiary);
  border-radius: var(--radius-full, 9999px);
  overflow: hidden;
}

.welcome-screen__progress-fill {
  height: 100%;
  background: var(--color-primary);
  border-radius: var(--radius-full, 9999px);
  transition: width var(--duration-fast, 150ms);
}

.welcome-screen__progress-details {
  display: flex;
  justify-content: space-between;
  margin-top: var(--space-small, 8px);
  font-size: var(--text-size-small, 0.875rem);
  color: var(--color-text-tertiary);
}

.welcome-screen__current-file {
  max-width: 60%;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

/* Complete state */
.welcome-screen__complete {
  display: flex;
  align-items: center;
  gap: var(--space-small, 8px);
  margin-top: var(--space-xlarge, 32px);
  font-size: var(--text-size-large, 1.125rem);
  color: var(--color-status-success);
}

.welcome-screen__check {
  font-size: 1.5rem;
}

/* Error state */
.welcome-screen__error {
  display: flex;
  align-items: center;
  gap: var(--space-small, 8px);
  margin-top: var(--space-xlarge, 32px);
  font-size: var(--text-size-body, 1rem);
  color: var(--color-status-error);
}

.welcome-screen__error-icon {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 24px;
  height: 24px;
  background: var(--color-status-error);
  color: var(--color-text-inverse);
  border-radius: var(--radius-full, 9999px);
  font-weight: bold;
}

/* Drag overlay */
.welcome-screen__drag-overlay {
  position: absolute;
  inset: var(--space-medium, 16px);
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: var(--space-medium, 16px);
  background: hsla(var(--hue-primary, 220), var(--sat-primary, 60%), 45%, 0.1);
  border: 2px dashed var(--color-primary);
  border-radius: var(--radius-large, 12px);
  pointer-events: none;
  animation: welcome-pulse 1.5s ease-in-out infinite;
}

.welcome-screen__drag-icon {
  font-size: 3rem;
  color: var(--color-primary);
  animation: welcome-bounce 0.6s ease-in-out infinite;
}

.welcome-screen__drag-text {
  font-size: var(--text-size-large, 1.125rem);
  color: var(--color-primary);
  font-weight: 500;
}

@keyframes welcome-pulse {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.7; }
}

@keyframes welcome-bounce {
  0%, 100% { transform: translateY(0); }
  50% { transform: translateY(8px); }
}

/* Reduced motion */
@media (prefers-reduced-motion: reduce) {
  .welcome-screen__drag-overlay,
  .welcome-screen__drag-icon,
  .welcome-screen__progress-fill {
    animation: none;
    transition: none;
  }
}

.workspace__breadcrumb {
  font-family: var(--font-family-body);
  font-size: var(--text-size-small);
  color: var(--color-text-secondary, var(--studio-text-secondary));
  margin-bottom: var(--space-large);
}

.workspace__breadcrumb-sep {
  margin: 0 var(--space-small);
  opacity: 0.5;
}

/* Conversation Navigation */
.workspace__nav {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: var(--space-small);
  margin-bottom: var(--space-medium);
  padding: var(--space-small);
  background: transparent;
  border-radius: var(--radius-medium);
}

/* Centered navigation - title in middle with arrows on sides */
.workspace__nav--centered {
  display: grid;
  grid-template-columns: auto 1fr auto;
  gap: 0;
  padding: 0;
  margin-bottom: var(--space-medium);
  width: 100%;
}

.workspace__nav-left,
.workspace__nav-right {
  display: flex;
  align-items: center;
  flex-shrink: 0;
}

.workspace__nav-center {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  text-align: center;
  padding: 0 var(--space-medium);
  min-width: 0; /* Allow text truncation */
  width: 100%;
  /* Explicit centering for Electron compatibility */
  place-items: center;
}

.workspace__nav-title {
  font-family: var(--font-family-display, Georgia, serif);
  font-size: var(--text-size-large, 1.125rem);
  font-weight: normal;
  color: var(--color-text-primary, var(--studio-text));
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  max-width: 100%;
  /* Explicit centering for Electron compatibility */
  display: block;
  text-align: center;
  width: 100%;
}

.workspace__nav--centered .workspace__nav-position {
  font-size: var(--text-size-small, 0.875rem);
  color: var(--color-text-tertiary, var(--studio-text-secondary));
  opacity: 0.7;
  margin-top: 2px;
}

.workspace__nav-btn {
  display: flex;
  align-items: center;
  justify-content: center;
  width: var(--touch-target, 44px);
  height: var(--touch-target, 44px);
  font-size: var(--text-size-body);
  color: var(--color-text-primary, var(--studio-text));
  background: var(--color-surface-primary, var(--studio-panel-bg));
  border: var(--border-width-thin) solid var(--color-border-subtle, var(--studio-border));
  border-radius: var(--radius-small);
  cursor: pointer;
  transition: all var(--duration-fast) var(--ease-out);
}

.workspace__nav-btn:hover:not(:disabled) {
  background: var(--color-surface-tertiary, var(--studio-hover));
  border-color: var(--color-accent, var(--studio-accent));
  color: var(--color-accent, var(--studio-accent));
}

.workspace__nav-btn:disabled {
  opacity: 0.3;
  cursor: not-allowed;
}

.workspace__nav-position {
  font-family: var(--font-family-body);
  font-size: var(--text-size-small);
  color: var(--color-text-secondary, var(--studio-text-secondary));
  min-width: 4rem;
  text-align: center;
}

/* Article typography (same as book reader) */
.workspace__article h1 {
  font-size: 1.75em;
  font-weight: normal;
  text-align: center;
  margin: 0 0 0.5em;
  letter-spacing: -0.02em;
}

.workspace__article h2 {
  font-size: 1.375em;
  font-weight: normal;
  margin: 2em 0 0.75em;
}

.workspace__article h3 {
  font-size: 1.125em;
  font-weight: normal;
  font-style: italic;
  margin: 1.5em 0 0.5em;
}

.workspace__article p {
  margin: 0 0 1.2em;
  line-height: 1.7;
  text-align: justify;
  hyphens: auto;
}

/* Drop cap */
.workspace__article > p:first-of-type::first-letter {
  float: left;
  font-size: 3.5em;
  line-height: 0.8;
  padding-right: 0.1em;
  margin-top: 0.05em;
  color: var(--studio-accent);
}

.workspace__article blockquote {
  margin: 1.5em 0;
  padding: 1.25em 1.5em;
  background: var(--studio-quote-bg);
  border-left: 3px solid var(--studio-accent);
  font-style: italic;
  color: var(--studio-text-secondary);
}

.workspace__article blockquote p {
  text-align: left;
  margin-bottom: 0.75em;
}

.workspace__article blockquote p:last-child {
  margin-bottom: 0;
}

.workspace__article strong {
  font-weight: 600;
  color: var(--studio-text);
}

.workspace__article em {
  font-style: italic;
}

/* ═══════════════════════════════════════════════════════════════════
   WORKSPACE EDIT MODE
   ═══════════════════════════════════════════════════════════════════ */

/* Workspace header - contains view toggle + action buttons */
.workspace__header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: var(--space-medium);
  margin-bottom: var(--space-large);
}

/* View toggle bar - Read/Edit buttons */
.workspace__view-toggle {
  display: flex;
  align-items: center;
  gap: var(--space-tiny);
  padding: var(--space-small);
  background: var(--color-surface-secondary);
  border: var(--border-width-thin) solid var(--color-border-subtle);
  border-radius: var(--radius-medium);
}

/* Action buttons group - download, copy, md */
.workspace__actions {
  display: flex;
  align-items: center;
  gap: var(--space-tiny);
  padding: var(--space-tiny);
  background: var(--color-surface-secondary);
  border: var(--border-width-thin) solid var(--color-border-subtle);
  border-radius: var(--radius-medium);
}

.workspace__action-btn {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 32px;
  height: 32px;
  font-size: var(--text-size-base);
  color: var(--color-text-secondary);
  background: transparent;
  border: none;
  border-radius: var(--radius-small);
  cursor: pointer;
  transition: all var(--duration-fast) var(--ease-out);
}

.workspace__action-btn:hover {
  color: var(--color-text-primary);
  background: var(--color-surface-tertiary);
}

.workspace__action-btn:active {
  transform: scale(0.95);
}

.workspace__action-btn--md {
  font-size: var(--text-size-tiny);
  font-weight: var(--font-weight-semibold);
  letter-spacing: 0.5px;
}

/* Individual toggle button */
.workspace__view-btn {
  padding: var(--space-small) var(--space-medium);
  font-family: var(--font-family-body);
  font-size: var(--text-size-small);
  font-weight: var(--font-weight-medium);
  color: var(--color-text-secondary);
  background: transparent;
  border: var(--border-width-thin) solid transparent;
  border-radius: var(--radius-small);
  cursor: pointer;
  transition: all var(--duration-fast) var(--ease-out);
  min-height: var(--touch-target);
  display: flex;
  align-items: center;
  justify-content: center;
}

.workspace__view-btn:hover:not(:disabled) {
  color: var(--color-text-primary);
  background: var(--color-surface-tertiary);
  border-color: var(--color-border-default);
}

.workspace__view-btn:active:not(:disabled) {
  transform: scale(0.98);
}

.workspace__view-btn:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

/* Active view button state - warm amber aesthetic */
.workspace__view-btn--active,
.workspace__view-btn[aria-pressed="true"] {
  color: var(--color-text-inverse);
  background: var(--studio-accent, #8b6914);
  border-color: var(--studio-accent, #8b6914);
}

.workspace__view-btn--active:hover,
.workspace__view-btn[aria-pressed="true"]:hover {
  background: #7a5c12;
  border-color: #7a5c12;
}

/* Keyboard shortcut hint */
.workspace__view-hint {
  font-family: var(--font-family-mono);
  font-size: var(--text-size-micro);
  color: var(--color-text-tertiary);
  margin-left: auto;
  padding: 0 var(--space-small);
  border-left: var(--border-width-thin) solid var(--color-border-subtle);
  padding-left: var(--space-medium);
}

/* ═══════════════════════════════════════════════════════════════════
   SPLIT VIEW - Side-by-side editor + preview
   Width is controlled by .workspace container (see above)
   ═══════════════════════════════════════════════════════════════════ */

.workspace__split-view {
  display: grid;
  /* Default 50/50 split, can be overridden by inline style for drag resize */
  grid-template-columns: 1fr var(--split-divider-width, 8px) 1fr;
  gap: 0;
  min-height: max(400px, 60vh);
  width: 100%;
}

/* Mobile tabs for portrait mode */
.workspace__mobile-tabs {
  display: none;
  gap: var(--space-tiny);
  padding: var(--space-small);
  background: var(--color-surface-secondary);
  border-bottom: var(--border-width-thin) solid var(--color-border-subtle);
}

.workspace__mobile-tab {
  flex: 1;
  padding: var(--space-small) var(--space-medium);
  font-family: var(--font-family-body);
  font-size: var(--text-size-small);
  font-weight: var(--font-weight-medium);
  color: var(--color-text-secondary);
  background: transparent;
  border: var(--border-width-thin) solid var(--color-border-subtle);
  border-radius: var(--radius-small);
  cursor: pointer;
  transition: all var(--duration-fast) var(--ease-out);
  min-height: var(--touch-target);
}

.workspace__mobile-tab:hover {
  background: var(--color-surface-tertiary);
  color: var(--color-text-primary);
}

.workspace__mobile-tab--active {
  background: var(--studio-accent, #8b6914);
  color: var(--color-text-inverse);
  border-color: var(--studio-accent, #8b6914);
}

/* Mobile: Portrait = tabbed single pane */
@media (max-width: 767px) and (orientation: portrait) {
  .workspace__mobile-tabs {
    display: flex;
    grid-column: 1 / -1;
  }

  .workspace__split-view {
    display: flex;
    flex-direction: column;
    min-height: auto;
  }

  .workspace__split-view .workspace__editor-pane,
  .workspace__split-view .workspace__preview-pane {
    display: none;
  }

  /* Show pane based on active tab */
  .workspace__split-view[data-active-pane="editor"] .workspace__editor-pane,
  .workspace__split-view[data-active-pane="preview"] .workspace__preview-pane {
    display: flex;
    flex: 1;
  }

  /* Default to editor pane when no explicit pane set */
  .workspace__split-view:not([data-active-pane]) .workspace__editor-pane {
    display: flex;
    flex: 1;
  }

  .workspace__split-divider {
    display: none;
  }
}

/* Mobile: Landscape = side-by-side */
@media (max-width: 767px) and (orientation: landscape) {
  .workspace__split-view {
    grid-template-columns: 1fr var(--split-divider-width, 8px) 1fr;
    min-height: auto;
  }
}

/* Editor pane container */
.workspace__editor-pane {
  display: flex;
  flex-direction: column;
  background: var(--color-surface-elevated);
  border: var(--border-width-thin) solid var(--color-border-subtle);
  border-radius: var(--radius-medium);
  overflow: hidden;
  box-shadow: var(--shadow-small);
}

/* Textarea for markdown editing */
.workspace__editor {
  flex: 1;
  padding: var(--space-medium);
  font-family: var(--font-family-mono);
  font-size: var(--text-size-body);
  line-height: var(--line-height-relaxed);
  color: var(--color-text-primary);
  background: var(--color-surface-primary);
  border: none;
  resize: none;
  outline: none;
  -webkit-font-smoothing: antialiased;
}

.workspace__editor::placeholder {
  color: var(--color-text-tertiary);
}

.workspace__editor:focus {
  background: var(--color-surface-elevated);
  box-shadow: inset 0 0 0 var(--border-width-thin) var(--color-border-focus);
}

/* Disable spellcheck underline styling */
.workspace__editor::-webkit-input-placeholder {
  color: var(--color-text-tertiary);
}

/* Button row for editor actions */
.workspace__editor-actions {
  display: flex;
  align-items: center;
  justify-content: flex-end;
  gap: var(--space-small);
  padding: var(--space-medium);
  background: var(--color-surface-secondary);
  border-top: var(--border-width-thin) solid var(--color-border-subtle);
  flex-wrap: wrap;
}

/* Action buttons - warm amber/brown for literary workspace */
.workspace__editor-btn {
  padding: var(--space-small) var(--space-medium);
  font-family: var(--font-family-body);
  font-size: var(--text-size-small);
  font-weight: var(--font-weight-medium);
  color: var(--color-text-inverse);
  background: var(--studio-accent, #8b6914);
  border: var(--border-width-thin) solid var(--studio-accent, #8b6914);
  border-radius: var(--radius-small);
  cursor: pointer;
  transition: all var(--duration-fast) var(--ease-out);
  min-height: var(--touch-target);
  display: flex;
  align-items: center;
  justify-content: center;
  gap: var(--space-tiny);
}

.workspace__editor-btn:hover:not(:disabled) {
  background: #7a5c12;
  border-color: #7a5c12;
  box-shadow: var(--shadow-small);
}

.workspace__editor-btn:active:not(:disabled) {
  transform: scale(0.98);
}

.workspace__editor-btn:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

/* Secondary variant for editor buttons */
.workspace__editor-btn--secondary {
  color: var(--color-text-primary);
  background: var(--color-surface-tertiary);
  border-color: var(--color-border-default);
}

.workspace__editor-btn--secondary:hover:not(:disabled) {
  background: var(--color-border-subtle);
  border-color: var(--color-border-default);
}

/* Preview pane container */
.workspace__preview-pane {
  display: flex;
  flex-direction: column;
  background: var(--color-surface-elevated);
  border: var(--border-width-thin) solid var(--color-border-subtle);
  border-radius: var(--radius-medium);
  overflow: hidden;
  overflow-y: auto;
  box-shadow: var(--shadow-small);
}

/* Preview pane content - generous padding for readability */
.workspace__preview-pane .workspace__article {
  padding: var(--space-xl, 2rem) var(--space-2xl, 3rem);
  max-width: 65ch;
  margin: 0 auto;
}

/* Resizable divider between panes */
.workspace__split-divider {
  --split-divider-width: 8px;
  width: var(--split-divider-width);
  background: var(--color-surface-secondary);
  cursor: col-resize;
  position: relative;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: background var(--duration-fast) var(--ease-out);
  user-select: none;
  touch-action: none;
}

.workspace__split-divider:hover {
  background: var(--color-surface-tertiary);
}

.workspace__split-divider:active,
.workspace__split-divider--dragging {
  background: var(--studio-accent, #8b6914);
}

/* Divider grab handle indicator */
.workspace__split-divider::before {
  content: '';
  width: 4px;
  height: 40px;
  background: var(--color-border-default);
  border-radius: var(--radius-full);
  opacity: 0.5;
  transition: opacity var(--duration-fast) var(--ease-out),
              height var(--duration-fast) var(--ease-out);
}

.workspace__split-divider:hover::before {
  opacity: 1;
  height: 60px;
}

.workspace__split-divider:active::before,
.workspace__split-divider--dragging::before {
  background: var(--color-text-inverse);
  opacity: 1;
}

/* Preview content area */
.workspace__preview-content {
  flex: 1;
  padding: var(--space-medium);
  overflow-y: auto;
  background: var(--color-surface-primary);
  font-size: var(--text-size-body);
  line-height: var(--line-height-reading);
  color: var(--color-text-primary);
}

/* Preview header/label */
.workspace__preview-header {
  padding: var(--space-medium);
  background: var(--color-surface-secondary);
  border-bottom: var(--border-width-thin) solid var(--color-border-subtle);
  font-weight: var(--font-weight-medium);
  font-size: var(--text-size-small);
  color: var(--color-text-secondary);
}

/* Preview typography - markdown rendered content */
.workspace__preview-content h1 {
  font-size: 1.75em;
  font-weight: var(--font-weight-bold);
  margin: var(--space-medium) 0 var(--space-small);
  color: var(--color-text-primary);
}

.workspace__preview-content h2 {
  font-size: 1.375em;
  font-weight: var(--font-weight-bold);
  margin: var(--space-large) 0 var(--space-small);
  color: var(--color-text-primary);
}

.workspace__preview-content h3 {
  font-size: 1.125em;
  font-weight: var(--font-weight-semibold);
  margin: var(--space-medium) 0 var(--space-small);
  color: var(--color-text-primary);
}

.workspace__preview-content p {
  margin-bottom: var(--space-medium);
  line-height: var(--line-height-reading);
}

.workspace__preview-content strong {
  font-weight: var(--font-weight-bold);
  color: var(--color-text-primary);
}

.workspace__preview-content em {
  font-style: italic;
}

.workspace__preview-content code {
  padding: var(--space-tiny) var(--space-small);
  background: var(--color-surface-secondary);
  border-radius: var(--radius-small);
  font-family: var(--font-family-mono);
  font-size: 0.9em;
  color: var(--color-status-error);
}

.workspace__preview-content blockquote {
  margin: var(--space-medium) 0;
  padding-left: var(--space-medium);
  border-left: var(--border-width-thick) solid var(--color-border-default);
  color: var(--color-text-secondary);
  font-style: italic;
}

.workspace__preview-content ul,
.workspace__preview-content ol {
  margin: var(--space-medium) 0;
  padding-left: var(--space-large);
}

.workspace__preview-content li {
  margin-bottom: var(--space-small);
  line-height: var(--line-height-relaxed);
}

.workspace__preview-content a {
  color: var(--color-text-link);
  text-decoration: underline;
  cursor: pointer;
  transition: color var(--duration-fast) var(--ease-out);
}

.workspace__preview-content a:hover {
  color: var(--color-text-link-hover);
}

.workspace__preview-content hr {
  margin: var(--space-large) 0;
  border: none;
  border-top: var(--border-width-thin) solid var(--color-border-subtle);
}

/* Mobile responsiveness - stack preview below editor */
@media (max-width: 767px) {
  .workspace__editor-pane,
  .workspace__preview-pane {
    min-height: 400px;
  }

  .workspace__editor {
    min-height: 300px;
  }

  .workspace__preview-content {
    min-height: 300px;
  }
}

/* Dark mode adjustments */
@media (prefers-color-scheme: dark) {
  .workspace__view-toggle {
    background: var(--color-surface-secondary);
  }

  .workspace__editor-pane,
  .workspace__preview-pane {
    background: var(--color-surface-elevated);
    box-shadow: var(--shadow-medium);
  }

  .workspace__editor {
    background: var(--color-surface-primary);
  }

  .workspace__editor:focus {
    background: var(--color-surface-elevated);
  }

  .workspace__editor-actions {
    background: var(--color-surface-secondary);
  }

  .workspace__preview-content {
    background: var(--color-surface-primary);
  }

  .workspace__preview-header {
    background: var(--color-surface-secondary);
  }
}

/* Reduced motion support */
@media (prefers-reduced-motion: reduce) {
  /* Workspace */
  .workspace__view-btn,
  .workspace__editor-btn,
  .workspace__editor {
    transition: none;
  }

  .workspace__view-btn:active:not(:disabled),
  .workspace__editor-btn:active:not(:disabled) {
    transform: none;
  }

  /* Layout components - disable all transitions and transforms */
  .symmetric-menubar__button,
  .symmetric-menubar__split-btn,
  .panel-resizer,
  .panel-resizer__handle,
  .split-divider,
  .split-divider__handle,
  .split-divider__grip,
  .split-workspace__tab,
  .studio-panel,
  .studio-panel--bottom-sheet,
  .studio-panel__backdrop,
  .split-workspace__pane,
  .bottom-sheet-handle {
    transition: none !important;
    animation: none !important;
  }

  .symmetric-menubar__split-btn:active {
    transform: none;
  }
}

/* ═══════════════════════════════════════════════════════════════════
   HOVER PANELS
   ═══════════════════════════════════════════════════════════════════ */

.studio-panel__trigger {
  position: fixed;
  top: 0;
  bottom: 0;
  width: 20px;
  z-index: 50;
}

.studio-panel__trigger--left {
  left: 0;
}

.studio-panel__trigger--right {
  right: 0;
}

.studio-panel {
  position: fixed;
  top: 0;
  bottom: 0;
  width: 320px;
  max-width: 85vw;
  background: var(--studio-panel-bg);
  border: 1px solid var(--studio-border);
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
  z-index: 200;
  transform: translateX(-100%);
  transition: transform 0.3s ease;
  display: flex;
  flex-direction: column;
}

.studio-panel--left {
  left: 0;
  border-left: none;
  border-radius: 0 8px 8px 0;
}

.studio-panel--right {
  right: 0;
  left: auto;
  transform: translateX(100%);
  border-right: none;
  border-radius: 8px 0 0 8px;
}

.studio-panel--open {
  transform: translateX(0);
}

.studio-panel__backdrop {
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.2);
  z-index: 150;
}

.studio-panel__header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 1rem 1.25rem;
  border-bottom: 1px solid var(--studio-border);
}

.studio-panel__title {
  font-family: -apple-system, BlinkMacSystemFont, sans-serif;
  font-size: 0.875rem;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.05em;
  color: var(--studio-text-secondary);
  margin: 0;
}

.studio-panel__close {
  min-width: var(--touch-target-min, 44px);
  min-height: var(--touch-target-min, 44px);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.25rem;
  color: var(--studio-text-secondary);
  background: transparent;
  border: none;
  border-radius: var(--radius-md);
  cursor: pointer;
  transition: background 0.15s ease, color 0.15s ease;
}

.studio-panel__close:hover {
  background: var(--studio-hover);
  color: var(--studio-text);
}

.studio-panel__close:focus {
  outline: none;
}

.studio-panel__close:focus-visible {
  outline: 2px solid var(--color-primary, #4a7c59);
  outline-offset: 2px;
}

.studio-panel__content {
  flex: 1;
  overflow-y: auto;
  padding: 1rem;
}

/* ═══════════════════════════════════════════════════════════════════
   ARCHIVE BROWSER
   ═══════════════════════════════════════════════════════════════════ */

.archive-browser__list {
  display: flex;
  flex-direction: column;
  gap: 0.25rem;
}

.archive-item__header {
  width: 100%;
  display: flex;
  align-items: center;
  gap: 0.5rem;
  padding: 0.75rem;
  font-family: -apple-system, BlinkMacSystemFont, sans-serif;
  font-size: 0.875rem;
  text-align: left;
  color: var(--studio-text);
  background: transparent;
  border: none;
  border-radius: 6px;
  cursor: pointer;
  transition: background 0.2s ease;
}

.archive-item__header:hover {
  background: var(--studio-hover);
}

.archive-item__header--expanded {
  background: var(--studio-quote-bg);
}

.archive-item__icon {
  font-size: 0.625rem;
  color: var(--studio-text-secondary);
  width: 1em;
}

.archive-item__title {
  flex: 1;
  font-weight: 500;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.archive-item__date {
  font-size: 0.75rem;
  color: var(--studio-text-secondary);
}

.archive-item__messages {
  padding-left: 1.5rem;
  margin-top: 0.25rem;
}

.archive-message {
  width: 100%;
  display: block;
  padding: 0.625rem 0.75rem;
  font-family: Georgia, serif;
  font-size: 0.8125rem;
  font-style: italic;
  text-align: left;
  color: var(--studio-text-secondary);
  background: transparent;
  border: none;
  border-left: 2px solid transparent;
  cursor: pointer;
  transition: all 0.2s ease;
}

.archive-message:hover {
  background: var(--studio-hover);
  border-left-color: var(--studio-accent);
  color: var(--studio-text);
}

.archive-message__preview {
  display: block;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

/* ═══════════════════════════════════════════════════════════════════
   MEDIA VIEWER - Full workspace media display (fullscreen layout)
   ═══════════════════════════════════════════════════════════════════ */

.workspace--media {
  display: flex;
  flex-direction: column;
  height: 100%;
  max-height: 100vh;
  overflow: hidden;
  background: #1a1a1a;
}

.workspace--graph {
  display: flex;
  flex-direction: column;
  width: 100%;
  max-width: none; /* Override the 38rem constraint */
  height: 100%;
  max-height: 100vh;
  margin: 0; /* Remove auto margins */
  padding: 0; /* Remove padding */
  overflow: hidden;
  background: var(--studio-bg, #1a1a1a);
}

/* On larger screens, ensure graph fills available space */
@media (min-width: 1024px) {
  .workspace--graph {
    min-height: calc(100vh - 4rem);
  }
}

.media-viewer {
  display: flex;
  flex-direction: column;
  height: 100%;
  max-height: 100%;
  overflow: hidden;
}

.media-viewer--fullscreen {
  background: #1a1a1a;
}

/* Header - compact top bar, fixed height */
.media-viewer__header {
  display: flex;
  align-items: center;
  gap: 24px;
  padding: 10px 24px;
  background: linear-gradient(to bottom, rgba(0, 0, 0, 0.7), rgba(0, 0, 0, 0.5));
  border-bottom: 1px solid rgba(255, 255, 255, 0.08);
  z-index: 10;
  flex-shrink: 0;
  height: 52px;
  min-height: 52px;
}

/* Expanded header with linked content */
.media-viewer__header--expanded {
  flex-direction: column;
  align-items: stretch;
  height: auto;
  min-height: 52px;
  padding: 8px 24px 10px;
  gap: 6px;
}

.media-viewer__header-row {
  display: flex;
  align-items: center;
  gap: 24px;
}

/* Linked content row */
.media-viewer__linked {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 4px 0;
  overflow-x: auto;
  scrollbar-width: thin;
}

.media-viewer__linked-label {
  font-size: 0.75rem;
  font-weight: 600;
  color: rgba(255, 255, 255, 0.6);
  text-transform: uppercase;
  letter-spacing: 0.05em;
  flex-shrink: 0;
}

.media-viewer__linked-items {
  display: flex;
  align-items: center;
  gap: 8px;
  flex-wrap: wrap;
}

.media-viewer__linked-item {
  display: inline-flex;
  align-items: center;
  gap: 4px;
  font-size: 0.8125rem;
  color: rgba(255, 255, 255, 0.85);
  background: rgba(255, 255, 255, 0.08);
  padding: 2px 10px;
  border-radius: 12px;
  cursor: pointer;
  transition: background 0.15s ease;
}

.media-viewer__linked-item:hover {
  background: rgba(255, 255, 255, 0.15);
}

.media-viewer__linked-sep {
  color: rgba(255, 255, 255, 0.3);
  margin: 0 4px;
  display: none; /* Hidden, using gap instead */
}

.media-viewer__linked-type {
  font-size: 0.875rem;
}

.media-viewer__linked-text {
  max-width: 300px;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

.media-viewer__close {
  display: flex;
  align-items: center;
  gap: var(--space-xs);
  padding: var(--space-sm) var(--space-md);
  background: rgba(255, 255, 255, 0.08);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: var(--radius-md);
  color: rgba(255, 255, 255, 0.9);
  font-size: 0.875rem;
  font-weight: 500;
  cursor: pointer;
  transition: all 0.15s ease;
}

.media-viewer__close:hover {
  background: rgba(255, 255, 255, 0.15);
  border-color: rgba(255, 255, 255, 0.3);
  color: white;
}

.media-viewer__info {
  flex: 1;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 4px;
  min-width: 0;
  text-align: center;
}

.media-viewer__filename {
  font-size: 0.9375rem;
  font-weight: 500;
  color: white;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  max-width: 100%;
}

.media-viewer__meta {
  font-size: 0.8125rem;
  color: rgba(255, 255, 255, 0.55);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  letter-spacing: 0.01em;
}

/* Stage - main image area, constrained to leave room for header + strip */
.media-viewer__stage {
  position: relative; /* For nav arrow positioning */
  flex: 1;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 16px;
  min-height: 0;
  overflow: hidden;
  /* Let flexbox handle height - strip is fixed 84px */
}

.media-viewer__image {
  max-width: 100%;
  max-height: 100%;
  width: auto;
  height: auto;
  object-fit: contain;
  border-radius: 8px;
  box-shadow: 0 8px 40px rgba(0, 0, 0, 0.4);
}

.media-viewer__video {
  max-width: 100%;
  max-height: 100%;
  border-radius: 8px;
}

/* Thumbnail strip at bottom - fixed height, never shrinks */
.media-viewer__strip {
  display: flex;
  align-items: center;
  gap: 16px;
  padding: 12px 24px;
  background: linear-gradient(to top, rgba(0, 0, 0, 0.7), rgba(0, 0, 0, 0.5));
  border-top: 1px solid rgba(255, 255, 255, 0.08);
  flex-shrink: 0;
  height: 84px;
  min-height: 84px;
}

.media-viewer__strip-label {
  font-size: 0.8125rem;
  font-weight: 500;
  color: rgba(255, 255, 255, 0.7);
  white-space: nowrap;
  padding-right: var(--space-md);
  border-right: 1px solid rgba(255, 255, 255, 0.15);
}

.media-viewer__strip-scroll {
  flex: 1;
  display: flex;
  gap: var(--space-xs);
  overflow-x: auto;
  overflow-y: hidden;
  padding: var(--space-xs) 0;
  scrollbar-width: thin;
  scrollbar-color: rgba(255,255,255,0.3) transparent;
}

.media-viewer__strip-scroll::-webkit-scrollbar {
  height: 6px;
}

.media-viewer__strip-scroll::-webkit-scrollbar-track {
  background: transparent;
}

.media-viewer__strip-scroll::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.3);
  border-radius: 3px;
}

.media-viewer__strip-thumb {
  flex-shrink: 0;
  width: 60px;
  height: 60px;
  border-radius: var(--radius-xs);
  overflow: hidden;
  cursor: pointer;
  opacity: 0.6;
  transition: all 0.15s ease;
  background: none;
  border: 2px solid transparent;
  padding: 0;
}

.media-viewer__strip-thumb:hover {
  opacity: 0.9;
}

.media-viewer__strip-thumb--active {
  opacity: 1;
  border-color: var(--studio-accent, #d4a574);
}

.media-viewer__strip-thumb img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

/* Mobile: Hide strip label, smaller thumbs */
@media (max-width: 768px) {
  .media-viewer__strip-label {
    display: none;
  }

  .media-viewer__strip-thumb {
    width: 50px;
    height: 50px;
  }

  .media-viewer__header {
    padding: var(--space-xs) var(--space-sm);
  }

  .media-viewer__stage {
    padding: var(--space-sm);
  }
}

/* Clickable main image */
.media-viewer__image--clickable {
  cursor: zoom-in;
  transition: transform 0.15s ease;
}

.media-viewer__image--clickable:hover {
  transform: scale(1.01);
}

/* Navigation arrows for main viewer */
.media-viewer__nav {
  position: absolute;
  top: 50%;
  transform: translateY(-50%);
  width: 48px;
  height: 80px;
  border: none;
  background: rgba(0, 0, 0, 0.4);
  color: white;
  font-size: 2rem;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: background 0.15s ease;
  z-index: 5;
  border-radius: 8px;
}

.media-viewer__nav:hover {
  background: rgba(0, 0, 0, 0.6);
}

.media-viewer__nav--prev {
  left: 24px;
}

.media-viewer__nav--next {
  right: 24px;
}

/* Related thumb as button - reset styles */
button.media-viewer__related-thumb {
  background: none;
  border: none;
  padding: 0;
  margin: 0;
  font: inherit;
}

/* ═══════════════════════════════════════════════════════════════════
   MEDIA LIGHTBOX - Modal overlay for navigating related images
   ═══════════════════════════════════════════════════════════════════ */

.media-lightbox {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0, 0, 0, 0.95);
  z-index: 1000;
  display: flex;
  align-items: center;
  justify-content: center;
}

.media-lightbox__close {
  position: absolute;
  top: 16px;
  right: 16px;
  left: auto !important;
  bottom: auto !important;
  width: 44px;
  height: 44px;
  border: none;
  background: rgba(0, 0, 0, 0.6);
  color: white;
  font-size: 1.25rem;
  border-radius: 50%;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: background 0.15s ease;
  z-index: 100;
  backdrop-filter: blur(4px);
}

.media-lightbox__close:hover {
  background: rgba(255, 255, 255, 0.2);
}

.media-lightbox__nav {
  position: absolute;
  top: 50%;
  transform: translateY(-50%);
  width: 48px;
  height: 80px;
  border: none;
  background: rgba(255, 255, 255, 0.1);
  color: white;
  font-size: 2.5rem;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: background 0.15s ease;
  z-index: 10;
}

.media-lightbox__nav:hover {
  background: rgba(255, 255, 255, 0.2);
}

.media-lightbox__nav--prev {
  left: 16px;
  right: auto !important;
  border-radius: 8px;
}

.media-lightbox__nav--next {
  right: 16px;
  left: auto !important;
  border-radius: 8px;
}

.media-lightbox__image {
  max-width: calc(100vw - 120px);
  max-height: calc(100vh - 100px);
  object-fit: contain;
  border-radius: var(--radius-sm);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5);
}

/* Bottom toolbar */
.media-lightbox__toolbar {
  position: absolute;
  bottom: 0;
  left: 0;
  right: 0;
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 16px 48px;
  padding-bottom: 24px; /* Extra for Safari rounded corners */
  background: linear-gradient(transparent, rgba(0, 0, 0, 0.85));
  color: white;
  z-index: 10;
}

.media-lightbox__counter {
  font-size: 0.875rem;
  font-weight: 600;
  color: rgba(255, 255, 255, 0.9);
  min-width: 80px;
  font-variant-numeric: tabular-nums;
}

.media-lightbox__filename {
  flex: 1;
  text-align: center;
  font-size: 0.875rem;
  font-weight: 500;
  color: rgba(255, 255, 255, 0.75);
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
  padding: 0 var(--space-lg);
}

.media-lightbox__actions {
  display: flex;
  gap: var(--space-sm);
  min-width: 80px;
  justify-content: flex-end;
}

.media-lightbox__action {
  padding: var(--space-xs) var(--space-md);
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: var(--radius-md);
  color: rgba(255, 255, 255, 0.9);
  font-size: 0.8125rem;
  font-weight: 500;
  cursor: pointer;
  transition: all 0.15s ease;
}

.media-lightbox__action:hover {
  background: rgba(255, 255, 255, 0.2);
  border-color: rgba(255, 255, 255, 0.4);
  color: white;
}

/* ═══════════════════════════════════════════════════════════════════
   CONTENT VIEWER - Facebook posts/comments viewer
   ═══════════════════════════════════════════════════════════════════ */

.workspace--content {
  display: flex;
  flex-direction: column;
  height: 100%;
  overflow: hidden;
}

.content-viewer {
  flex: 1;
  display: flex;
  flex-direction: column;
  max-width: 800px;
  margin: 0 auto;
  padding: var(--space-lg);
  overflow-y: auto;
}

.content-viewer__header {
  display: flex;
  align-items: center;
  gap: var(--space-md);
  padding-bottom: var(--space-md);
  border-bottom: 1px solid var(--studio-border);
  margin-bottom: var(--space-lg);
}

.content-viewer__close {
  padding: var(--space-xs) var(--space-sm);
  background: var(--studio-quote-bg);
  border: 1px solid var(--studio-border);
  border-radius: var(--radius-md);
  color: var(--studio-text);
  font-size: 0.875rem;
  cursor: pointer;
  transition: all 0.15s ease;
}

.content-viewer__close:hover {
  background: var(--studio-bg);
  border-color: var(--studio-accent);
}

.content-viewer__meta {
  display: flex;
  align-items: center;
  gap: var(--space-sm);
  flex-wrap: wrap;
}

.content-viewer__type {
  padding: var(--space-xs) var(--space-sm);
  border-radius: var(--radius-sm);
  font-size: 0.75rem;
  font-weight: 600;
}

.content-viewer__type--post {
  background: var(--color-info, #0ea5e9);
  color: white;
}

.content-viewer__type--comment {
  background: var(--color-success, #22c55e);
  color: white;
}

.content-viewer__date {
  font-size: 0.8125rem;
  color: var(--studio-text-secondary);
}

.content-viewer__author {
  font-size: 0.8125rem;
  color: var(--studio-text-secondary);
  font-style: italic;
}

.content-viewer__badge {
  padding: var(--space-xs) var(--space-sm);
  background: var(--studio-accent);
  color: white;
  border-radius: var(--radius-sm);
  font-size: 0.6875rem;
  font-weight: 600;
  text-transform: uppercase;
}

.content-viewer__title {
  font-family: Georgia, 'Times New Roman', serif;
  font-size: 1.5rem;
  font-weight: 600;
  color: var(--studio-text);
  margin: 0 0 var(--space-md);
  line-height: 1.3;
}

.content-viewer__body {
  flex: 1;
}

.content-viewer__text {
  font-family: Georgia, 'Times New Roman', serif;
  font-size: 1.0625rem;
  line-height: 1.7;
  color: var(--studio-text);
  white-space: pre-wrap;
}

.content-viewer__media {
  margin-top: var(--space-xl);
  padding-top: var(--space-lg);
  border-top: 1px solid var(--studio-border);
}

.content-viewer__media-header {
  font-size: 0.875rem;
  font-weight: 600;
  color: var(--studio-text-secondary);
  margin: 0 0 var(--space-md);
}

.content-viewer__media-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
  gap: var(--space-sm);
}

.content-viewer__media-thumb {
  aspect-ratio: 1;
  border-radius: var(--radius-md);
  overflow: hidden;
  background: var(--studio-quote-bg);
}

.content-viewer__media-thumb img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.content-viewer__media-video {
  width: 100%;
  height: 100%;
  display: flex;
  align-items: center;
  justify-content: center;
  background: var(--studio-bg);
  color: var(--studio-text-secondary);
  font-size: 0.75rem;
}

.content-viewer__context {
  margin-top: var(--space-xl);
  padding-top: var(--space-lg);
  border-top: 1px solid var(--studio-border);
}

.content-viewer__context-header {
  font-size: 0.875rem;
  font-weight: 600;
  color: var(--studio-text-secondary);
  margin: 0 0 var(--space-sm);
}

.content-viewer__context-text {
  font-family: 'SF Mono', Monaco, monospace;
  font-size: 0.75rem;
  color: var(--studio-text-secondary);
  background: var(--studio-quote-bg);
  padding: var(--space-sm);
  border-radius: var(--radius-sm);
  overflow-x: auto;
  white-space: pre-wrap;
  margin: 0;
}

/* ═══════════════════════════════════════════════════════════════════
   TOOLS PANEL - Tabbed Photoshop-style design
   ═══════════════════════════════════════════════════════════════════ */

.tool-tabs {
  display: flex;
  flex-direction: column;
  height: 100%;
  min-height: 0;
  margin: -1rem; /* Counteract panel padding for edge-to-edge tabs */
  width: calc(100% + 2rem);
}

/* Empty state */
.tool-tabs__empty {
  flex: 1;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 2rem;
  text-align: center;
}

.tool-tabs__empty-icon {
  font-size: 2.5rem;
  color: var(--studio-border);
  margin-bottom: 1rem;
  opacity: 0.5;
}

.tool-tabs__empty p {
  font-family: Georgia, serif;
  font-size: 0.9375rem;
  font-style: italic;
  color: var(--studio-text-secondary);
  margin: 0 0 0.25rem;
}

.tool-tabs__empty span {
  font-family: -apple-system, BlinkMacSystemFont, sans-serif;
  font-size: 0.75rem;
  color: var(--studio-text-secondary);
  opacity: 0.6;
}

/* Tab navigation - horizontal scroll */
.tool-tabs__nav {
  display: flex;
  border-bottom: 1px solid var(--studio-border);
  background: var(--studio-quote-bg);
  overflow-x: auto;
  overflow-y: hidden;
  scrollbar-width: thin;
  scrollbar-color: var(--studio-border) transparent;
}

.tool-tabs__nav::-webkit-scrollbar {
  height: 4px;
}

.tool-tabs__nav::-webkit-scrollbar-track {
  background: transparent;
}

.tool-tabs__nav::-webkit-scrollbar-thumb {
  background: var(--studio-border);
  border-radius: 2px;
}

.tool-tabs__tab {
  flex: 1;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 0.125rem;
  padding: 0.625rem 0.25rem 0.5rem;
  font-family: -apple-system, BlinkMacSystemFont, sans-serif;
  background: transparent;
  border: none;
  border-bottom: 2px solid transparent;
  cursor: pointer;
  transition: all 0.2s ease;
  margin-bottom: -1px;
  min-width: 0;
}

.tool-tabs__tab:hover {
  background: var(--studio-hover);
}

.tool-tabs__tab--active {
  background: var(--studio-panel-bg);
  border-bottom-color: var(--studio-accent);
}

.tool-tabs__tab-icon {
  font-size: 1rem;
  color: var(--studio-text-secondary);
  transition: color 0.2s ease;
}

.tool-tabs__tab--active .tool-tabs__tab-icon {
  color: var(--studio-accent);
}

.tool-tabs__tab-label {
  font-size: 0.625rem;
  font-weight: 500;
  text-transform: uppercase;
  letter-spacing: 0.05em;
  color: var(--studio-text-secondary);
}

.tool-tabs__tab--active .tool-tabs__tab-label {
  color: var(--studio-text);
}

/* Tab content area */
.tool-tabs__content {
  flex: 1;
  overflow-y: auto;
  min-height: 0;
  padding: 1rem;
}

/* Individual tool panel */
.tool-panel {
  /* Content inside tabs - no extra padding needed, handled by parent */
}

.tool-panel__header {
  margin-bottom: 1rem;
  padding-bottom: 0.75rem;
  border-bottom: 1px solid var(--studio-border);
}

.tool-panel__header h3 {
  font-family: Georgia, serif;
  font-size: 1.125rem;
  font-weight: normal;
  color: var(--studio-text);
  margin: 0 0 0.125rem;
}

.tool-panel__subtitle {
  font-family: -apple-system, BlinkMacSystemFont, sans-serif;
  font-size: 0.75rem;
  color: var(--studio-text-secondary);
  font-style: italic;
}

.tool-panel__section {
  margin-bottom: 1rem;
}

.tool-panel__label {
  display: block;
  font-family: -apple-system, BlinkMacSystemFont, sans-serif;
  font-size: 0.6875rem;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.075em;
  color: var(--studio-text-secondary);
  margin-bottom: 0.5rem;
}

.tool-panel__divider {
  height: 1px;
  background: var(--studio-border);
  margin: 1rem 0;
}

.tool-panel__body {
  display: flex;
  flex-direction: column;
  gap: 0.375rem;
}

/* Tool cards - clickable action items */
.tool-card {
  display: flex;
  flex-direction: column;
  align-items: flex-start;
  gap: 0.25rem;
  width: 100%;
  padding: 0.75rem 1rem;
  font-family: -apple-system, BlinkMacSystemFont, sans-serif;
  text-align: left;
  background: var(--studio-panel-bg);
  border: 1px solid var(--studio-border);
  border-radius: 6px;
  cursor: pointer;
  transition: all 0.15s ease;
}

.tool-card:hover {
  background: var(--studio-hover);
  border-color: var(--studio-accent);
  transform: translateX(2px);
}

.tool-card__name {
  font-size: 0.875rem;
  font-weight: 500;
  color: var(--studio-text);
}

.tool-card__desc {
  font-size: 0.75rem;
  color: var(--studio-text-secondary);
  line-height: 1.3;
}

.tool-card--compact {
  padding: 0.5rem 0.75rem;
}

.tool-card--compact .tool-card__name {
  font-size: 0.8125rem;
}

/* Primary action card */
.tool-card--primary {
  background: linear-gradient(135deg, var(--studio-accent), #8b6914);
  border-color: var(--studio-accent);
  color: white;
}

.tool-card--primary .tool-card__name,
.tool-card--primary .tool-card__desc {
  color: white;
}

.tool-card--primary:hover {
  background: linear-gradient(135deg, #8b6914, var(--studio-accent));
  transform: translateX(2px);
}

.tool-card--primary:disabled {
  background: var(--studio-border);
  border-color: var(--studio-border);
  cursor: not-allowed;
  transform: none;
  opacity: 0.6;
}

/* Selected state for persona/style cards */
.tool-card--selected {
  border-color: var(--studio-accent);
  background: rgba(180, 140, 30, 0.15);
  box-shadow: 0 0 0 2px rgba(180, 140, 30, 0.3);
}

/* Cancel button */
.tool-card--cancel {
  background: #dc3545;
  border-color: #dc3545;
  color: white;
}

.tool-card--cancel .tool-card__name {
  color: white;
}

.tool-card--cancel:hover {
  background: #c82333;
  border-color: #c82333;
  transform: translateX(2px);
}

/* Tool panel grid for card layouts */
.tool-panel__grid {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 0.5rem;
}

@media (max-width: 500px) {
  .tool-panel__grid {
    grid-template-columns: 1fr;
  }
}

/* ═══════════════════════════════════════════════════════════════════
   PROFILE CARDS - Horizontal scroll cards for Personas/Styles
   ═══════════════════════════════════════════════════════════════════ */

.profile-cards {
  position: relative;
  margin-bottom: 1rem;
}

.profile-cards__scroll-container {
  display: flex;
  gap: 0.5rem;
  overflow-x: auto;
  overflow-y: hidden;
  scroll-snap-type: x mandatory;
  scrollbar-width: none; /* Firefox */
  -webkit-overflow-scrolling: touch;
  padding: 0.25rem 0;
}

.profile-cards__scroll-container::-webkit-scrollbar {
  display: none; /* Chrome, Safari */
}

/* Individual profile card */
.profile-card {
  flex: 0 0 auto;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: 0.25rem;
  min-width: 5rem;
  padding: 0.625rem 0.75rem;
  background: var(--studio-panel-bg);
  border: 1px solid var(--studio-border);
  border-radius: 8px;
  cursor: pointer;
  transition: all 0.15s ease;
  scroll-snap-align: start;
}

.profile-card:hover {
  border-color: var(--studio-accent);
  background: rgba(var(--studio-accent-rgb, 168, 126, 92), 0.1);
  transform: translateY(-2px);
}

.profile-card__icon {
  font-size: 1.5rem;
  line-height: 1;
}

.profile-card__name {
  font-size: 0.75rem;
  font-weight: 500;
  color: var(--studio-text);
  white-space: nowrap;
  text-overflow: ellipsis;
  overflow: hidden;
  max-width: 5rem;
}

.profile-card--selected {
  border-color: var(--studio-accent);
  background: rgba(var(--studio-accent-rgb, 168, 126, 92), 0.15);
  box-shadow: 0 0 0 2px rgba(var(--studio-accent-rgb, 168, 126, 92), 0.3);
}

.profile-card--selected .profile-card__name {
  color: var(--studio-accent);
}

.profile-card--more {
  border-style: dashed;
  opacity: 0.7;
}

.profile-card--more:hover {
  opacity: 1;
}

.profile-card:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

/* Scroll buttons */
.profile-cards__scroll {
  position: absolute;
  top: 50%;
  transform: translateY(-50%);
  width: 1.75rem;
  height: 1.75rem;
  display: flex;
  align-items: center;
  justify-content: center;
  background: var(--studio-panel-bg);
  border: 1px solid var(--studio-border);
  border-radius: 50%;
  font-size: 1.25rem;
  font-weight: 300;
  color: var(--studio-text-muted);
  cursor: pointer;
  z-index: 2;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
  transition: all 0.15s ease;
}

.profile-cards__scroll:hover {
  background: var(--studio-bg-hover, var(--studio-bg));
  color: var(--studio-text);
  border-color: var(--studio-accent);
}

.profile-cards__scroll--left {
  left: -0.5rem;
}

.profile-cards__scroll--right {
  right: -0.5rem;
}

/* Toggle for show all */
.profile-cards__toggle {
  display: flex;
  justify-content: flex-end;
  margin-top: 0.25rem;
}

.profile-cards__show-all {
  font-size: 0.6875rem;
  color: var(--studio-text-muted);
  background: none;
  border: none;
  cursor: pointer;
  padding: 0.125rem 0.25rem;
  text-decoration: underline;
  text-underline-offset: 2px;
}

.profile-cards__show-all:hover {
  color: var(--studio-accent);
}

/* Tooltip */
.profile-tooltip {
  position: fixed;
  transform: translateX(-50%) translateY(-100%);
  max-width: 200px;
  padding: 0.5rem 0.75rem;
  background: var(--studio-tooltip-bg, #1a1a1a);
  color: var(--studio-tooltip-text, #fff);
  font-size: 0.75rem;
  line-height: 1.4;
  border-radius: 6px;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
  z-index: 9999;
  pointer-events: none;
  animation: tooltipFadeIn 0.15s ease;
}

.profile-tooltip::after {
  content: '';
  position: absolute;
  bottom: -6px;
  left: 50%;
  transform: translateX(-50%);
  border-left: 6px solid transparent;
  border-right: 6px solid transparent;
  border-top: 6px solid var(--studio-tooltip-bg, #1a1a1a);
}

@keyframes tooltipFadeIn {
  from {
    opacity: 0;
    transform: translateX(-50%) translateY(-100%) translateY(4px);
  }
  to {
    opacity: 1;
    transform: translateX(-50%) translateY(-100%);
  }
}

/* Dark theme tooltip colors */
[data-theme="dark"] .profile-tooltip {
  --studio-tooltip-bg: #2a2a2f;
  --studio-tooltip-text: #e8e6e0;
}

/* Light/Sepia theme tooltip colors */
[data-theme="light"] .profile-tooltip,
[data-theme="sepia"] .profile-tooltip {
  --studio-tooltip-bg: #333;
  --studio-tooltip-text: #fff;
}

/* Tool panel actions area */
.tool-panel__actions {
  margin-top: 0.75rem;
}

/* Error display */
.tool-panel__error {
  padding: 0.75rem;
  margin-top: 0.5rem;
  font-size: 0.8125rem;
  color: #dc3545;
  background: rgba(220, 53, 69, 0.1);
  border: 1px solid rgba(220, 53, 69, 0.3);
  border-radius: 4px;
}

/* Result display */
.tool-panel__result {
  display: flex;
  align-items: center;
  gap: 0.75rem;
  padding: 0.75rem;
  margin-top: 0.5rem;
  font-size: 0.8125rem;
  background: rgba(40, 167, 69, 0.1);
  border: 1px solid rgba(40, 167, 69, 0.3);
  border-radius: 4px;
}

.tool-panel__result-success {
  color: #28a745;
  font-weight: 500;
}

.tool-panel__result-meta {
  color: var(--studio-text-secondary);
  font-size: 0.75rem;
}

/* Full-width input */
.tool-control__input--full {
  width: 100%;
  text-align: left;
}

/* Progress bar */
.tool-panel__progress {
  margin-bottom: 0.75rem;
}

.tool-panel__progress-bar {
  height: 4px;
  background: var(--studio-border);
  border-radius: 2px;
  overflow: hidden;
  margin-bottom: 0.5rem;
}

.tool-panel__progress-fill {
  height: 100%;
  background: var(--studio-accent);
  transition: width 0.3s ease;
}

.tool-panel__progress-text {
  font-size: 0.75rem;
  color: var(--studio-text-secondary);
}

/* Sentencing results */
.sentencing-results {
  margin-top: 0.75rem;
}

.sentencing-results__summary {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 0.75rem;
  padding: 0.75rem;
  background: var(--studio-quote-bg);
  border-radius: 6px;
  margin-bottom: 0.75rem;
}

.sentencing-stat {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 0.25rem;
}

.sentencing-stat__value {
  font-size: 1.25rem;
  font-weight: 600;
  color: var(--studio-text);
}

.sentencing-stat__value--stance {
  font-size: 0.875rem;
  text-transform: capitalize;
  color: var(--studio-accent);
}

.sentencing-stat__label {
  font-size: 0.6875rem;
  color: var(--studio-text-secondary);
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.sentencing-results__sentences {
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
  max-height: 400px;
  overflow-y: auto;
}

.sentencing-sentence {
  padding: 0.625rem;
  background: var(--studio-panel-bg);
  border: 1px solid var(--studio-border);
  border-radius: 4px;
}

.sentencing-sentence__header {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  margin-bottom: 0.375rem;
}

.sentencing-sentence__index {
  font-size: 0.6875rem;
  font-weight: 600;
  color: var(--studio-text-secondary);
}

.sentencing-sentence__stance {
  font-size: 0.625rem;
  font-weight: 500;
  text-transform: uppercase;
  padding: 0.125rem 0.375rem;
  border-radius: 3px;
  background: var(--studio-border);
  color: var(--studio-text-secondary);
}

.sentencing-sentence__stance--literal {
  background: rgba(59, 130, 246, 0.2);
  color: #3b82f6;
}

.sentencing-sentence__stance--metaphorical {
  background: rgba(168, 85, 247, 0.2);
  color: #a855f7;
}

.sentencing-sentence__stance--both {
  background: rgba(236, 72, 153, 0.2);
  color: #ec4899;
}

.sentencing-sentence__stance--neither {
  background: rgba(107, 114, 128, 0.2);
  color: #6b7280;
}

.sentencing-sentence__text {
  font-size: 0.8125rem;
  line-height: 1.4;
  color: var(--studio-text);
  margin-bottom: 0.5rem;
}

.sentencing-sentence__probs {
  display: flex;
  height: 6px;
  border-radius: 3px;
  overflow: hidden;
  background: var(--studio-border);
}

.sentencing-prob {
  display: flex;
  align-items: center;
  justify-content: center;
  min-width: 12px;
  background: #3b82f6;
  transition: width 0.3s ease;
}

.sentencing-prob span {
  font-size: 0.5rem;
  font-weight: 600;
  color: white;
}

.sentencing-prob--meta {
  background: #a855f7;
}

.sentencing-prob--both {
  background: #ec4899;
}

.sentencing-prob--neither {
  background: #6b7280;
}

/* Tool controls - inputs, selects, buttons */
.tool-control {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  margin-bottom: 0.5rem;
}

.tool-control__label {
  font-size: 0.75rem;
  color: var(--studio-text-secondary);
  white-space: nowrap;
}

.tool-control__select {
  flex: 1;
  padding: 0.5rem 0.75rem;
  font-family: -apple-system, BlinkMacSystemFont, sans-serif;
  font-size: 0.8125rem;
  color: var(--studio-text);
  background: var(--studio-panel-bg);
  border: 1px solid var(--studio-border);
  border-radius: 4px;
  cursor: pointer;
}

.tool-control__select:focus {
  outline: none;
  border-color: var(--studio-accent);
}

.tool-control__input {
  width: 4.5rem;
  padding: 0.5rem 0.625rem;
  font-family: -apple-system, BlinkMacSystemFont, sans-serif;
  font-size: 0.875rem;
  color: var(--studio-text);
  background: var(--studio-panel-bg);
  border: 1px solid var(--studio-border);
  border-radius: 4px;
  text-align: center;
}

.tool-control__input:focus {
  outline: none;
  border-color: var(--studio-accent);
}

.tool-control__input--small {
  width: 3.5rem;
}

.tool-control__apply {
  padding: 0.5rem 1rem;
  font-family: -apple-system, BlinkMacSystemFont, sans-serif;
  font-size: 0.8125rem;
  font-weight: 500;
  color: white;
  background: var(--studio-accent);
  border: none;
  border-radius: 4px;
  cursor: pointer;
  transition: background 0.15s ease;
}

.tool-control__apply:hover {
  background: #7a5c12;
}

.tool-control__buttons {
  display: flex;
  gap: 0.375rem;
  margin-top: 0.5rem;
}

.tool-control__btn {
  flex: 1;
  padding: 0.5rem;
  font-family: -apple-system, BlinkMacSystemFont, sans-serif;
  font-size: 0.75rem;
  font-weight: 500;
  color: var(--studio-text);
  background: var(--studio-panel-bg);
  border: 1px solid var(--studio-border);
  border-radius: 4px;
  cursor: pointer;
  transition: all 0.15s ease;
}

.tool-control__btn:hover {
  background: var(--studio-hover);
  border-color: var(--studio-accent);
}

/* Stats display */
.tool-panel__stats {
  display: flex;
  justify-content: space-around;
  padding: 1rem 0.5rem;
  background: var(--studio-quote-bg);
  border-radius: 6px;
  margin-bottom: 0.5rem;
}

.tool-stat {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 0.125rem;
}

.tool-stat__value {
  font-family: Georgia, serif;
  font-size: 1.25rem;
  font-weight: normal;
  color: var(--studio-text);
}

.tool-stat__label {
  font-family: -apple-system, BlinkMacSystemFont, sans-serif;
  font-size: 0.625rem;
  text-transform: uppercase;
  letter-spacing: 0.05em;
  color: var(--studio-text-secondary);
}

/* Primary action card */
.tool-card--primary {
  background: var(--studio-accent);
  border-color: var(--studio-accent);
  color: white;
}

.tool-card--primary:hover {
  background: #7a5c12;
  border-color: #7a5c12;
  transform: translateX(2px);
}

.tool-card--primary .tool-card__name,
.tool-card--primary .tool-card__desc {
  color: white;
}

.tool-card--primary .tool-card__desc {
  opacity: 0.85;
}

/* Subtle card (for add actions) */
.tool-card--subtle {
  border-style: dashed;
  background: transparent;
}

.tool-card--subtle:hover {
  background: var(--studio-hover);
  border-style: solid;
}

/* Tool panel empty state */
.tool-panel__empty {
  padding: 2rem 1rem;
  text-align: center;
}

.tool-panel__empty p {
  font-family: Georgia, serif;
  font-style: italic;
  color: var(--studio-text-secondary);
  margin: 0 0 0.5rem;
}

.tool-panel__muted {
  font-family: -apple-system, BlinkMacSystemFont, sans-serif;
  font-size: 0.75rem;
  color: var(--studio-text-secondary);
  opacity: 0.7;
}

/* Tool panel info bar */
.tool-panel__info {
  display: flex;
  gap: 1rem;
  padding: 0.75rem;
  margin-top: 0.75rem;
  background: var(--studio-quote-bg);
  border-radius: 4px;
  font-family: -apple-system, BlinkMacSystemFont, sans-serif;
  font-size: 0.75rem;
  color: var(--studio-text-secondary);
}

/* Tool checkboxes */
.tool-panel__checks {
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
}

.tool-check {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  font-family: -apple-system, BlinkMacSystemFont, sans-serif;
  font-size: 0.8125rem;
  color: var(--studio-text);
  cursor: pointer;
}

.tool-check input[type="checkbox"] {
  width: 16px;
  height: 16px;
  accent-color: var(--studio-accent);
}

/* Tool toggle switches (for settings) */
.tool-toggle {
  display: grid;
  grid-template-columns: auto auto 1fr;
  grid-template-rows: auto auto;
  gap: 0.25rem 0.5rem;
  align-items: center;
  padding: 0.625rem 0.75rem;
  margin-bottom: 0.375rem;
  background: var(--studio-panel-bg);
  border: 1px solid var(--studio-border);
  border-radius: 6px;
  cursor: pointer;
  transition: all 0.15s ease;
}

.tool-toggle:hover {
  background: var(--studio-hover);
  border-color: var(--studio-accent);
}

.tool-toggle input[type="checkbox"] {
  grid-row: span 2;
  width: 18px;
  height: 18px;
  accent-color: var(--studio-accent);
}

.tool-toggle__icon {
  grid-row: span 2;
  font-size: 1.25rem;
  color: var(--studio-text-secondary);
}

.tool-toggle__label {
  font-family: -apple-system, BlinkMacSystemFont, sans-serif;
  font-size: 0.875rem;
  font-weight: 500;
  color: var(--studio-text);
}

.tool-toggle__desc {
  grid-column: 3;
  font-family: -apple-system, BlinkMacSystemFont, sans-serif;
  font-size: 0.6875rem;
  color: var(--studio-text-secondary);
}

/* Markdown editor textarea */
.tool-editor {
  width: 100%;
  min-height: 200px;
  padding: 0.75rem;
  margin-bottom: 0.75rem;
  font-family: 'SF Mono', 'Monaco', 'Menlo', monospace;
  font-size: 0.8125rem;
  line-height: 1.5;
  color: var(--studio-text);
  background: var(--studio-panel-bg);
  border: 1px solid var(--studio-border);
  border-radius: 6px;
  resize: vertical;
}

.tool-editor:focus {
  outline: none;
  border-color: var(--studio-accent);
}

.tool-editor::placeholder {
  color: var(--studio-text-secondary);
}

/* Tab min-width for scrolling */
.tool-tabs__tab {
  flex: 0 0 auto;
  min-width: 52px;
}

/* Legacy support - keep old classes working */
.tools-panel {
  display: flex;
  flex-direction: column;
  gap: 1.5rem;
}

.tools-panel--empty {
  display: flex;
  align-items: center;
  justify-content: center;
  min-height: 200px;
  text-align: center;
  color: var(--studio-text-secondary);
  font-style: italic;
}

.tools-panel__section h3 {
  font-family: -apple-system, BlinkMacSystemFont, sans-serif;
  font-size: 0.6875rem;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.1em;
  color: var(--studio-text-secondary);
  margin: 0 0 0.5rem;
}

.tool-btn {
  display: block;
  width: 100%;
  padding: 0.625rem 0.875rem;
  margin-bottom: 0.375rem;
  font-family: -apple-system, BlinkMacSystemFont, sans-serif;
  font-size: 0.875rem;
  text-align: left;
  color: var(--studio-text);
  background: transparent;
  border: 1px solid var(--studio-border);
  border-radius: 6px;
  cursor: pointer;
  transition: all 0.2s ease;
}

.tool-btn:hover {
  background: var(--studio-hover);
  border-color: var(--studio-accent);
}

.tool-btn--active {
  background: var(--studio-accent);
  color: white;
  border-color: var(--studio-accent);
}

/* ═══════════════════════════════════════════════════════════════════
   MOBILE RESPONSIVE
   ═══════════════════════════════════════════════════════════════════ */

@media (max-width: 767px) {
  .studio-topbar__btn {
    padding: 0.5rem;
    font-size: 0.75rem;
  }

  .studio-panel {
    width: 100%;
    max-width: 100%;
    top: auto;
    bottom: 0;
    height: 70vh;
    transform: translateY(100%);
    border-radius: 16px 16px 0 0;
    border-bottom: none;
  }

  .studio-panel--left,
  .studio-panel--right {
    left: 0;
    right: 0;
    border-left: none;
    border-right: none;
  }

  .studio-panel--open {
    transform: translateY(0);
  }

  .studio__main {
    padding: 4.5rem 1rem 2rem;
  }

  .workspace__placeholder h1 {
    font-size: 1.75rem;
  }

  .workspace__article h1 {
    font-size: 1.5em;
  }

  .workspace__article > p:first-of-type::first-letter {
    font-size: 2.5em;
  }
}

/* ═══════════════════════════════════════════════════════════════════
   STRUCTURE INSPECTOR - Peek behind the curtain
   ═══════════════════════════════════════════════════════════════════ */

.structure-inspector__toggle {
  position: fixed;
  bottom: 5rem;
  right: 1rem;
  width: 36px;
  height: 36px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: var(--studio-panel-bg);
  border: 1px solid var(--studio-border);
  border-radius: 50%;
  font-family: 'SF Mono', Consolas, monospace;
  font-size: 0.75rem;
  color: var(--studio-text-tertiary);
  cursor: pointer;
  opacity: 0.6;
  transition: opacity 0.2s ease, transform 0.2s ease, background 0.2s ease;
  z-index: 90;
}

.structure-inspector__toggle:hover {
  opacity: 1;
  background: var(--studio-hover);
  transform: scale(1.05);
}

.structure-inspector {
  position: fixed;
  bottom: 5rem;
  right: 1rem;
  width: 280px;
  max-height: 400px;
  background: var(--studio-panel-bg);
  border: 1px solid var(--studio-border);
  border-radius: var(--radius-lg, 12px);
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
  z-index: 90;
  overflow: hidden;
  display: flex;
  flex-direction: column;
  font-family: -apple-system, BlinkMacSystemFont, sans-serif;
  font-size: 0.8125rem;
}

.structure-inspector__header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 0.75rem 1rem;
  background: var(--studio-quote-bg);
  border-bottom: 1px solid var(--studio-border);
}

.structure-inspector__header .structure-inspector__toggle {
  position: static;
  width: 28px;
  height: 28px;
  opacity: 0.8;
}

.structure-inspector__title {
  font-size: 0.75rem;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.05em;
  color: var(--studio-text-secondary);
  margin: 0;
}

.structure-inspector__content {
  flex: 1;
  overflow-y: auto;
  padding: 0.5rem;
}

.structure-inspector__section {
  padding: 0.5rem;
  border-bottom: 1px solid var(--studio-border);
}

.structure-inspector__section:last-child {
  border-bottom: none;
}

.structure-inspector__section--muted {
  opacity: 0.7;
}

.structure-inspector__identity {
  display: flex;
  gap: 0.5rem;
  margin-bottom: 0.5rem;
}

.structure-inspector__type-badge,
.structure-inspector__source-badge {
  padding: 0.125rem 0.5rem;
  font-size: 0.6875rem;
  font-weight: 500;
  text-transform: uppercase;
  letter-spacing: 0.03em;
  border-radius: 4px;
}

.structure-inspector__type-badge {
  background: var(--studio-accent);
  color: white;
}

.structure-inspector__source-badge {
  background: var(--studio-border);
  color: var(--studio-text-secondary);
}

.structure-inspector__uri {
  display: block;
  padding: 0.375rem 0.5rem;
  background: var(--studio-bg);
  border-radius: 4px;
  font-family: 'SF Mono', Consolas, monospace;
  font-size: 0.6875rem;
  color: var(--studio-text-secondary);
  word-break: break-all;
  cursor: pointer;
}

.structure-inspector__uri:hover {
  background: var(--studio-hover);
}

.structure-inspector__section-header {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  width: 100%;
  padding: 0.25rem 0;
  background: none;
  border: none;
  font-size: 0.75rem;
  font-weight: 500;
  color: var(--studio-text);
  cursor: pointer;
  text-align: left;
}

.structure-inspector__section-header:hover {
  color: var(--studio-accent);
}

.structure-inspector__size,
.structure-inspector__count {
  margin-left: auto;
  font-size: 0.6875rem;
  font-weight: normal;
  color: var(--studio-text-tertiary);
  font-family: 'SF Mono', Consolas, monospace;
}

.structure-inspector__chevron {
  font-size: 0.625rem;
  color: var(--studio-text-tertiary);
}

.structure-inspector__tree {
  padding-left: 0.5rem;
  border-left: 1px solid var(--studio-border);
  margin-top: 0.5rem;
}

.structure-inspector__tree-item {
  display: flex;
  gap: 0.5rem;
  padding: 0.25rem 0;
  font-size: 0.75rem;
}

.structure-inspector__tree-item--highlight {
  background: rgba(var(--studio-accent-rgb, 139, 105, 20), 0.1);
  margin: 0.125rem -0.25rem;
  padding: 0.25rem;
  border-radius: 3px;
}

.structure-inspector__tree-label {
  color: var(--studio-text-secondary);
  font-family: 'SF Mono', Consolas, monospace;
}

.structure-inspector__tree-value {
  color: var(--studio-text);
}

.structure-inspector__media-grid {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 0.25rem;
  margin-top: 0.5rem;
}

.structure-inspector__media-thumb {
  position: relative;
  aspect-ratio: 1;
  border-radius: 4px;
  overflow: hidden;
  background: var(--studio-bg);
}

.structure-inspector__media-thumb img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.structure-inspector__media-type {
  position: absolute;
  bottom: 2px;
  left: 2px;
  padding: 1px 4px;
  font-size: 0.5rem;
  background: rgba(0, 0, 0, 0.6);
  color: white;
  border-radius: 2px;
  text-transform: uppercase;
}

.structure-inspector__media-more {
  display: flex;
  align-items: center;
  justify-content: center;
  background: var(--studio-border);
  border-radius: 4px;
  font-size: 0.6875rem;
  color: var(--studio-text-secondary);
}

.structure-inspector__source-info {
  display: flex;
  flex-direction: column;
  gap: 0.25rem;
  font-size: 0.6875rem;
  color: var(--studio-text-tertiary);
}

.structure-inspector__original-id {
  font-family: 'SF Mono', Consolas, monospace;
  font-size: 0.625rem;
  background: var(--studio-bg);
  padding: 0.125rem 0.25rem;
  border-radius: 2px;
}

/* Dark mode refinements */
[data-theme="dark"] .structure-inspector__type-badge {
  background: var(--studio-accent);
}

[data-theme="dark"] .structure-inspector__uri {
  background: rgba(255, 255, 255, 0.05);
}

/* ═══════════════════════════════════════════════════════════════════
   WORKSPACE ENHANCEMENTS
   ═══════════════════════════════════════════════════════════════════ */

.workspace__stats {
  display: flex;
  gap: 1rem;
  margin-bottom: 1.5rem;
  padding: 0.75rem 1rem;
  background: var(--studio-quote-bg);
  border-radius: 6px;
  font-family: -apple-system, BlinkMacSystemFont, sans-serif;
  font-size: 0.8125rem;
}

.workspace__stat {
  color: var(--studio-text-secondary);
}

.workspace__item {
  position: relative;
  padding: 1rem 0;
  border-bottom: 1px solid var(--studio-border);
}

.workspace__item:last-child {
  border-bottom: none;
}

.workspace__item-index {
  position: absolute;
  left: -2rem;
  top: 1rem;
  width: 1.5rem;
  height: 1.5rem;
  display: flex;
  align-items: center;
  justify-content: center;
  font-family: -apple-system, BlinkMacSystemFont, sans-serif;
  font-size: 0.75rem;
  color: var(--studio-text-secondary);
  background: var(--studio-quote-bg);
  border-radius: 50%;
}

.workspace__item-sic {
  margin-top: 0.5rem;
  font-family: -apple-system, BlinkMacSystemFont, sans-serif;
  font-size: 0.75rem;
  color: var(--studio-accent);
}

/* Buffer selector in topbar */
.studio-topbar__select {
  padding: 0.375rem 0.75rem;
  font-family: -apple-system, BlinkMacSystemFont, sans-serif;
  font-size: 0.875rem;
  color: var(--studio-text);
  background: transparent;
  border: 1px solid var(--studio-border);
  border-radius: 4px;
  cursor: pointer;
  min-width: 120px;
}

.studio-topbar__select:focus {
  outline: none;
  border-color: var(--studio-accent);
}

/* Archive browser sections */
.archive-browser__section {
  margin-bottom: 1.5rem;
}

.archive-browser__section-title {
  font-family: -apple-system, BlinkMacSystemFont, sans-serif;
  font-size: 0.6875rem;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.1em;
  color: var(--studio-text-secondary);
  margin: 0 0 0.5rem 0.75rem;
}

.archive-browser__total {
  font-weight: 400;
  opacity: 0.7;
}

.archive-browser__header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 0.75rem;
}

/* Filter controls row */
.archive-browser__filters {
  display: flex;
  flex-wrap: wrap;
  gap: 0.5rem;
  align-items: center;
}

.archive-browser__filter,
.archive-browser__sort {
  padding: 0.375rem 0.5rem;
  font-family: -apple-system, BlinkMacSystemFont, sans-serif;
  font-size: 0.75rem;
  color: var(--studio-text);
  background: var(--studio-panel-bg);
  border: 1px solid var(--studio-border);
  border-radius: 4px;
  cursor: pointer;
}

.archive-browser__filter:focus,
.archive-browser__sort:focus {
  outline: none;
  border-color: var(--studio-accent);
}

.archive-browser__checkbox {
  display: flex;
  align-items: center;
  gap: 0.375rem;
  font-family: -apple-system, BlinkMacSystemFont, sans-serif;
  font-size: 0.75rem;
  color: var(--studio-text-secondary);
  cursor: pointer;
}

.archive-browser__checkbox input[type="checkbox"] {
  width: 14px;
  height: 14px;
  accent-color: var(--studio-accent);
}

/* Search input */
.archive-browser__search {
  position: relative;
  margin-bottom: 1rem;
}

.archive-browser__search-input {
  width: 100%;
  padding: 0.625rem 2rem 0.625rem 0.75rem;
  font-family: -apple-system, BlinkMacSystemFont, sans-serif;
  font-size: 0.875rem;
  color: var(--studio-text);
  background: var(--studio-panel-bg);
  border: 1px solid var(--studio-border);
  border-radius: 6px;
  transition: border-color 0.2s ease;
}

.archive-browser__search-input:focus {
  outline: none;
  border-color: var(--studio-accent);
}

.archive-browser__search-input::placeholder {
  color: var(--studio-text-secondary);
}

.archive-browser__search-clear {
  position: absolute;
  right: 0.5rem;
  top: 50%;
  transform: translateY(-50%);
  width: 20px;
  height: 20px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1rem;
  color: var(--studio-text-secondary);
  background: transparent;
  border: none;
  border-radius: 50%;
  cursor: pointer;
  transition: all 0.2s ease;
}

.archive-browser__search-clear:hover {
  background: var(--studio-hover);
  color: var(--studio-text);
}

/* Archive info bar */
.archive-browser__info {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 0.75rem 1rem;
  margin-bottom: 1rem;
  background: var(--studio-quote-bg);
  border-radius: 6px;
  font-family: -apple-system, BlinkMacSystemFont, sans-serif;
  font-size: 0.8125rem;
}

.archive-browser__info-name {
  font-weight: 500;
  color: var(--studio-text);
}

.archive-browser__info-count {
  color: var(--studio-text-secondary);
}

/* Loading and error states */
.archive-browser__loading {
  padding: 2rem;
  text-align: center;
  color: var(--studio-text-secondary);
  font-style: italic;
}

.archive-browser__error {
  padding: 1.5rem;
  text-align: center;
  background: rgba(180, 60, 60, 0.1);
  border-radius: 6px;
  margin-bottom: 1rem;
}

.archive-browser__error p {
  margin: 0 0 1rem;
  color: var(--studio-text);
  font-size: 0.875rem;
}

/* Empty state styling */
.archive-browser__empty {
  padding: 2rem;
  text-align: center;
  color: var(--studio-text-secondary, #666);
}

.archive-browser__empty-text {
  margin: 0 0 0.5rem;
  font-size: 0.9375rem;
}

.archive-browser__empty-hint {
  margin: 0;
  font-size: 0.8125rem;
  opacity: 0.8;
}

.archive-browser__empty-hint strong {
  color: var(--studio-accent, #8b7355);
}

.archive-browser__retry {
  padding: 0.5rem 1rem;
  font-family: -apple-system, BlinkMacSystemFont, sans-serif;
  font-size: 0.8125rem;
  color: var(--studio-text);
  background: var(--studio-panel-bg);
  border: 1px solid var(--studio-border);
  border-radius: 4px;
  cursor: pointer;
  transition: all 0.2s ease;
}

.archive-browser__retry:hover {
  background: var(--studio-hover);
}

/* Pagination */
.archive-browser__pagination {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 0.75rem;
  margin-bottom: 1rem;
  background: var(--studio-quote-bg);
  border-radius: 6px;
  font-family: -apple-system, BlinkMacSystemFont, sans-serif;
  font-size: 0.75rem;
}

.archive-browser__pagination button {
  padding: 0.375rem 0.75rem;
  font-size: 0.75rem;
  color: var(--studio-text-secondary);
  background: var(--studio-panel-bg);
  border: 1px solid var(--studio-border);
  border-radius: 4px;
  cursor: pointer;
  transition: all 0.2s ease;
}

.archive-browser__pagination button:hover:not(:disabled) {
  background: var(--studio-hover);
  color: var(--studio-text);
}

.archive-browser__pagination button:disabled {
  opacity: 0.4;
  cursor: not-allowed;
}

.archive-browser__pagination span {
  color: var(--studio-text-secondary);
}

/* Month grouping */
.archive-browser__month {
  margin-bottom: 1.5rem;
}

.archive-browser__month-header {
  font-family: -apple-system, BlinkMacSystemFont, sans-serif;
  font-size: 0.75rem;
  font-weight: 600;
  color: var(--studio-accent);
  padding: 0.5rem 0.75rem;
  margin-bottom: 0.25rem;
  border-bottom: 1px solid var(--studio-border);
}

/* Archive item metadata */
.archive-item__meta {
  font-size: 0.6875rem;
  color: var(--studio-text-secondary);
  white-space: nowrap;
}

.archive-item__loading {
  padding: 0.75rem;
  text-align: center;
  color: var(--studio-text-secondary);
  font-size: 0.8125rem;
  font-style: italic;
}

/* Message role badges */
.archive-message__role {
  display: inline-block;
  padding: 0.125rem 0.375rem;
  margin-right: 0.5rem;
  font-family: -apple-system, BlinkMacSystemFont, sans-serif;
  font-size: 0.625rem;
  font-weight: 600;
  font-style: normal;
  text-transform: uppercase;
  letter-spacing: 0.05em;
  border-radius: 3px;
  vertical-align: middle;
}

.archive-message--user .archive-message__role {
  background: rgba(59, 130, 246, 0.15);
  color: #2563eb;
}

.archive-message--assistant .archive-message__role {
  background: rgba(34, 197, 94, 0.15);
  color: #16a34a;
}

.archive-message--system .archive-message__role {
  background: rgba(107, 114, 128, 0.15);
  color: #4b5563;
}

.archive-message--tool .archive-message__role {
  background: rgba(168, 85, 247, 0.15);
  color: #9333ea;
}

/* Full conversation import button */
.archive-message--full {
  background: var(--studio-quote-bg);
  border: 1px dashed var(--studio-border);
  border-radius: 6px;
  margin-bottom: 0.5rem;
  font-style: normal;
}

.archive-message--full:hover {
  background: var(--studio-hover);
  border-style: solid;
  border-color: var(--studio-accent);
}

.archive-message--full .archive-message__preview {
  font-weight: 500;
  color: var(--studio-text);
}

/* ═══════════════════════════════════════════════════════════════════
   AUI CHAT - AI Assistant Interface
   ═══════════════════════════════════════════════════════════════════ */

/* Floating Action Button */
.aui-fab {
  position: fixed;
  bottom: 1.5rem;
  right: 1.5rem;
  width: 48px;
  height: 48px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.5rem;
  font-weight: 300;
  color: white;
  background: var(--studio-accent);
  border: none;
  border-radius: 50%;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
  cursor: pointer;
  transition: all 0.2s ease;
  z-index: 1000;
}

.aui-fab:hover {
  transform: scale(1.1);
  box-shadow: 0 6px 16px rgba(0, 0, 0, 0.2);
}

.aui-fab--open {
  background: var(--studio-text-secondary);
}

/* Chat Panel */
.aui-chat {
  position: fixed;
  bottom: 5rem;
  right: 1.5rem;
  width: 360px;
  max-width: calc(100vw - 3rem);
  max-height: 500px;
  display: flex;
  flex-direction: column;
  background: var(--studio-panel-bg);
  border: 1px solid var(--studio-border);
  border-radius: 12px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.12);
  z-index: 999;
  overflow: hidden;
  transition: box-shadow 0.15s ease;
}

.aui-chat--dragging {
  box-shadow: 0 12px 48px rgba(0, 0, 0, 0.2);
}

.aui-chat--minimized {
  max-height: none;
}

/* Chat Header */
.aui-chat__header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 0.875rem 1rem;
  background: var(--studio-quote-bg);
  border-bottom: 1px solid var(--studio-border);
  user-select: none;
}

.aui-chat__title {
  font-family: Georgia, serif;
  font-size: 1rem;
  font-weight: normal;
  color: var(--studio-text);
}

.aui-chat__header-actions {
  display: flex;
  align-items: center;
  gap: 0.25rem;
}

.aui-chat__minimize,
.aui-chat__close {
  width: 28px;
  height: 28px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.25rem;
  color: var(--studio-text-secondary);
  background: transparent;
  border: none;
  border-radius: 4px;
  cursor: pointer;
  transition: all 0.15s ease;
}

.aui-chat__minimize:hover,
.aui-chat__close:hover {
  background: var(--studio-hover);
  color: var(--studio-text);
}

/* Messages Area */
.aui-chat__messages {
  flex: 1;
  overflow-y: auto;
  padding: 1rem;
  display: flex;
  flex-direction: column;
  gap: 0.75rem;
  min-height: 200px;
  max-height: 320px;
}

/* Individual Message */
.aui-chat__message {
  padding: 0.75rem 1rem;
  border-radius: 12px;
  font-family: -apple-system, BlinkMacSystemFont, sans-serif;
  font-size: 0.875rem;
  line-height: 1.5;
}

.aui-chat__message p {
  margin: 0 0 0.5rem;
}

.aui-chat__message p:last-child {
  margin-bottom: 0;
}

.aui-chat__message ul,
.aui-chat__message ol {
  margin: 0.5rem 0;
  padding-left: 1.25rem;
}

.aui-chat__message li {
  margin-bottom: 0.25rem;
}

.aui-chat__message code {
  font-family: 'SF Mono', 'Monaco', monospace;
  font-size: 0.8125rem;
  background: rgba(0, 0, 0, 0.05);
  padding: 0.125rem 0.375rem;
  border-radius: 3px;
}

.aui-chat__message strong {
  font-weight: 600;
}

/* User message */
.aui-chat__message--user {
  background: var(--studio-accent);
  color: white;
  align-self: flex-end;
  max-width: 85%;
  border-bottom-right-radius: 4px;
}

/* Assistant message */
.aui-chat__message--assistant {
  background: var(--studio-quote-bg);
  color: var(--studio-text);
  align-self: flex-start;
  max-width: 85%;
  border-bottom-left-radius: 4px;
}

/* Loading indicator */
.aui-chat__message--loading {
  color: var(--studio-text-secondary);
}

.aui-chat__message--loading span {
  display: inline-block;
  animation: auiPulse 1.4s infinite ease-in-out both;
  letter-spacing: 0.25em;
}

@keyframes auiPulse {
  0%, 80%, 100% { opacity: 0.3; }
  40% { opacity: 1; }
}

/* Input Area */
.aui-chat__input-area {
  display: flex;
  gap: 0.5rem;
  padding: 0.75rem 1rem;
  background: var(--studio-quote-bg);
  border-top: 1px solid var(--studio-border);
}

.aui-chat__input {
  flex: 1;
  padding: 0.625rem 0.875rem;
  font-family: -apple-system, BlinkMacSystemFont, sans-serif;
  font-size: 0.875rem;
  color: var(--studio-text);
  background: var(--studio-panel-bg);
  border: 1px solid var(--studio-border);
  border-radius: 20px;
  outline: none;
  transition: border-color 0.15s ease;
}

.aui-chat__input:focus {
  border-color: var(--studio-accent);
}

.aui-chat__input::placeholder {
  color: var(--studio-text-secondary);
}

.aui-chat__input:disabled {
  opacity: 0.6;
}

.aui-chat__send {
  width: 36px;
  height: 36px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1rem;
  color: white;
  background: var(--studio-accent);
  border: none;
  border-radius: 50%;
  cursor: pointer;
  transition: all 0.15s ease;
}

.aui-chat__send:hover:not(:disabled) {
  background: #7a5c12;
}

.aui-chat__send:disabled {
  opacity: 0.4;
  cursor: not-allowed;
}

/* Mobile responsive */
@media (max-width: 480px) {
  .aui-fab {
    bottom: 1rem;
    right: 1rem;
    width: 44px;
    height: 44px;
    font-size: 1.25rem;
  }

  .aui-chat {
    bottom: 4rem;
    right: 1rem;
    left: 1rem;
    width: auto;
    max-height: 60vh;
  }
}

/* ═══════════════════════════════════════════════════════════════════
   AUI CHAT TAB - Tools Panel Integration
   ═══════════════════════════════════════════════════════════════════ */

.aui-chat-tab {
  display: flex;
  flex-direction: column;
  height: 100%;
  background: var(--studio-surface);
  border-radius: var(--radius-md, 0.5rem);
  overflow: hidden;
}

.aui-chat-tab__header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: var(--space-sm) var(--space-md);
  background: var(--studio-bg);
  border-bottom: 1px solid var(--studio-border);
}

.aui-chat-tab__title {
  display: flex;
  align-items: center;
  gap: var(--space-xs);
  font-weight: 500;
  color: var(--studio-text);
}

.aui-chat-tab__icon {
  color: var(--studio-accent);
  font-size: 1rem;
}

.aui-chat-tab__archive-badge {
  font-size: 0.5rem;
  color: var(--studio-accent);
  opacity: 0.8;
  animation: pulse-subtle 2s ease-in-out infinite;
}

@keyframes pulse-subtle {
  0%, 100% { opacity: 0.4; }
  50% { opacity: 1; }
}

.aui-chat-tab__actions {
  display: flex;
  align-items: center;
  gap: var(--space-xs);
}

.aui-chat-tab__settings-btn,
.aui-chat-tab__clear-btn,
.aui-chat-tab__stop-btn {
  width: 28px;
  height: 28px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: transparent;
  border: 1px solid transparent;
  border-radius: var(--radius-sm);
  color: var(--studio-text-secondary);
  cursor: pointer;
  font-size: 0.875rem;
  transition: all 0.15s ease;
}

.aui-chat-tab__settings-btn:hover,
.aui-chat-tab__clear-btn:hover {
  background: var(--studio-hover);
  color: var(--studio-text);
}

.aui-chat-tab__settings-btn.active {
  background: var(--studio-accent);
  color: white;
}

.aui-chat-tab__stop-btn {
  color: var(--studio-error, #ef4444);
}

.aui-chat-tab__stop-btn:hover {
  background: rgba(239, 68, 68, 0.1);
}

/* Settings panel */
.aui-chat-tab__settings {
  padding: var(--space-sm) var(--space-md);
  background: var(--studio-bg);
  border-bottom: 1px solid var(--studio-border);
  display: flex;
  flex-direction: column;
  gap: var(--space-xs);
}

.aui-chat-tab__setting {
  display: flex;
  align-items: center;
  gap: var(--space-sm);
  font-size: 0.8125rem;
  color: var(--studio-text-secondary);
  cursor: pointer;
}

.aui-chat-tab__setting input[type="checkbox"] {
  accent-color: var(--studio-accent);
}

.aui-chat-tab__setting-row {
  display: flex;
  align-items: center;
  justify-content: space-between;
  font-size: 0.8125rem;
  color: var(--studio-text-secondary);
}

.aui-chat-tab__setting-row select {
  background: var(--studio-surface);
  border: 1px solid var(--studio-border);
  border-radius: var(--radius-sm);
  padding: 2px 8px;
  color: var(--studio-text);
  font-size: 0.75rem;
}

/* Animation progress bar */
.aui-chat-tab__animation-bar {
  padding: var(--space-xs) var(--space-md);
  background: rgba(var(--studio-accent-rgb, 99, 102, 241), 0.1);
  border-bottom: 1px solid var(--studio-border);
  display: flex;
  align-items: center;
  gap: var(--space-sm);
}

.aui-chat-tab__animation-progress {
  flex: 1;
  height: 4px;
  background: var(--studio-border);
  border-radius: 2px;
  overflow: hidden;
}

.aui-chat-tab__animation-fill {
  height: 100%;
  background: var(--studio-accent);
  transition: width 0.3s ease;
}

.aui-chat-tab__animation-text {
  font-size: 0.6875rem;
  color: var(--studio-text-secondary);
  white-space: nowrap;
}

/* Messages */
.aui-chat-tab__messages {
  flex: 1;
  overflow-y: auto;
  padding: var(--space-md) var(--space-lg);
  display: flex;
  flex-direction: column;
  gap: var(--space-md);
}

.aui-chat-tab__message {
  padding: var(--space-md);
  border-radius: var(--radius-md);
  font-size: 0.875rem;
  line-height: 1.6;
}

.aui-chat-tab__message p {
  margin: 0 0 0.5em;
}

.aui-chat-tab__message p:last-child {
  margin-bottom: 0;
}

.aui-chat-tab__message--user {
  background: var(--studio-accent);
  color: white;
  align-self: flex-end;
  max-width: 85%;
}

.aui-chat-tab__message--assistant {
  background: var(--studio-hover);
  color: var(--studio-text);
  align-self: flex-start;
  max-width: 90%;
}

.aui-chat-tab__message--system {
  background: rgba(var(--studio-warning-rgb, 245, 158, 11), 0.1);
  color: var(--studio-text-secondary);
  align-self: center;
  font-size: 0.8125rem;
  text-align: center;
}

.aui-chat-tab__message--tool {
  background: transparent;
  padding: 0;
  align-self: stretch;
}

.aui-chat-tab__message--loading {
  background: var(--studio-hover);
  align-self: flex-start;
  padding: var(--space-md);
}

.aui-chat-tab__loading-dots {
  display: flex;
  gap: 4px;
}

.aui-chat-tab__loading-dots span {
  width: 6px;
  height: 6px;
  background: var(--studio-text-secondary);
  border-radius: 50%;
  animation: dot-bounce 1.4s ease-in-out infinite;
}

.aui-chat-tab__loading-dots span:nth-child(2) {
  animation-delay: 0.16s;
}

.aui-chat-tab__loading-dots span:nth-child(3) {
  animation-delay: 0.32s;
}

@keyframes dot-bounce {
  0%, 80%, 100% { transform: scale(1); opacity: 0.4; }
  40% { transform: scale(1.2); opacity: 1; }
}

/* Tool results */
.aui-chat-tab__tool-results {
  display: flex;
  flex-direction: column;
  gap: var(--space-sm);
}

.aui-chat-tab__tool-result {
  display: flex;
  gap: var(--space-sm);
  padding: var(--space-sm) var(--space-md);
  border-radius: var(--radius-md);
  background: var(--studio-bg);
  border: 1px solid var(--studio-border);
}

.aui-chat-tab__tool-result.success {
  border-left: 3px solid var(--studio-success, #10b981);
}

.aui-chat-tab__tool-result.error {
  border-left: 3px solid var(--studio-error, #ef4444);
}

.aui-chat-tab__tool-status {
  font-size: 1rem;
  flex-shrink: 0;
}

.aui-chat-tab__tool-result.success .aui-chat-tab__tool-status {
  color: var(--studio-success, #10b981);
}

.aui-chat-tab__tool-result.error .aui-chat-tab__tool-status {
  color: var(--studio-error, #ef4444);
}

.aui-chat-tab__tool-content {
  flex: 1;
  min-width: 0;
}

.aui-chat-tab__tool-message {
  font-size: 0.8125rem;
  color: var(--studio-text);
}

/* Teaching section */
.aui-chat-tab__teaching {
  margin-top: var(--space-sm);
  padding-top: var(--space-sm);
  border-top: 1px dashed var(--studio-border);
}

.aui-chat-tab__teaching-header {
  font-size: 0.75rem;
  font-weight: 500;
  color: var(--studio-text-secondary);
  margin-bottom: var(--space-xs);
}

.aui-chat-tab__teaching-steps {
  margin: 0;
  padding-left: 1.25rem;
  font-size: 0.75rem;
  color: var(--studio-text-secondary);
}

.aui-chat-tab__teaching-steps li {
  margin-bottom: 2px;
}

.aui-chat-tab__teaching-shortcut {
  font-size: 0.75rem;
  color: var(--studio-accent);
  margin-top: var(--space-xs);
}

/* Input area */
.aui-chat-tab__input-area {
  display: flex;
  gap: var(--space-sm);
  padding: var(--space-md);
  background: var(--studio-bg);
  border-top: 1px solid var(--studio-border);
}

.aui-chat-tab__input {
  flex: 1;
  padding: var(--space-sm) var(--space-md);
  background: var(--studio-surface);
  border: 1px solid var(--studio-border);
  border-radius: var(--radius-md);
  color: var(--studio-text);
  font-size: 0.875rem;
  outline: none;
  transition: border-color 0.15s ease;
  /* Textarea-specific styles */
  min-height: 44px;
  max-height: 200px;
  resize: none;
  overflow-y: auto;
  font-family: inherit;
  line-height: 1.5;
  white-space: pre-wrap;
}

.aui-chat-tab__input:focus {
  border-color: var(--studio-accent);
  box-shadow: 0 0 0 2px rgba(var(--studio-accent-rgb, 99, 102, 241), 0.1);
}

.aui-chat-tab__input::placeholder {
  color: var(--studio-text-tertiary);
}

.aui-chat-tab__send {
  width: 36px;
  height: 36px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: var(--studio-accent);
  border: none;
  border-radius: var(--radius-md);
  color: white;
  font-size: 1rem;
  cursor: pointer;
  transition: opacity 0.15s ease;
}

.aui-chat-tab__send:hover:not(:disabled) {
  opacity: 0.9;
}

.aui-chat-tab__send:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

/* Archive notice */
.aui-chat-tab__archive-notice {
  padding: var(--space-xs) var(--space-md);
  background: rgba(var(--studio-accent-rgb, 99, 102, 241), 0.05);
  text-align: center;
  font-size: 0.6875rem;
  color: var(--studio-text-tertiary);
}

/* ═══════════════════════════════════════════════════════════════════
   AUI ANIMATIONS - "Show Don't Tell" System
   ═══════════════════════════════════════════════════════════════════ */

/* Element highlight effect */
.aui-highlight {
  position: relative;
  outline: 2px solid var(--studio-accent) !important;
  outline-offset: 2px;
  animation: aui-pulse 1s ease-in-out infinite;
  z-index: 100;
}

@keyframes aui-pulse {
  0%, 100% {
    box-shadow: 0 0 0 0 rgba(var(--studio-accent-rgb, 99, 102, 241), 0.4);
  }
  50% {
    box-shadow: 0 0 0 8px rgba(var(--studio-accent-rgb, 99, 102, 241), 0);
  }
}

/* Typing effect */
.aui-typing {
  outline: 2px solid var(--studio-accent) !important;
  outline-offset: 1px;
  background: rgba(var(--studio-accent-rgb, 99, 102, 241), 0.05) !important;
}

/* Click target effect */
.aui-click-target {
  outline: 2px dashed var(--studio-accent) !important;
  outline-offset: 2px;
}

.aui-clicking {
  transform: scale(0.97);
  transition: transform 0.1s ease;
}

/* Toast container */
.aui-toast-container {
  position: fixed;
  bottom: 80px;
  left: 50%;
  transform: translateX(-50%);
  z-index: 10000;
  display: flex;
  flex-direction: column;
  gap: var(--space-sm);
  pointer-events: none;
}

/* Toast notification */
.aui-toast {
  display: flex;
  align-items: center;
  gap: var(--space-sm);
  padding: var(--space-sm) var(--space-md);
  background: var(--studio-surface);
  border: 1px solid var(--studio-border);
  border-radius: var(--radius-lg);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
  opacity: 0;
  transform: translateY(20px);
  transition: all 0.3s ease;
  pointer-events: auto;
}

.aui-toast--visible {
  opacity: 1;
  transform: translateY(0);
}

.aui-toast--hiding {
  opacity: 0;
  transform: translateY(-10px);
}

.aui-toast__icon {
  font-size: 1rem;
  flex-shrink: 0;
}

.aui-toast__message {
  font-size: 0.875rem;
  color: var(--studio-text);
  white-space: nowrap;
}

/* Dark mode adjustments */
[data-theme="dark"] .aui-chat-tab__tool-result {
  background: var(--studio-surface);
}

[data-theme="dark"] .aui-toast {
  background: var(--studio-bg);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
}

/* ═══════════════════════════════════════════════════════════════════
   LOGIN PAGE
   ═══════════════════════════════════════════════════════════════════ */

.login-page {
  position: fixed;
  inset: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  background: rgba(0, 0, 0, 0.6);
  backdrop-filter: blur(4px);
  z-index: 1000;
}

.login-card {
  position: relative;
  width: 100%;
  max-width: 400px;
  margin: 1rem;
  padding: 2rem;
  background: var(--studio-surface);
  border-radius: 12px;
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
}

.login-close {
  position: absolute;
  top: 1rem;
  right: 1rem;
  width: 32px;
  height: 32px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: transparent;
  border: none;
  font-size: 1.25rem;
  color: var(--studio-text-secondary);
  cursor: pointer;
  border-radius: 4px;
}

.login-close:hover {
  background: var(--studio-hover);
  color: var(--studio-text);
}

.login-header {
  text-align: center;
  margin-bottom: 1.5rem;
}

.login-title {
  font-size: 1.5rem;
  font-weight: 600;
  color: var(--studio-text);
  margin: 0 0 0.5rem;
}

.login-subtitle {
  font-size: 0.875rem;
  color: var(--studio-text-secondary);
  margin: 0;
}

/* OAuth buttons */
.login-oauth {
  display: flex;
  flex-direction: column;
  gap: 0.75rem;
  margin-bottom: 1.5rem;
}

.login-oauth-btn {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 0.75rem;
  width: 100%;
  padding: 0.75rem 1rem;
  font-family: inherit;
  font-size: 0.875rem;
  font-weight: 500;
  color: var(--studio-text);
  background: var(--studio-panel-bg);
  border: 1px solid var(--studio-border);
  border-radius: 6px;
  cursor: pointer;
  transition: all 0.15s ease;
}

.login-oauth-btn:hover:not(:disabled) {
  background: var(--studio-hover);
  border-color: var(--studio-accent);
}

.login-oauth-btn:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

.login-oauth-btn--google:hover:not(:disabled) {
  border-color: #4285F4;
}

.login-oauth-btn--github:hover:not(:disabled) {
  border-color: #333;
}

.login-oauth-btn--discord:hover:not(:disabled) {
  border-color: #5865F2;
}

/* Divider */
.login-divider {
  display: flex;
  align-items: center;
  gap: 1rem;
  margin-bottom: 1.5rem;
  color: var(--studio-text-secondary);
  font-size: 0.75rem;
  text-transform: uppercase;
}

.login-divider::before,
.login-divider::after {
  content: '';
  flex: 1;
  height: 1px;
  background: var(--studio-border);
}

/* Form */
.login-form {
  display: flex;
  flex-direction: column;
  gap: 1rem;
}

.login-field {
  display: flex;
  flex-direction: column;
  gap: 0.375rem;
}

.login-field label {
  font-size: 0.8125rem;
  font-weight: 500;
  color: var(--studio-text);
}

.login-field input {
  width: 100%;
  padding: 0.75rem;
  font-family: inherit;
  font-size: 0.875rem;
  color: var(--studio-text);
  background: var(--studio-panel-bg);
  border: 1px solid var(--studio-border);
  border-radius: 6px;
  outline: none;
  transition: border-color 0.15s ease;
}

.login-field input:focus {
  border-color: var(--studio-accent);
}

.login-field input::placeholder {
  color: var(--studio-text-tertiary);
}

.login-error {
  padding: 0.75rem;
  font-size: 0.8125rem;
  color: #dc3545;
  background: rgba(220, 53, 69, 0.1);
  border: 1px solid rgba(220, 53, 69, 0.2);
  border-radius: 6px;
}

.login-submit {
  width: 100%;
  padding: 0.875rem;
  font-family: inherit;
  font-size: 0.9375rem;
  font-weight: 600;
  color: white;
  background: linear-gradient(135deg, var(--studio-accent), #8b6914);
  border: none;
  border-radius: 6px;
  cursor: pointer;
  transition: all 0.15s ease;
}

.login-submit:hover:not(:disabled) {
  background: linear-gradient(135deg, #8b6914, var(--studio-accent));
  transform: translateY(-1px);
}

.login-submit:disabled {
  opacity: 0.6;
  cursor: not-allowed;
  transform: none;
}

/* Toggle */
.login-toggle {
  margin-top: 1.5rem;
  text-align: center;
  font-size: 0.8125rem;
  color: var(--studio-text-secondary);
}

.login-toggle button {
  background: none;
  border: none;
  color: var(--studio-accent);
  font-weight: 500;
  cursor: pointer;
}

.login-toggle button:hover {
  text-decoration: underline;
}

/* ═══════════════════════════════════════════════════════════════════
   LOGIN PROMPT MODAL
   Shown when authentication is required for an action
   ═══════════════════════════════════════════════════════════════════ */

.login-prompt-modal {
  position: fixed;
  inset: 0;
  z-index: 2000;
  display: flex;
  align-items: center;
  justify-content: center;
}

.login-prompt-modal__backdrop {
  position: absolute;
  inset: 0;
  background: rgba(0, 0, 0, 0.6);
  backdrop-filter: blur(4px);
}

.login-prompt-modal__content {
  position: relative;
  z-index: 1;
  display: flex;
  flex-direction: column;
  align-items: center;
  animation: modal-appear 0.2s ease-out;
}

@keyframes modal-appear {
  from {
    opacity: 0;
    transform: scale(0.95) translateY(-10px);
  }
  to {
    opacity: 1;
    transform: scale(1) translateY(0);
  }
}

.login-prompt-modal__message {
  margin-bottom: 1rem;
  padding: 0.75rem 1.5rem;
  background: var(--studio-panel-bg);
  border: 1px solid var(--studio-border);
  border-radius: 8px;
  color: var(--studio-text);
  font-size: 0.9375rem;
  text-align: center;
  max-width: 400px;
}

/* Override login-page positioning when inside modal */
.login-prompt-modal .login-page {
  position: relative;
  inset: auto;
  background: transparent;
  backdrop-filter: none;
}

/* ═══════════════════════════════════════════════════════════════════
   AUTH UI IN TOPBAR
   ═══════════════════════════════════════════════════════════════════ */

.studio-topbar__user {
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

.studio-topbar__tier {
  font-size: 0.6875rem;
  font-weight: 600;
  text-transform: uppercase;
  padding: 0.25rem 0.5rem;
  background: var(--studio-accent);
  color: white;
  border-radius: 3px;
}

.studio-topbar__btn--signin {
  background: var(--studio-accent) !important;
  color: white !important;
}

.studio-topbar__btn--signin:hover {
  background: #7a5c12 !important;
}

.studio-topbar__btn--user {
  font-size: 0.75rem;
  opacity: 0.7;
}

.studio-topbar__btn--user:hover {
  opacity: 1;
}

/* ═══════════════════════════════════════════════════════════════════
   USER DROPDOWN
   ═══════════════════════════════════════════════════════════════════ */

.user-dropdown {
  position: relative;
}

.user-dropdown__menu {
  position: absolute;
  top: 100%;
  right: 0;
  margin-top: var(--space-xs, 0.25rem);
  min-width: 180px;
  background: var(--studio-panel-bg, #faf8f3);
  border: 1px solid var(--studio-border, #d5c9b4);
  border-radius: var(--radius-md, 0.5rem);
  box-shadow: 0 4px 16px rgba(0, 0, 0, 0.15);
  z-index: 1000;
  overflow: hidden;
}

.user-dropdown__header {
  padding: var(--space-sm, 0.5rem) var(--space-md, 1rem);
  border-bottom: 1px solid var(--studio-border, #d5c9b4);
  background: var(--studio-bg-secondary, #f5f1e9);
}

.user-dropdown__email {
  font-size: 0.75rem;
  color: var(--studio-text-secondary, #5c4f3d);
  word-break: break-all;
}

.user-dropdown__item {
  display: block;
  width: 100%;
  padding: var(--space-sm, 0.5rem) var(--space-md, 1rem);
  border: none;
  background: none;
  text-align: left;
  font-size: 0.875rem;
  color: var(--studio-text, #3d2e1c);
  cursor: pointer;
  transition: background-color 0.15s ease;
}

.user-dropdown__item:hover {
  background: var(--studio-hover, rgba(0, 0, 0, 0.05));
}

.user-dropdown__item--danger {
  color: var(--color-error, #dc2626);
}

.user-dropdown__item--danger:hover {
  background: rgba(220, 38, 38, 0.1);
}

.auth-callback {
  display: flex;
  align-items: center;
  justify-content: center;
  min-height: 100vh;
  font-size: 1.125rem;
  color: var(--studio-text-secondary);
}

/* ═══════════════════════════════════════════════════════════════════
   THEME SYSTEM - Light, Dark, Sepia (default)
   ═══════════════════════════════════════════════════════════════════ */

/* Root-level theme variables for portaled elements (modals, tooltips) */
:root,
[data-theme="sepia"] {
  --studio-bg: #f8f4e9;
  --studio-bg-rgb: 248, 244, 233;
  --studio-text: #433422;
  --studio-text-secondary: #6b5c4a;
  --studio-text-tertiary: #8a7a66;
  --studio-accent: #8b6914;
  --studio-accent-hover: #7a5c12;
  --studio-quote-bg: #f0e8d6;
  --studio-border: #d4c4a8;
  --studio-panel-bg: #fffdf8;
  --studio-panel-bg-rgb: 255, 253, 248;
  --studio-hover: rgba(139, 105, 20, 0.1);
  --studio-surface: #fdfbf7;
}

[data-theme="light"] {
  --studio-bg: #ffffff;
  --studio-bg-rgb: 255, 255, 255;
  --studio-text: #1a1a2e;
  --studio-text-secondary: #4a4a5c;
  --studio-text-tertiary: #7a7a8c;
  --studio-accent: #2563eb;
  --studio-accent-hover: #1d4ed8;
  --studio-quote-bg: #f5f5f7;
  --studio-border: #e0e0e5;
  --studio-panel-bg: #ffffff;
  --studio-panel-bg-rgb: 255, 255, 255;
  --studio-hover: rgba(37, 99, 235, 0.08);
  --studio-surface: #fafafa;
}

[data-theme="dark"] {
  --studio-bg: #0f0f14;
  --studio-bg-rgb: 15, 15, 20;
  --studio-text: #e8e8ed;
  --studio-text-secondary: #a0a0b0;
  --studio-text-tertiary: #6b6b7a;
  --studio-accent: #60a5fa;
  --studio-accent-hover: #93c5fd;
  --studio-quote-bg: #1a1a24;
  --studio-border: #2a2a38;
  --studio-panel-bg: #16161d;
  --studio-panel-bg-rgb: 22, 22, 29;
  --studio-hover: rgba(96, 165, 250, 0.12);
  --studio-surface: #1a1a24;
}

/* Base theme variables (Sepia - default) - for .studio scope */
.studio,
[data-theme="sepia"] .studio {
  --studio-bg: #f8f4e9;
  --studio-bg-rgb: 248, 244, 233;
  --studio-text: #433422;
  --studio-text-secondary: #6b5c4a;
  --studio-text-tertiary: #8a7a66;
  --studio-accent: #8b6914;
  --studio-accent-hover: #7a5c12;
  --studio-quote-bg: #f0e8d6;
  --studio-border: #d4c4a8;
  --studio-panel-bg: #fffdf8;
  --studio-panel-bg-rgb: 255, 253, 248;
  --studio-hover: rgba(139, 105, 20, 0.1);
  --studio-surface: #fdfbf7;
}

/* Light theme */
[data-theme="light"] .studio {
  --studio-bg: #ffffff;
  --studio-bg-rgb: 255, 255, 255;
  --studio-text: #1a1a2e;
  --studio-text-secondary: #4a4a5c;
  --studio-text-tertiary: #7a7a8c;
  --studio-accent: #2563eb;
  --studio-accent-hover: #1d4ed8;
  --studio-quote-bg: #f5f5f7;
  --studio-border: #e0e0e5;
  --studio-panel-bg: #ffffff;
  --studio-panel-bg-rgb: 255, 255, 255;
  --studio-hover: rgba(37, 99, 235, 0.08);
  --studio-surface: #fafafa;
}

/* Dark theme */
[data-theme="dark"] .studio {
  --studio-bg: #0f0f14;
  --studio-bg-rgb: 15, 15, 20;
  --studio-text: #e8e8ed;
  --studio-text-secondary: #a0a0b0;
  --studio-text-tertiary: #6b6b7a;
  --studio-accent: #60a5fa;
  --studio-accent-hover: #93c5fd;
  --studio-quote-bg: #1a1a24;
  --studio-border: #2a2a38;
  --studio-panel-bg: #16161d;
  --studio-panel-bg-rgb: 22, 22, 29;
  --studio-hover: rgba(96, 165, 250, 0.12);
  --studio-surface: #1a1a24;
}

/* Theme transition */
.studio {
  transition:
    background-color 0.3s ease,
    color 0.3s ease;
}

/* Font family variations */
[data-font="sans-serif"] .studio {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
}

[data-font="serif"] .studio {
  font-family: Georgia, 'Times New Roman', serif;
}

[data-font="mono"] .studio {
  font-family: 'JetBrains Mono', 'Fira Code', 'SF Mono', Consolas, monospace;
}

/* Font size variations */
[data-size="small"] .studio {
  font-size: 14px;
}

[data-size="medium"] .studio {
  font-size: 16px;
}

[data-size="large"] .studio {
  font-size: 18px;
}

/* Line height variations */
[data-spacing="tight"] .studio {
  --studio-line-height: 1.4;
}

[data-spacing="normal"] .studio {
  --studio-line-height: 1.6;
}

[data-spacing="relaxed"] .studio {
  --studio-line-height: 1.8;
}

.workspace__article p {
  line-height: var(--studio-line-height, 1.7);
}

/* Color accent variations */
[data-accent="amber"] .studio {
  --studio-accent: #8b6914;
  --studio-accent-hover: #7a5c12;
}

[data-accent="blue"] .studio {
  --studio-accent: #2563eb;
  --studio-accent-hover: #1d4ed8;
}

[data-accent="green"] .studio {
  --studio-accent: #16a34a;
  --studio-accent-hover: #15803d;
}

[data-accent="purple"] .studio {
  --studio-accent: #9333ea;
  --studio-accent-hover: #7e22ce;
}

/* ═══════════════════════════════════════════════════════════════════
   THEME TOGGLE BUTTON
   ═══════════════════════════════════════════════════════════════════ */

.theme-toggle {
  display: flex;
  align-items: center;
  gap: 0.25rem;
  padding: 0.25rem;
  background: var(--studio-quote-bg);
  border: 1px solid var(--studio-border);
  border-radius: 6px;
}

.theme-toggle__btn {
  width: 28px;
  height: 28px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 0.875rem;
  color: var(--studio-text-secondary);
  background: transparent;
  border: none;
  border-radius: 4px;
  cursor: pointer;
  transition: all 0.15s ease;
}

.theme-toggle__btn:hover {
  background: var(--studio-hover);
  color: var(--studio-text);
}

.theme-toggle__btn--active {
  background: var(--studio-panel-bg);
  color: var(--studio-accent);
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
}

/* ═══════════════════════════════════════════════════════════════════
   THEME SETTINGS MODAL
   ═══════════════════════════════════════════════════════════════════ */

.theme-modal {
  position: fixed;
  inset: 0;
  display: flex;
  align-items: flex-start;
  justify-content: center;
  padding-top: 4rem; /* Below top bar */
  background: rgba(0, 0, 0, 0.5);
  backdrop-filter: blur(4px);
  z-index: 1000;
  overflow-y: auto;
}

.theme-modal__content {
  width: 100%;
  max-width: 400px;
  max-height: 80vh;
  margin: 1rem;
  padding: 1.5rem;
  background: var(--studio-panel-bg);
  border: 1px solid var(--studio-border);
  border-radius: 12px;
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.2);
  overflow-y: auto;
}

.theme-modal__header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 1.5rem;
}

.theme-modal__title {
  font-family: Georgia, serif;
  font-size: 1.25rem;
  font-weight: normal;
  color: var(--studio-text);
  margin: 0;
}

.theme-modal__close {
  width: 32px;
  height: 32px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.25rem;
  color: var(--studio-text-secondary);
  background: transparent;
  border: none;
  border-radius: 4px;
  cursor: pointer;
  transition: all 0.15s ease;
}

.theme-modal__close:hover {
  background: var(--studio-hover);
  color: var(--studio-text);
}

.theme-modal__section {
  margin-bottom: 1.5rem;
}

.theme-modal__section:last-child {
  margin-bottom: 0;
}

.theme-modal__label {
  display: block;
  font-family: -apple-system, BlinkMacSystemFont, sans-serif;
  font-size: 0.6875rem;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.1em;
  color: var(--studio-text-secondary);
  margin-bottom: 0.75rem;
}

.theme-modal__options {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 0.5rem;
}

.theme-modal__options--4 {
  grid-template-columns: repeat(4, 1fr);
}

.theme-modal__option {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 0.375rem;
  padding: 0.75rem 0.5rem;
  font-family: -apple-system, BlinkMacSystemFont, sans-serif;
  font-size: 0.75rem;
  color: var(--studio-text-secondary);
  background: var(--studio-panel-bg);
  border: 2px solid var(--studio-border);
  border-radius: 8px;
  cursor: pointer;
  transition: all 0.15s ease;
}

.theme-modal__option:hover {
  background: var(--studio-hover);
  border-color: var(--studio-accent);
}

.theme-modal__option--active {
  border-color: var(--studio-accent);
  background: var(--studio-hover);
}

.theme-modal__option-icon {
  font-size: 1.25rem;
}

.theme-modal__option-label {
  font-weight: 500;
  color: var(--studio-text);
}

/* Color swatches */
.theme-modal__swatch {
  width: 24px;
  height: 24px;
  border-radius: 50%;
  border: 2px solid var(--studio-border);
}

.theme-modal__option--active .theme-modal__swatch {
  border-color: var(--studio-accent);
  box-shadow: 0 0 0 2px var(--studio-hover);
}

.theme-modal__swatch--amber { background: #8b6914; }
.theme-modal__swatch--blue { background: #2563eb; }
.theme-modal__swatch--green { background: #16a34a; }
.theme-modal__swatch--purple { background: #9333ea; }

/* ═══════════════════════════════════════════════════════════════════
   ARCHIVE ICON TAB BAR
   ═══════════════════════════════════════════════════════════════════ */

.archive-tabs {
  display: flex;
  flex-direction: column;
  height: 100%;
  min-height: 0;
  margin: -1rem;
  width: calc(100% + 2rem);
}

.archive-tabs__nav {
  display: flex;
  border-bottom: 1px solid var(--studio-border);
  background: var(--studio-quote-bg);
  overflow-x: auto;
  overflow-y: hidden;
  scrollbar-width: thin;
  scrollbar-color: var(--studio-border) transparent;
}

.archive-tabs__nav::-webkit-scrollbar {
  height: 4px;
}

.archive-tabs__nav::-webkit-scrollbar-track {
  background: transparent;
}

.archive-tabs__nav::-webkit-scrollbar-thumb {
  background: var(--studio-border);
  border-radius: 2px;
}

.archive-tabs__tab {
  flex: 0 0 auto;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 0.125rem;
  padding: 0.625rem 0.625rem 0.5rem;
  min-width: 56px;
  font-family: -apple-system, BlinkMacSystemFont, sans-serif;
  background: transparent;
  border: none;
  border-bottom: 2px solid transparent;
  cursor: pointer;
  transition: all 0.2s ease;
  margin-bottom: -1px;
}

.archive-tabs__tab:hover {
  background: var(--studio-hover);
}

.archive-tabs__tab--active {
  background: var(--studio-panel-bg);
  border-bottom-color: var(--studio-accent);
}

.archive-tabs__tab-icon {
  font-size: 1.125rem;
  color: var(--studio-text-secondary);
  transition: color 0.2s ease;
}

.archive-tabs__tab--active .archive-tabs__tab-icon {
  color: var(--studio-accent);
}

.archive-tabs__tab-label {
  font-size: 0.5625rem;
  font-weight: 500;
  text-transform: uppercase;
  letter-spacing: 0.05em;
  color: var(--studio-text-secondary);
}

.archive-tabs__tab--active .archive-tabs__tab-label {
  color: var(--studio-text);
}

.archive-tabs__content {
  flex: 1;
  overflow-y: auto;
  min-height: 0;
  padding: 1rem;
}

/* ═══════════════════════════════════════════════════════════════════
   MEDIA GALLERY
   ═══════════════════════════════════════════════════════════════════ */

.media-gallery {
  display: flex;
  flex-direction: column;
  gap: 1rem;
}

.media-gallery__grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
  gap: 0.5rem;
}

.media-gallery__item {
  position: relative;
  aspect-ratio: 1;
  border-radius: 6px;
  overflow: hidden;
  cursor: pointer;
  background: var(--studio-quote-bg);
  border: 1px solid var(--studio-border);
  transition: all 0.15s ease;
}

.media-gallery__item:hover {
  border-color: var(--studio-accent);
  transform: scale(1.02);
}

.media-gallery__item img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.media-gallery__item--audio {
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.5rem;
  color: var(--studio-text-secondary);
}

.media-gallery__item-overlay {
  position: absolute;
  bottom: 0;
  left: 0;
  right: 0;
  padding: 0.375rem;
  background: linear-gradient(transparent, rgba(0, 0, 0, 0.7));
  font-size: 0.625rem;
  color: white;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  opacity: 0;
  transition: opacity 0.15s ease;
}

.media-gallery__item:hover .media-gallery__item-overlay {
  opacity: 1;
}

/* Lightbox */
.lightbox {
  position: fixed;
  inset: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  background: rgba(0, 0, 0, 0.9);
  z-index: 1000;
}

.lightbox__content {
  position: relative;
  max-width: 90vw;
  max-height: 90vh;
}

.lightbox__image {
  max-width: 100%;
  max-height: 90vh;
  object-fit: contain;
}

.lightbox__close {
  position: absolute;
  top: -2rem;
  right: 0;
  width: 32px;
  height: 32px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.5rem;
  color: white;
  background: transparent;
  border: none;
  cursor: pointer;
  opacity: 0.7;
  transition: opacity 0.15s ease;
}

.lightbox__close:hover {
  opacity: 1;
}

.lightbox__nav {
  position: absolute;
  top: 50%;
  transform: translateY(-50%);
  width: 48px;
  height: 48px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.5rem;
  color: white;
  background: rgba(0, 0, 0, 0.5);
  border: none;
  border-radius: 50%;
  cursor: pointer;
  opacity: 0.7;
  transition: opacity 0.15s ease;
}

.lightbox__nav:hover {
  opacity: 1;
}

.lightbox__nav--prev {
  left: 1rem;
}

.lightbox__nav--next {
  right: 1rem;
}

.lightbox__counter {
  position: absolute;
  bottom: -2rem;
  left: 50%;
  transform: translateX(-50%);
  font-size: 0.875rem;
  color: white;
  opacity: 0.7;
}

.lightbox__info {
  position: absolute;
  bottom: -3.5rem;
  left: 50%;
  transform: translateX(-50%);
  text-align: center;
  max-width: 80%;
}

.lightbox__title {
  font-size: 0.875rem;
  color: white;
  opacity: 0.9;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  display: block;
  max-width: 400px;
}

.media-gallery__load-more {
  display: flex;
  justify-content: center;
  padding: 1rem 0;
}

.media-gallery__item-title {
  font-size: 0.75rem;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

/* ═══════════════════════════════════════════════════════════════════
   AUDIO PLAYER
   ═══════════════════════════════════════════════════════════════════ */

.audio-player {
  display: flex;
  align-items: center;
  gap: 0.75rem;
  padding: 0.75rem 1rem;
  background: var(--studio-quote-bg);
  border: 1px solid var(--studio-border);
  border-radius: 8px;
}

.audio-player__btn {
  width: 36px;
  height: 36px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1rem;
  color: white;
  background: var(--studio-accent);
  border: none;
  border-radius: 50%;
  cursor: pointer;
  transition: all 0.15s ease;
}

.audio-player__btn:hover {
  background: var(--studio-accent-hover);
}

.audio-player__info {
  flex: 1;
  min-width: 0;
}

.audio-player__title {
  font-size: 0.875rem;
  font-weight: 500;
  color: var(--studio-text);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.audio-player__time {
  font-size: 0.75rem;
  color: var(--studio-text-secondary);
}

.audio-player__progress {
  flex: 1;
  height: 4px;
  background: var(--studio-border);
  border-radius: 2px;
  cursor: pointer;
  overflow: hidden;
}

.audio-player__progress-fill {
  height: 100%;
  background: var(--studio-accent);
  transition: width 0.1s linear;
}

/* ═══════════════════════════════════════════════════════════════════
   IMPORT TAB
   ═══════════════════════════════════════════════════════════════════ */

.import-tab {
  display: flex;
  flex-direction: column;
  gap: 1rem;
}

.import-dropzone {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: 0.75rem;
  padding: 2rem 1rem;
  background: var(--studio-panel-bg);
  border: 2px dashed var(--studio-border);
  border-radius: 8px;
  cursor: pointer;
  transition: all 0.2s ease;
}

.import-dropzone:hover,
.import-dropzone--active {
  border-color: var(--studio-accent);
  background: var(--studio-hover);
}

.import-dropzone__icon {
  font-size: 2rem;
  color: var(--studio-text-secondary);
}

.import-dropzone__text {
  font-size: 0.875rem;
  color: var(--studio-text);
  text-align: center;
}

.import-dropzone__hint {
  font-size: 0.75rem;
  color: var(--studio-text-secondary);
}

/* Indexed Archives */
.indexed-archives {
  margin-bottom: 1rem;
}

.indexed-archives__list {
  display: flex;
  flex-direction: column;
  gap: 0.375rem;
}

.indexed-archive {
  display: flex;
  align-items: center;
  background: var(--studio-panel-bg);
  border: 1px solid var(--studio-border);
  border-radius: 6px;
  overflow: hidden;
}

.indexed-archive--active {
  border-color: var(--studio-accent);
  background: var(--studio-hover);
}

.indexed-archive__main {
  flex: 1;
  display: flex;
  align-items: center;
  gap: 0.5rem;
  padding: 0.625rem 0.75rem;
  background: none;
  border: none;
  text-align: left;
  cursor: pointer;
  transition: background 0.15s ease;
}

.indexed-archive__main:hover:not(:disabled) {
  background: var(--studio-hover);
}

.indexed-archive__main:disabled {
  cursor: wait;
  opacity: 0.7;
}

.indexed-archive__icon {
  font-size: 1rem;
  width: 1.5rem;
  text-align: center;
  flex-shrink: 0;
}

.indexed-archive__info {
  flex: 1;
  min-width: 0;
  display: flex;
  flex-direction: column;
  gap: 0.125rem;
}

.indexed-archive__name {
  font-size: 0.8125rem;
  font-weight: 500;
  color: var(--studio-text);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.indexed-archive__meta {
  font-size: 0.6875rem;
  color: var(--studio-text-secondary);
}

.indexed-archive__remove {
  padding: 0.5rem 0.75rem;
  background: none;
  border: none;
  border-left: 1px solid var(--studio-border);
  color: var(--studio-text-secondary);
  font-size: 1rem;
  cursor: pointer;
  transition: all 0.15s ease;
}

.indexed-archive__remove:hover {
  background: rgba(220, 38, 38, 0.1);
  color: #dc2626;
}

.import-types {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 0.5rem;
}

.import-type {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  padding: 0.75rem;
  background: var(--studio-panel-bg);
  border: 1px solid var(--studio-border);
  border-radius: 6px;
  cursor: pointer;
  transition: all 0.15s ease;
}

.import-type:hover {
  border-color: var(--studio-accent);
  background: var(--studio-hover);
}

.import-type__icon {
  font-size: 1.25rem;
}

.import-type__label {
  font-size: 0.8125rem;
  font-weight: 500;
  color: var(--studio-text);
}

.import-type--selected {
  border-color: var(--studio-accent);
  background: var(--studio-hover);
}

.import-status {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  padding: 0.75rem;
  margin: 0.5rem 0;
  background: var(--studio-quote-bg);
  border-radius: 6px;
  font-size: 0.875rem;
  color: var(--studio-text);
}

.import-status--error {
  background: rgba(220, 38, 38, 0.1);
  color: #dc2626;
}

.import-status__spinner {
  animation: spin 1s linear infinite;
}

@keyframes spin {
  from { transform: rotate(0deg); }
  to { transform: rotate(360deg); }
}

.import-status__text {
  flex: 1;
}

.import-actions {
  display: flex;
  gap: 0.5rem;
  margin-top: 0.5rem;
}

.import-section-label {
  display: block;
  margin: 0.75rem 0 0.5rem;
  font-size: 0.75rem;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.05em;
  color: var(--studio-text-secondary);
}

.import-paste {
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
}

.import-paste__textarea {
  width: 100%;
  min-height: 150px;
  padding: 0.75rem;
  font-family: 'JetBrains Mono', 'Fira Code', monospace;
  font-size: 0.8125rem;
  line-height: 1.5;
  color: var(--studio-text);
  background: var(--studio-panel-bg);
  border: 1px solid var(--studio-border);
  border-radius: 6px;
  resize: vertical;
}

.import-paste__textarea:focus {
  outline: none;
  border-color: var(--studio-accent);
}

.import-paste__textarea::placeholder {
  color: var(--studio-text-tertiary);
}

/* ═══════════════════════════════════════════════════════════════════
   BOOKS TAB
   ═══════════════════════════════════════════════════════════════════ */

.books-list {
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
}

.book-card {
  display: flex;
  align-items: flex-start;
  gap: 0.75rem;
  padding: 0.875rem;
  background: var(--studio-panel-bg);
  border: 1px solid var(--studio-border);
  border-radius: 8px;
  cursor: pointer;
  transition: all 0.15s ease;
}

.book-card:hover {
  border-color: var(--studio-accent);
  background: var(--studio-hover);
  transform: translateY(-1px);
  box-shadow: var(--shadow-small, 0 1px 3px rgba(0, 0, 0, 0.1));
}

.book-card:focus-visible {
  outline: none;
  border-color: var(--color-border-focus, var(--studio-accent));
  box-shadow: var(--shadow-focus, 0 0 0 3px rgba(59, 130, 246, 0.3));
}

.book-card:active {
  transform: translateY(0);
  box-shadow: none;
}

.book-card__cover {
  width: 48px;
  height: 64px;
  background: var(--studio-quote-bg);
  border-radius: 4px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.25rem;
  color: var(--studio-text-secondary);
}

.book-card__info {
  flex: 1;
  min-width: 0;
}

.book-card__title {
  font-size: 0.9375rem;
  font-weight: 500;
  color: var(--studio-text);
  margin-bottom: 0.25rem;
}

.book-card__meta {
  font-size: 0.75rem;
  color: var(--studio-text-secondary);
}

.book-card__status {
  font-size: 0.625rem;
  font-weight: 600;
  text-transform: uppercase;
  padding: 0.25rem 0.5rem;
  border-radius: 3px;
}

.book-card__status--draft {
  background: rgba(107, 114, 128, 0.15);
  color: #6b7280;
}

.book-card__status--building {
  background: rgba(245, 158, 11, 0.15);
  color: #d97706;
}

.book-card__status--complete {
  background: rgba(34, 197, 94, 0.15);
  color: #16a34a;
}

.book-card__status--harvesting {
  background: rgba(59, 130, 246, 0.15);
  color: #3b82f6;
}

.book-card__status--curating {
  background: rgba(245, 158, 11, 0.15);
  color: #d97706;
}

.book-card__status--drafting {
  background: rgba(99, 102, 241, 0.15);
  color: #6366f1;
}

.book-card__status--mastering {
  background: rgba(34, 197, 94, 0.15);
  color: #16a34a;
}

.book-card--project {
  border-left: 3px solid var(--studio-accent);
}

.book-card__pipeline {
  display: flex;
  align-items: center;
  gap: 0.25rem;
  margin-top: 0.375rem;
  font-size: 0.6875rem;
  color: var(--studio-text-tertiary);
}

.pipeline-step {
  padding: 0.125rem 0.375rem;
  background: var(--studio-quote-bg);
  border-radius: 3px;
}

.pipeline-arrow {
  color: var(--studio-text-tertiary);
}

.books-section {
  margin-top: 0.5rem;
}

.books-section__title {
  font-size: 0.75rem;
  font-weight: 600;
  color: var(--studio-text-secondary);
  text-transform: uppercase;
  letter-spacing: 0.05em;
  margin: 0.75rem 0 0.5rem;
  padding-left: 0.25rem;
}

/* ═══════════════════════════════════════════════════════════════════
   BOOK PROJECT DETAIL VIEW
   Sources, Thinking, Drafts tabs
   ═══════════════════════════════════════════════════════════════════ */

.book-project {
  display: flex;
  flex-direction: column;
  height: 100%;
  overflow: hidden;
  background: var(--studio-panel-bg);
}

.book-project__header {
  display: flex;
  align-items: center;
  gap: 0.75rem;
  padding: 0.75rem 1rem;
  border-bottom: 1px solid var(--studio-border);
  background: var(--studio-surface);
}

.book-project__back {
  padding: 0.375rem 0.625rem;
  background: transparent;
  border: 1px solid var(--studio-border);
  border-radius: 4px;
  font-size: 0.8125rem;
  color: var(--studio-text-secondary);
  cursor: pointer;
}

.book-project__back:hover {
  background: var(--studio-hover);
  color: var(--studio-text);
}

.book-project__title-group {
  flex: 1;
}

.book-project__title {
  margin: 0;
  font-size: 1.125rem;
  font-weight: 600;
  color: var(--studio-text);
}

.book-project__subtitle {
  font-size: 0.8125rem;
  color: var(--studio-text-secondary);
}

.book-project__status {
  padding: 0.25rem 0.625rem;
  border-radius: 12px;
  font-size: 0.6875rem;
  font-weight: 600;
  text-transform: uppercase;
  color: white;
}

.book-project__stats {
  display: flex;
  gap: 1rem;
  padding: 0.5rem 1rem;
  border-bottom: 1px solid var(--studio-border);
  font-size: 0.75rem;
  color: var(--studio-text-secondary);
}

.book-project__tabs {
  display: flex;
  gap: 0.25rem;
  padding: 0.5rem 1rem;
  border-bottom: 1px solid var(--studio-border);
  background: var(--studio-surface);
}

.book-project__tab {
  display: flex;
  align-items: center;
  gap: 0.375rem;
  padding: 0.5rem 0.875rem;
  background: transparent;
  border: none;
  border-radius: 6px;
  font-size: 0.8125rem;
  font-weight: 500;
  color: var(--studio-text-secondary);
  cursor: pointer;
  transition: all 0.15s ease;
}

.book-project__tab:hover {
  background: var(--studio-hover);
  color: var(--studio-text);
}

.book-project__tab.active {
  background: var(--studio-accent);
  color: white;
}

.book-project__tab .tab-icon {
  font-size: 1rem;
}

.book-project__content {
  flex: 1;
  overflow-y: auto;
}

/* ─────────────────────────────────────────────────────────────────
   SOURCES TAB
   ───────────────────────────────────────────────────────────────── */

.sources-tab {
  padding: 0.75rem;
}

.sources-tab__filters {
  display: flex;
  align-items: center;
  gap: 1rem;
  padding: 0.5rem 0;
  margin-bottom: 0.75rem;
}

.filter-group {
  display: flex;
  align-items: center;
  gap: 0.375rem;
}

.filter-group label {
  font-size: 0.75rem;
  color: var(--studio-text-secondary);
}

.filter-group select {
  padding: 0.25rem 0.5rem;
  background: var(--studio-surface);
  border: 1px solid var(--studio-border);
  border-radius: 4px;
  font-size: 0.75rem;
  color: var(--studio-text);
}

.filter-count {
  margin-left: auto;
  font-size: 0.75rem;
  color: var(--studio-text-tertiary);
}

.sources-tab__threads {
  display: flex;
  flex-wrap: wrap;
  gap: 0.375rem;
  margin-bottom: 0.75rem;
}

.thread-badge {
  display: flex;
  align-items: center;
  gap: 0.375rem;
  padding: 0.25rem 0.625rem;
  background: transparent;
  border: 1px solid var(--studio-border);
  border-radius: 12px;
  font-size: 0.75rem;
  color: var(--studio-text-secondary);
  cursor: pointer;
  transition: all 0.15s ease;
}

.thread-badge:hover {
  background: var(--studio-hover);
}

.thread-badge.active {
  background: var(--studio-accent);
  border-color: var(--studio-accent);
  color: white;
}

.thread-dot {
  width: 8px;
  height: 8px;
  border-radius: 50%;
}

.sources-tab__list {
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
}

.conversation-group {
  border: 1px solid var(--studio-border);
  border-radius: 8px;
  background: var(--studio-surface);
  overflow: hidden;
}

.conversation-group__header {
  width: 100%;
  display: flex;
  align-items: center;
  gap: 0.5rem;
  padding: 0.625rem 0.75rem;
  background: transparent;
  border: none;
  cursor: pointer;
  text-align: left;
}

.conversation-group__header:hover {
  background: var(--studio-hover);
}

.expand-icon {
  font-size: 0.625rem;
  color: var(--studio-text-tertiary);
}

.conversation-title {
  flex: 1;
  font-size: 0.8125rem;
  font-weight: 500;
  color: var(--studio-text);
}

.conversation-meta {
  font-size: 0.6875rem;
  color: var(--studio-text-tertiary);
}

.conversation-source {
  padding: 0.125rem 0.375rem;
  background: var(--studio-quote-bg);
  border-radius: 3px;
  font-size: 0.625rem;
  color: var(--studio-text-secondary);
}

.conversation-group__passages {
  border-top: 1px solid var(--studio-border);
  background: var(--studio-panel-bg);
}

/* Passage Card */
.passage-card {
  padding: 0.75rem;
  border-bottom: 1px solid var(--studio-border);
  cursor: pointer;
  transition: background 0.15s ease;
}

.passage-card:last-child {
  border-bottom: none;
}

.passage-card:hover {
  background: var(--studio-hover);
}

.passage-card--rejected {
  opacity: 0.5;
}

.passage-card__header {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  margin-bottom: 0.5rem;
}

.role-badge {
  padding: 0.125rem 0.375rem;
  border-radius: 3px;
  font-size: 0.625rem;
  font-weight: 600;
  text-transform: uppercase;
}

.role-badge--user {
  background: rgba(59, 130, 246, 0.15);
  color: #3b82f6;
}

.role-badge--assistant {
  background: rgba(34, 197, 94, 0.15);
  color: #22c55e;
}

.status-badge {
  padding: 0.125rem 0.375rem;
  border-radius: 3px;
  font-size: 0.625rem;
  font-weight: 600;
  color: white;
}

.similarity {
  font-size: 0.6875rem;
  color: var(--studio-text-tertiary);
}

.passage-card__content {
  margin: 0;
  font-size: 0.8125rem;
  line-height: 1.5;
  color: var(--studio-text);
}

.passage-card__tags {
  display: flex;
  flex-wrap: wrap;
  gap: 0.25rem;
  margin-top: 0.5rem;
}

.tag {
  padding: 0.125rem 0.375rem;
  background: var(--studio-quote-bg);
  border-radius: 3px;
  font-size: 0.6875rem;
  color: var(--studio-text-secondary);
}

.passage-card__notes {
  display: flex;
  align-items: flex-start;
  gap: 0.375rem;
  margin-top: 0.5rem;
  padding: 0.375rem 0.5rem;
  background: rgba(245, 158, 11, 0.1);
  border-radius: 4px;
  font-size: 0.75rem;
  font-style: italic;
  color: var(--studio-text-secondary);
}

.notes-icon {
  font-size: 0.75rem;
}

.passage-card__actions {
  display: flex;
  gap: 0.25rem;
  margin-top: 0.5rem;
}

.action-btn {
  width: 28px;
  height: 28px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: transparent;
  border: 1px solid var(--studio-border);
  border-radius: 4px;
  font-size: 0.875rem;
  cursor: pointer;
  transition: all 0.15s ease;
}

.action-btn:hover {
  background: var(--studio-hover);
}

.action-btn--approve:hover {
  background: rgba(34, 197, 94, 0.15);
  border-color: #22c55e;
  color: #22c55e;
}

.action-btn--reject:hover {
  background: rgba(239, 68, 68, 0.15);
  border-color: #ef4444;
  color: #ef4444;
}

.action-btn--gem:hover {
  background: rgba(251, 191, 36, 0.15);
  border-color: #fbbf24;
  color: #fbbf24;
}

.passage-card__footer {
  display: flex;
  justify-content: space-between;
  margin-top: 0.5rem;
  font-size: 0.6875rem;
  color: var(--studio-text-tertiary);
}

.query {
  font-style: italic;
}

/* ─────────────────────────────────────────────────────────────────
   THINKING TAB
   ───────────────────────────────────────────────────────────────── */

.thinking-tab {
  padding: 0.75rem;
}

.thinking-section {
  margin-bottom: 1.5rem;
}

.thinking-section h3 {
  font-size: 0.875rem;
  font-weight: 600;
  color: var(--studio-text);
  margin: 0 0 0.75rem;
}

.context-panel {
  padding: 0.75rem;
  background: var(--studio-surface);
  border: 1px solid var(--studio-border);
  border-radius: 8px;
}

.context-item {
  margin-bottom: 0.625rem;
}

.context-item:last-child {
  margin-bottom: 0;
}

.context-item .label {
  display: block;
  font-size: 0.6875rem;
  font-weight: 600;
  color: var(--studio-text-secondary);
  margin-bottom: 0.25rem;
}

.context-item .value {
  font-size: 0.8125rem;
  color: var(--studio-text);
}

.query-list,
.concept-list {
  display: flex;
  flex-wrap: wrap;
  gap: 0.375rem;
}

.query-tag,
.concept-tag {
  padding: 0.25rem 0.5rem;
  background: var(--studio-quote-bg);
  border-radius: 4px;
  font-size: 0.75rem;
  color: var(--studio-text-secondary);
}

/* AUI Notes */
.aui-notes {
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
}

.aui-note {
  padding: 0.625rem 0.75rem;
  background: var(--studio-surface);
  border: 1px solid var(--studio-border);
  border-radius: 6px;
  border-left: 3px solid var(--studio-accent);
}

.aui-note--suggestion {
  border-left-color: #22c55e;
}

.aui-note--observation {
  border-left-color: #3b82f6;
}

.aui-note--question {
  border-left-color: #f59e0b;
}

.aui-note--reminder {
  border-left-color: #8b5cf6;
}

.aui-note__header {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  margin-bottom: 0.375rem;
}

.note-type {
  font-size: 0.625rem;
  font-weight: 600;
  text-transform: uppercase;
  color: var(--studio-text-secondary);
}

.note-time {
  font-size: 0.625rem;
  color: var(--studio-text-tertiary);
}

.resolved {
  font-size: 0.625rem;
  color: #22c55e;
}

.aui-note__content {
  margin: 0;
  font-size: 0.8125rem;
  color: var(--studio-text);
}

.note-relation {
  display: block;
  margin-top: 0.375rem;
  font-size: 0.6875rem;
  color: var(--studio-text-tertiary);
}

.aui-note-input {
  display: flex;
  gap: 0.5rem;
  margin-top: 0.5rem;
}

.aui-note-input input {
  flex: 1;
  padding: 0.5rem 0.625rem;
  background: var(--studio-surface);
  border: 1px solid var(--studio-border);
  border-radius: 6px;
  font-size: 0.8125rem;
  color: var(--studio-text);
}

.aui-note-input button {
  padding: 0.5rem 0.875rem;
  background: var(--studio-accent);
  border: none;
  border-radius: 6px;
  font-size: 0.8125rem;
  font-weight: 500;
  color: white;
  cursor: pointer;
}

.aui-note-input button:hover {
  filter: brightness(1.1);
}

/* Decision Timeline */
.decision-filters {
  margin-bottom: 0.75rem;
}

.decision-filters select {
  padding: 0.375rem 0.625rem;
  background: var(--studio-surface);
  border: 1px solid var(--studio-border);
  border-radius: 4px;
  font-size: 0.75rem;
  color: var(--studio-text);
}

.decision-timeline {
  position: relative;
  padding-left: 1.5rem;
}

.decision-timeline::before {
  content: '';
  position: absolute;
  left: 5px;
  top: 0;
  bottom: 0;
  width: 2px;
  background: var(--studio-border);
}

.decision-item {
  position: relative;
  padding-bottom: 0.75rem;
}

.decision-marker {
  position: absolute;
  left: -1.5rem;
  top: 4px;
  width: 12px;
  height: 12px;
  background: var(--studio-accent);
  border: 2px solid var(--studio-panel-bg);
  border-radius: 50%;
}

.decision-content {
  padding: 0.625rem 0.75rem;
  background: var(--studio-surface);
  border: 1px solid var(--studio-border);
  border-radius: 6px;
}

.decision-header {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  margin-bottom: 0.25rem;
}

.decision-type {
  padding: 0.125rem 0.375rem;
  background: var(--studio-quote-bg);
  border-radius: 3px;
  font-size: 0.625rem;
  font-weight: 600;
  text-transform: uppercase;
  color: var(--studio-text-secondary);
}

.decision-time,
.decision-trigger {
  font-size: 0.625rem;
  color: var(--studio-text-tertiary);
}

.decision-title {
  margin: 0 0 0.25rem;
  font-size: 0.8125rem;
  font-weight: 500;
  color: var(--studio-text);
}

.decision-desc {
  margin: 0;
  font-size: 0.75rem;
  color: var(--studio-text-secondary);
}

.decision-confidence {
  display: block;
  margin-top: 0.25rem;
  font-size: 0.6875rem;
  color: var(--studio-text-tertiary);
}

/* ─────────────────────────────────────────────────────────────────
   DRAFTS TAB
   ───────────────────────────────────────────────────────────────── */

.drafts-tab {
  display: flex;
  height: 100%;
}

.drafts-tab__sidebar {
  width: 200px;
  border-right: 1px solid var(--studio-border);
  background: var(--studio-surface);
  overflow-y: auto;
}

.drafts-tab__sidebar h3 {
  margin: 0;
  padding: 0.75rem;
  font-size: 0.6875rem;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.05em;
  color: var(--studio-text-secondary);
}

.chapter-list {
  display: flex;
  flex-direction: column;
}

.chapter-item {
  display: flex;
  align-items: center;
  gap: 0.375rem;
  width: 100%;
  padding: 0.5rem 0.75rem;
  background: transparent;
  border: none;
  text-align: left;
  cursor: pointer;
  transition: background 0.15s ease;
}

.chapter-item:hover {
  background: var(--studio-hover);
}

.chapter-item.active {
  background: var(--studio-accent);
  color: white;
}

.chapter-number {
  font-size: 0.75rem;
  color: inherit;
  opacity: 0.7;
}

.chapter-title {
  flex: 1;
  font-size: 0.8125rem;
  font-weight: 500;
}

.chapter-status {
  font-size: 0.5625rem;
  font-weight: 600;
  text-transform: uppercase;
  padding: 0.125rem 0.375rem;
  border-radius: 3px;
}

.chapter-status--outline { background: rgba(107, 114, 128, 0.15); color: #6b7280; }
.chapter-status--drafting { background: rgba(99, 102, 241, 0.15); color: #6366f1; }
.chapter-status--revising { background: rgba(245, 158, 11, 0.15); color: #d97706; }
.chapter-status--complete { background: rgba(34, 197, 94, 0.15); color: #16a34a; }

.outline-section {
  padding: 0.75rem;
  border-top: 1px solid var(--studio-border);
}

.outline-section summary {
  font-size: 0.75rem;
  font-weight: 500;
  color: var(--studio-text-secondary);
  cursor: pointer;
}

.outline-content {
  margin-top: 0.5rem;
  padding: 0.5rem;
  background: var(--studio-quote-bg);
  border-radius: 4px;
  font-size: 0.75rem;
  color: var(--studio-text-secondary);
  white-space: pre-wrap;
}

.drafts-tab__main {
  flex: 1;
  display: flex;
  flex-direction: column;
  overflow: hidden;
}

.chapter-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 0.75rem 1rem;
  border-bottom: 1px solid var(--studio-border);
}

.chapter-header h2 {
  margin: 0;
  font-size: 1rem;
  font-weight: 600;
  color: var(--studio-text);
}

.chapter-actions {
  display: flex;
  gap: 0.375rem;
}

.edit-toggle,
.version-toggle {
  padding: 0.375rem 0.625rem;
  background: transparent;
  border: 1px solid var(--studio-border);
  border-radius: 4px;
  font-size: 0.75rem;
  color: var(--studio-text-secondary);
  cursor: pointer;
}

.edit-toggle:hover,
.version-toggle:hover {
  background: var(--studio-hover);
}

.edit-toggle.active,
.version-toggle.active {
  background: var(--studio-accent);
  border-color: var(--studio-accent);
  color: white;
}

.version-history {
  padding: 0.75rem 1rem;
  background: var(--studio-surface);
  border-bottom: 1px solid var(--studio-border);
}

.version-history h4 {
  margin: 0 0 0.5rem;
  font-size: 0.75rem;
  font-weight: 600;
  color: var(--studio-text-secondary);
}

.version-item {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  padding: 0.375rem 0;
  font-size: 0.75rem;
  color: var(--studio-text-secondary);
}

.version-badge {
  padding: 0.125rem 0.375rem;
  background: var(--studio-accent);
  border-radius: 3px;
  font-size: 0.625rem;
  font-weight: 600;
  color: white;
}

.version-date,
.version-words,
.version-by {
  color: var(--studio-text-tertiary);
}

.version-changes {
  flex: 1;
}

.chapter-content {
  flex: 1;
  overflow-y: auto;
  padding: 1rem;
}

.chapter-editor {
  width: 100%;
  height: 100%;
  padding: 1rem;
  background: var(--studio-surface);
  border: 1px solid var(--studio-border);
  border-radius: 8px;
  font-family: var(--font-family-mono, monospace);
  font-size: 0.875rem;
  line-height: 1.6;
  color: var(--studio-text);
  resize: none;
}

.chapter-preview {
  max-width: 700px;
}

.markdown-preview {
  font-family: var(--font-family-reading, Georgia, serif);
  font-size: 1rem;
  line-height: 1.8;
  color: var(--studio-text);
}

.markdown-preview h1 { font-size: 1.75rem; margin: 0 0 1rem; }
.markdown-preview h2 { font-size: 1.375rem; margin: 1.5rem 0 0.75rem; }
.markdown-preview h3 { font-size: 1.125rem; margin: 1.25rem 0 0.5rem; }
.markdown-preview p { margin: 0 0 1rem; }
.markdown-preview blockquote {
  margin: 1rem 0;
  padding: 0.75rem 1rem;
  background: var(--studio-quote-bg);
  border-left: 3px solid var(--studio-accent);
  font-style: italic;
}
.markdown-preview hr {
  border: none;
  border-top: 1px solid var(--studio-border);
  margin: 1.5rem 0;
}

/* ═══════════════════════════════════════════════════════════════════
   MARKDOWN TABLES (GFM-rendered)
   Book-like styling: subtle borders, warm tones, excellent readability
   ═══════════════════════════════════════════════════════════════════ */

.markdown-preview table,
.analyzable-markdown table,
.workspace__markdown table,
.workspace__preview-content table,
.container-workspace__content table {
  width: 100%;
  border-collapse: collapse;
  margin: var(--space-large, 1.5rem) 0;
  background: var(--color-surface-secondary, #faf8f5);
  border: var(--border-width-thin, 1px) solid var(--color-border-default, #d4cfc5);
  border-radius: var(--radius-medium, 8px);
  overflow: hidden;
  font-size: var(--text-size-body, 0.9375rem);
  line-height: var(--line-height-normal, 1.6);
}

.markdown-preview thead,
.analyzable-markdown thead,
.workspace__markdown thead,
.workspace__preview-content thead,
.container-workspace__content thead {
  background: var(--color-surface-tertiary, #f0ebe3);
}

.markdown-preview thead th,
.analyzable-markdown thead th,
.workspace__markdown thead th,
.workspace__preview-content thead th,
.container-workspace__content thead th {
  padding: var(--space-medium, 12px) var(--space-medium, 16px);
  text-align: left;
  font-weight: var(--font-weight-semibold, 600);
  color: var(--color-text-primary, #2c2c2c);
  font-size: var(--text-size-small, 0.875rem);
  letter-spacing: var(--letter-spacing-wide, 0.02em);
  border-bottom: var(--border-width-medium, 2px) solid var(--color-border-default, #d4cfc5);
  vertical-align: middle;
}

.markdown-preview tbody tr,
.analyzable-markdown tbody tr,
.workspace__markdown tbody tr,
.workspace__preview-content tbody tr,
.container-workspace__content tbody tr {
  border-bottom: var(--border-width-thin, 1px) solid var(--color-border-subtle, #e5e2dc);
  transition: background var(--duration-fast, 0.15s) var(--ease-out, ease-out);
}

.markdown-preview tbody tr:last-child,
.analyzable-markdown tbody tr:last-child,
.workspace__markdown tbody tr:last-child,
.workspace__preview-content tbody tr:last-child,
.container-workspace__content tbody tr:last-child {
  border-bottom: none;
}

.markdown-preview tbody tr:hover,
.analyzable-markdown tbody tr:hover,
.workspace__markdown tbody tr:hover,
.workspace__preview-content tbody tr:hover,
.container-workspace__content tbody tr:hover {
  background: var(--color-surface-tertiary, rgba(0, 0, 0, 0.02));
}

.markdown-preview tbody td,
.analyzable-markdown tbody td,
.workspace__markdown tbody td,
.workspace__preview-content tbody td,
.container-workspace__content tbody td {
  padding: var(--space-medium, 12px) var(--space-medium, 16px);
  color: var(--color-text-secondary, #4a4a4a);
  vertical-align: top;
  line-height: var(--line-height-relaxed, 1.7);
}

/* Alternate row coloring for readability */
.markdown-preview tbody tr:nth-child(even),
.analyzable-markdown tbody tr:nth-child(even),
.workspace__markdown tbody tr:nth-child(even),
.workspace__preview-content tbody tr:nth-child(even),
.container-workspace__content tbody tr:nth-child(even) {
  background: var(--color-surface-primary, #fdfcfa);
}

/* Code inside tables */
.markdown-preview td code,
.markdown-preview th code,
.analyzable-markdown td code,
.analyzable-markdown th code,
.workspace__markdown td code,
.workspace__preview-content td code,
.container-workspace__content td code {
  padding: var(--space-tiny, 2px) var(--space-small, 6px);
  background: var(--color-surface-sunken, #f0ebe3);
  border-radius: var(--radius-small, 4px);
  font-size: 0.875em;
  color: var(--color-status-error, #b91c1c);
  font-family: var(--font-family-mono, 'SF Mono', Consolas, monospace);
}

/* Responsive tables - horizontal scroll on mobile */
@media (max-width: 767px) {
  .markdown-preview table,
  .analyzable-markdown table,
  .workspace__markdown table,
  .workspace__preview-content table,
  .container-workspace__content table {
    display: block;
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
    font-size: var(--text-size-small, 0.875rem);
  }

  .markdown-preview thead th,
  .markdown-preview tbody td,
  .analyzable-markdown thead th,
  .analyzable-markdown tbody td,
  .workspace__markdown thead th,
  .workspace__markdown tbody td {
    padding: var(--space-small, 8px) var(--space-medium, 12px);
    white-space: nowrap;
  }
}

/* ═══════════════════════════════════════════════════════════════════
   MARKDOWN CODE BLOCKS
   ═══════════════════════════════════════════════════════════════════ */

.markdown-preview code,
.analyzable-markdown code,
.workspace__markdown code,
.workspace__preview-content code,
.container-workspace__content code {
  padding: var(--space-tiny, 2px) var(--space-small, 6px);
  background: var(--color-surface-sunken, #f0ebe3);
  border-radius: var(--radius-small, 4px);
  font-family: var(--font-family-mono, 'SF Mono', Consolas, monospace);
  font-size: 0.9em;
  color: var(--color-status-error, #b91c1c);
}

.markdown-preview pre,
.analyzable-markdown pre,
.workspace__markdown pre,
.workspace__preview-content pre,
.container-workspace__content pre {
  margin: var(--space-large, 1.5rem) 0;
  padding: var(--space-medium, 16px);
  background: var(--color-surface-sunken, #f5f2ed);
  border: var(--border-width-thin, 1px) solid var(--color-border-subtle, #e5e2dc);
  border-radius: var(--radius-medium, 8px);
  overflow-x: auto;
  font-size: var(--text-size-small, 0.875rem);
  line-height: var(--line-height-relaxed, 1.6);
}

.markdown-preview pre code,
.analyzable-markdown pre code,
.workspace__markdown pre code,
.workspace__preview-content pre code,
.container-workspace__content pre code {
  padding: 0;
  background: none;
  color: var(--color-text-primary, #2c2c2c);
  font-size: inherit;
}

/* ═══════════════════════════════════════════════════════════════════
   MARKDOWN LISTS
   ═══════════════════════════════════════════════════════════════════ */

.markdown-preview ul,
.markdown-preview ol,
.analyzable-markdown ul,
.analyzable-markdown ol,
.workspace__markdown ul,
.workspace__markdown ol,
.workspace__preview-content ul,
.workspace__preview-content ol,
.container-workspace__content ul,
.container-workspace__content ol {
  margin: var(--space-medium, 1rem) 0;
  padding-left: var(--space-xlarge, 2rem);
}

.markdown-preview li,
.analyzable-markdown li,
.workspace__markdown li,
.workspace__preview-content li,
.container-workspace__content li {
  margin-bottom: var(--space-small, 0.5rem);
  line-height: var(--line-height-relaxed, 1.7);
  color: var(--color-text-secondary, #4a4a4a);
}

.markdown-preview li::marker,
.analyzable-markdown li::marker,
.workspace__markdown li::marker {
  color: var(--color-text-tertiary, #888);
}

/* Nested lists */
.markdown-preview ul ul,
.markdown-preview ol ol,
.markdown-preview ul ol,
.markdown-preview ol ul,
.analyzable-markdown ul ul,
.analyzable-markdown ol ol {
  margin-top: var(--space-small, 0.5rem);
  margin-bottom: 0;
}

/* ═══════════════════════════════════════════════════════════════════
   MARKDOWN BLOCKQUOTES
   ═══════════════════════════════════════════════════════════════════ */

.markdown-preview blockquote,
.analyzable-markdown blockquote,
.workspace__markdown blockquote,
.workspace__preview-content blockquote,
.container-workspace__content blockquote {
  margin: var(--space-large, 1.5rem) 0;
  padding: var(--space-medium, 1rem) var(--space-large, 1.5rem);
  background: var(--color-surface-secondary, #faf8f5);
  border-left: var(--border-width-thick, 4px) solid var(--color-primary, #4a7c59);
  border-radius: 0 var(--radius-small, 4px) var(--radius-small, 4px) 0;
  font-style: italic;
  color: var(--color-text-secondary, #555);
}

.markdown-preview blockquote p:last-child,
.analyzable-markdown blockquote p:last-child,
.workspace__markdown blockquote p:last-child {
  margin-bottom: 0;
}

/* ═══════════════════════════════════════════════════════════════════
   MARKDOWN LINKS
   ═══════════════════════════════════════════════════════════════════ */

.markdown-preview a,
.analyzable-markdown a,
.workspace__markdown a,
.workspace__preview-content a,
.container-workspace__content a {
  color: var(--color-text-link, #2563eb);
  text-decoration: underline;
  text-decoration-color: var(--color-border-subtle, #cbd5e1);
  text-underline-offset: 2px;
  transition: color var(--duration-fast, 0.15s) ease, text-decoration-color var(--duration-fast, 0.15s) ease;
}

.markdown-preview a:hover,
.analyzable-markdown a:hover,
.workspace__markdown a:hover,
.workspace__preview-content a:hover,
.container-workspace__content a:hover {
  color: var(--color-text-link-hover, #1d4ed8);
  text-decoration-color: currentColor;
}

/* ═══════════════════════════════════════════════════════════════════
   MARKDOWN HEADINGS (BOOK-LIKE)
   ═══════════════════════════════════════════════════════════════════ */

.markdown-preview h1,
.analyzable-markdown h1,
.workspace__markdown h1,
.workspace__preview-content h1,
.container-workspace__content h1 {
  font-size: var(--text-size-heading-1, 1.75rem);
  font-weight: var(--font-weight-bold, 700);
  color: var(--color-text-primary, #2c2c2c);
  margin: var(--space-xlarge, 2.5rem) 0 var(--space-large, 1.5rem);
  line-height: var(--line-height-tight, 1.2);
  letter-spacing: var(--letter-spacing-tight, -0.02em);
}

.markdown-preview h2,
.analyzable-markdown h2,
.workspace__markdown h2,
.workspace__preview-content h2,
.container-workspace__content h2 {
  font-size: var(--text-size-heading-2, 1.375rem);
  font-weight: var(--font-weight-semibold, 600);
  color: var(--color-text-primary, #2c2c2c);
  margin: var(--space-xlarge, 2rem) 0 var(--space-medium, 1rem);
  line-height: var(--line-height-tight, 1.25);
}

.markdown-preview h3,
.analyzable-markdown h3,
.workspace__markdown h3,
.workspace__preview-content h3,
.container-workspace__content h3 {
  font-size: var(--text-size-heading-3, 1.125rem);
  font-weight: var(--font-weight-semibold, 600);
  color: var(--color-text-primary, #2c2c2c);
  margin: var(--space-large, 1.5rem) 0 var(--space-small, 0.75rem);
  line-height: var(--line-height-normal, 1.4);
}

.markdown-preview h4,
.analyzable-markdown h4,
.workspace__markdown h4,
.workspace__preview-content h4,
.container-workspace__content h4 {
  font-size: var(--text-size-large, 1rem);
  font-weight: var(--font-weight-semibold, 600);
  color: var(--color-text-secondary, #4a4a4a);
  margin: var(--space-medium, 1.25rem) 0 var(--space-small, 0.5rem);
}

/* First heading shouldn't have top margin */
.markdown-preview > h1:first-child,
.markdown-preview > h2:first-child,
.markdown-preview > h3:first-child,
.analyzable-markdown > h1:first-child,
.analyzable-markdown > h2:first-child,
.analyzable-markdown > h3:first-child {
  margin-top: 0;
}

/* ═══════════════════════════════════════════════════════════════════
   MARKDOWN IMAGES
   ═══════════════════════════════════════════════════════════════════ */

.markdown-preview img,
.analyzable-markdown img,
.workspace__markdown img,
.workspace__preview-content img,
.container-workspace__content img {
  max-width: 100%;
  height: auto;
  border-radius: var(--radius-medium, 8px);
  margin: var(--space-medium, 1rem) 0;
}

/* ═══════════════════════════════════════════════════════════════════
   MARKDOWN HORIZONTAL RULES
   ═══════════════════════════════════════════════════════════════════ */

.markdown-preview hr,
.analyzable-markdown hr,
.workspace__markdown hr,
.workspace__preview-content hr,
.container-workspace__content hr {
  border: none;
  border-top: var(--border-width-thin, 1px) solid var(--color-border-subtle, #e5e2dc);
  margin: var(--space-xlarge, 2rem) 0;
}

.chapter-marginalia {
  padding: 0.75rem 1rem;
  background: var(--studio-surface);
  border-top: 1px solid var(--studio-border);
}

.chapter-marginalia h4 {
  margin: 0 0 0.5rem;
  font-size: 0.75rem;
  font-weight: 600;
  color: var(--studio-text-secondary);
}

.marginalia-item {
  padding: 0.5rem 0.625rem;
  margin-bottom: 0.375rem;
  background: var(--studio-panel-bg);
  border-radius: 4px;
  border-left: 2px solid var(--studio-accent);
}

.marginalia-item--commentary { border-left-color: #3b82f6; }
.marginalia-item--reference { border-left-color: #8b5cf6; }
.marginalia-item--question { border-left-color: #f59e0b; }
.marginalia-item--connection { border-left-color: #22c55e; }
.marginalia-item--todo { border-left-color: #ef4444; }

.marginalia-type {
  display: block;
  font-size: 0.625rem;
  font-weight: 600;
  text-transform: uppercase;
  color: var(--studio-text-tertiary);
  margin-bottom: 0.25rem;
}

.marginalia-item p {
  margin: 0;
  font-size: 0.8125rem;
  color: var(--studio-text);
}

.chapter-metadata {
  padding: 0.75rem 1rem;
  background: var(--studio-surface);
  border-top: 1px solid var(--studio-border);
}

.chapter-metadata h4 {
  margin: 0 0 0.5rem;
  font-size: 0.75rem;
  font-weight: 600;
  color: var(--studio-text-secondary);
}

.metadata-grid {
  display: flex;
  flex-wrap: wrap;
  gap: 1rem;
  font-size: 0.75rem;
  color: var(--studio-text-secondary);
}

.aui-suggestions {
  margin-top: 0.75rem;
}

.aui-suggestions h5 {
  margin: 0 0 0.375rem;
  font-size: 0.6875rem;
  font-weight: 600;
  text-transform: uppercase;
  color: var(--studio-text-tertiary);
}

.suggestion {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  padding: 0.375rem 0.5rem;
  background: var(--studio-panel-bg);
  border-radius: 4px;
  margin-bottom: 0.25rem;
}

.suggestion.applied {
  opacity: 0.6;
}

.suggestion-type {
  font-size: 0.625rem;
  font-weight: 600;
  text-transform: uppercase;
  color: var(--studio-text-tertiary);
}

.suggestion-text {
  flex: 1;
  font-size: 0.75rem;
  color: var(--studio-text-secondary);
}

.applied-badge {
  color: #22c55e;
}

.drafts-empty {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  height: 100%;
  color: var(--studio-text-tertiary);
}

.empty-icon {
  font-size: 3rem;
  margin-bottom: 0.5rem;
}

.drafts-empty p {
  font-size: 0.875rem;
}

/* ─────────────────────────────────────────────────────────────────
   PROFILE TAB
   ───────────────────────────────────────────────────────────────── */

.profile-tab {
  padding: 0.75rem;
}

.profile-tab__header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 1rem;
}

.profile-tab__header h3 {
  margin: 0;
  font-size: 1rem;
  font-weight: 600;
  color: var(--studio-text);
}

.profile-tab__build-btn {
  padding: 0.5rem 1rem;
  background: var(--studio-accent);
  border: none;
  border-radius: 6px;
  font-size: 0.8125rem;
  font-weight: 500;
  color: white;
  cursor: pointer;
  transition: filter 0.15s ease;
}

.profile-tab__build-btn:hover:not(:disabled) {
  filter: brightness(1.1);
}

.profile-tab__build-btn:disabled {
  opacity: 0.6;
  cursor: not-allowed;
}

.profile-tab__progress {
  margin-bottom: 1rem;
}

.progress-bar {
  height: 6px;
  background: var(--studio-surface);
  border-radius: 3px;
  overflow: hidden;
  margin-bottom: 0.5rem;
}

.progress-bar__fill {
  height: 100%;
  background: var(--studio-accent);
  transition: width 0.3s ease;
}

.progress-message {
  font-size: 0.75rem;
  color: var(--studio-text-secondary);
}

.profile-tab__empty {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 3rem;
  color: var(--studio-text-tertiary);
}

.profile-tab__empty .empty-icon {
  font-size: 3rem;
  margin-bottom: 0.75rem;
}

.profile-tab__empty p {
  margin: 0.25rem 0;
  font-size: 0.875rem;
}

.empty-hint {
  font-size: 0.75rem !important;
  color: var(--studio-text-tertiary);
}

/* Profile Sections */
.profile-section {
  padding: 0.875rem;
  margin-bottom: 0.75rem;
  background: var(--studio-surface);
  border: 1px solid var(--studio-border);
  border-radius: 8px;
}

.profile-section h4 {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  margin: 0 0 0.75rem;
  font-size: 0.875rem;
  font-weight: 600;
  color: var(--studio-text);
}

.section-icon {
  font-size: 1rem;
}

/* Apex Content */
.apex-content {
  display: flex;
  flex-direction: column;
  gap: 0.75rem;
}

.apex-summary {
  margin: 0;
  font-size: 0.875rem;
  line-height: 1.6;
  color: var(--studio-text);
}

.apex-themes,
.apex-characters {
  display: flex;
  flex-wrap: wrap;
  align-items: center;
  gap: 0.375rem;
}

.apex-themes .label,
.apex-characters .label,
.apex-arc .label,
.apex-mood .label {
  font-size: 0.75rem;
  font-weight: 500;
  color: var(--studio-text-secondary);
  margin-right: 0.25rem;
}

.theme-list,
.character-list {
  display: flex;
  flex-wrap: wrap;
  gap: 0.375rem;
}

.theme-tag {
  padding: 0.25rem 0.625rem;
  background: rgba(99, 102, 241, 0.15);
  border-radius: 12px;
  font-size: 0.75rem;
  color: #6366f1;
}

.character-tag {
  padding: 0.25rem 0.625rem;
  background: rgba(34, 197, 94, 0.15);
  border-radius: 12px;
  font-size: 0.75rem;
  color: #22c55e;
}

.apex-arc p,
.apex-mood p {
  margin: 0.25rem 0 0;
  font-size: 0.8125rem;
  color: var(--studio-text);
}

.mood-badge {
  padding: 0.25rem 0.5rem;
  background: var(--studio-quote-bg);
  border-radius: 4px;
  font-size: 0.75rem;
  color: var(--studio-text-secondary);
}

/* Philosophy Content */
.philosophy-content {
  display: flex;
  flex-direction: column;
  gap: 0.75rem;
}

.philosophy-stances .label,
.philosophy-assumptions .label,
.philosophy-influences .label {
  display: block;
  font-size: 0.75rem;
  font-weight: 500;
  color: var(--studio-text-secondary);
  margin-bottom: 0.375rem;
}

.philosophy-content ul {
  margin: 0;
  padding-left: 1.25rem;
  font-size: 0.8125rem;
  color: var(--studio-text);
}

.philosophy-content li {
  margin-bottom: 0.25rem;
}

.influence-list {
  display: flex;
  flex-wrap: wrap;
  gap: 0.375rem;
}

.influence-tag {
  padding: 0.25rem 0.5rem;
  background: rgba(139, 92, 246, 0.15);
  border-radius: 4px;
  font-size: 0.75rem;
  color: #8b5cf6;
}

/* Tone Content */
.tone-content {
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
}

.tone-overall,
.tone-register,
.tone-arc {
  display: flex;
  align-items: baseline;
  gap: 0.375rem;
}

.tone-content .label {
  font-size: 0.75rem;
  font-weight: 500;
  color: var(--studio-text-secondary);
}

.tone-value {
  font-size: 0.8125rem;
  color: var(--studio-text);
}

.tone-arc p {
  margin: 0;
  font-size: 0.8125rem;
  color: var(--studio-text);
}

/* Setting Content */
.setting-content {
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
}

.setting-context .label,
.setting-constraints .label {
  display: block;
  font-size: 0.75rem;
  font-weight: 500;
  color: var(--studio-text-secondary);
  margin-bottom: 0.25rem;
}

.setting-context p {
  margin: 0;
  font-size: 0.8125rem;
  color: var(--studio-text);
}

.setting-constraints ul {
  margin: 0;
  padding-left: 1.25rem;
  font-size: 0.8125rem;
  color: var(--studio-text);
}

/* Pyramid Section */
.profile-section--pyramid {
  background: var(--studio-panel-bg);
}

.pyramid-stats {
  display: flex;
  gap: 1.5rem;
  padding: 0.75rem;
  background: var(--studio-surface);
  border-radius: 6px;
  margin-bottom: 0.75rem;
}

.pyramid-stats .stat {
  display: flex;
  flex-direction: column;
  align-items: center;
}

.stat-value {
  font-size: 1.25rem;
  font-weight: 600;
  color: var(--studio-text);
}

.stat-label {
  font-size: 0.6875rem;
  color: var(--studio-text-tertiary);
  text-transform: uppercase;
}

.pyramid-search {
  display: flex;
  gap: 0.5rem;
  margin-bottom: 0.75rem;
}

.pyramid-search input {
  flex: 1;
  padding: 0.5rem 0.75rem;
  background: var(--studio-surface);
  border: 1px solid var(--studio-border);
  border-radius: 6px;
  font-size: 0.8125rem;
  color: var(--studio-text);
}

.pyramid-search button {
  padding: 0.5rem 0.875rem;
  background: var(--studio-accent);
  border: none;
  border-radius: 6px;
  font-size: 0.8125rem;
  font-weight: 500;
  color: white;
  cursor: pointer;
}

.pyramid-search button:hover {
  filter: brightness(1.1);
}

.pyramid-search-results {
  margin-bottom: 0.75rem;
}

.pyramid-search-results h5 {
  margin: 0 0 0.5rem;
  font-size: 0.75rem;
  font-weight: 600;
  color: var(--studio-text-secondary);
}

.search-result {
  display: flex;
  gap: 0.75rem;
  padding: 0.5rem 0.625rem;
  background: var(--studio-surface);
  border: 1px solid var(--studio-border);
  border-radius: 4px;
  margin-bottom: 0.375rem;
  cursor: pointer;
  transition: all 0.15s ease;
}

.search-result:hover {
  background: var(--studio-hover);
}

.search-result.selected {
  border-color: var(--studio-accent);
  background: rgba(99, 102, 241, 0.1);
}

.result-score {
  font-size: 0.75rem;
  font-weight: 600;
  color: #22c55e;
}

.result-content {
  flex: 1;
  margin: 0;
  font-size: 0.75rem;
  color: var(--studio-text);
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

.pyramid-levels {
  margin-bottom: 0.75rem;
}

.pyramid-levels h5 {
  margin: 0 0 0.5rem;
  font-size: 0.75rem;
  font-weight: 600;
  color: var(--studio-text-secondary);
}

.level-buttons {
  display: flex;
  gap: 0.375rem;
}

.level-btn {
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: 0.5rem 0.75rem;
  background: var(--studio-surface);
  border: 1px solid var(--studio-border);
  border-radius: 6px;
  font-size: 0.8125rem;
  font-weight: 500;
  color: var(--studio-text);
  cursor: pointer;
  transition: all 0.15s ease;
}

.level-btn:hover {
  background: var(--studio-hover);
}

.level-btn.active {
  background: var(--studio-accent);
  border-color: var(--studio-accent);
  color: white;
}

.level-count {
  font-size: 0.625rem;
  opacity: 0.7;
}

.pyramid-node-preview {
  padding: 0.75rem;
  background: var(--studio-surface);
  border: 1px solid var(--studio-border);
  border-radius: 6px;
}

.pyramid-node-preview h5 {
  margin: 0 0 0.5rem;
  font-size: 0.75rem;
  font-weight: 600;
  color: var(--studio-text-secondary);
}

.node-preview {
  padding: 0.625rem;
  background: var(--studio-panel-bg);
  border-radius: 4px;
}

.node-meta {
  display: flex;
  gap: 0.5rem;
  margin-bottom: 0.5rem;
}

.node-type {
  font-size: 0.625rem;
  font-weight: 600;
  text-transform: uppercase;
  padding: 0.125rem 0.375rem;
  background: var(--studio-quote-bg);
  border-radius: 3px;
  color: var(--studio-text-secondary);
}

.node-level,
.node-index,
.node-words {
  font-size: 0.6875rem;
  color: var(--studio-text-tertiary);
}

.node-content {
  margin: 0;
  font-size: 0.8125rem;
  line-height: 1.5;
  color: var(--studio-text);
}

.node-keypoints {
  margin-top: 0.5rem;
  padding-top: 0.5rem;
  border-top: 1px solid var(--studio-border);
}

.node-keypoints .label {
  font-size: 0.6875rem;
  font-weight: 500;
  color: var(--studio-text-secondary);
}

.node-keypoints ul {
  margin: 0.25rem 0 0;
  padding-left: 1rem;
  font-size: 0.75rem;
  color: var(--studio-text);
}

.node-not-found {
  margin: 0;
  font-size: 0.8125rem;
  color: var(--studio-text-tertiary);
}

/* Profile Stats */
.profile-section--stats {
  background: var(--studio-surface);
}

.profile-stats {
  display: flex;
  flex-direction: column;
  gap: 0.375rem;
}

.stat-row {
  display: flex;
  justify-content: space-between;
  font-size: 0.8125rem;
}

.stat-row .label {
  color: var(--studio-text-secondary);
}

.stat-row .value {
  font-weight: 500;
  color: var(--studio-text);
}

/* ─────────────────────────────────────────────────────────────────
   PYRAMID VIEWER
   ───────────────────────────────────────────────────────────────── */

.pyramid-viewer {
  padding: 0.75rem;
}

.pyramid-viewer__apex {
  margin-bottom: 1rem;
}

.apex-card {
  padding: 1rem;
  background: linear-gradient(135deg, rgba(99, 102, 241, 0.1), rgba(139, 92, 246, 0.1));
  border: 1px solid rgba(99, 102, 241, 0.3);
  border-radius: 8px;
}

.apex-card--empty {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 2rem;
  background: var(--studio-surface);
  border: 1px dashed var(--studio-border);
}

.apex-card--empty .apex-icon {
  font-size: 2rem;
  margin-bottom: 0.5rem;
}

.apex-card--empty p {
  margin: 0;
  font-size: 0.875rem;
  color: var(--studio-text-tertiary);
}

.apex-card__header {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  margin-bottom: 0.75rem;
}

.apex-icon {
  font-size: 1.25rem;
}

.apex-title {
  font-size: 0.875rem;
  font-weight: 600;
  color: var(--studio-text);
}

.apex-card__summary {
  margin: 0 0 0.75rem;
  font-size: 0.875rem;
  line-height: 1.6;
  color: var(--studio-text);
}

.apex-card__themes {
  display: flex;
  flex-wrap: wrap;
  gap: 0.375rem;
  margin-bottom: 0.5rem;
}

.theme-badge {
  padding: 0.25rem 0.625rem;
  background: rgba(99, 102, 241, 0.2);
  border-radius: 12px;
  font-size: 0.75rem;
  color: #6366f1;
}

.apex-card__mood {
  font-size: 0.75rem;
}

.apex-card__mood .label {
  color: var(--studio-text-secondary);
}

.apex-card__mood .value {
  margin-left: 0.25rem;
  color: var(--studio-text);
}

/* Pyramid Tree */
.pyramid-viewer__tree {
  display: flex;
  flex-direction: column;
  gap: 1rem;
}

.pyramid-level {
  background: var(--studio-surface);
  border: 1px solid var(--studio-border);
  border-radius: 8px;
  overflow: hidden;
}

.pyramid-level--chunks {
  background: var(--studio-panel-bg);
}

.level-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 0.5rem 0.75rem;
  background: var(--studio-hover);
  border-bottom: 1px solid var(--studio-border);
}

.level-label {
  font-size: 0.75rem;
  font-weight: 600;
  color: var(--studio-text);
}

.level-count {
  font-size: 0.6875rem;
  color: var(--studio-text-tertiary);
}

.level-nodes {
  padding: 0.5rem;
}

.level-nodes--grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
  gap: 0.5rem;
}

/* Pyramid Node */
.pyramid-node {
  background: var(--studio-panel-bg);
  border: 1px solid var(--studio-border);
  border-radius: 6px;
  margin-bottom: 0.375rem;
  transition: all 0.15s ease;
}

.pyramid-node:hover {
  border-color: var(--studio-accent);
}

.pyramid-node.selected {
  border-color: var(--studio-accent);
  background: rgba(99, 102, 241, 0.1);
}

.pyramid-node.in-path {
  border-left: 3px solid var(--studio-accent);
}

.pyramid-node__header {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  padding: 0.5rem 0.625rem;
  cursor: pointer;
}

.expand-btn {
  padding: 0.125rem 0.25rem;
  background: transparent;
  border: none;
  font-size: 0.625rem;
  color: var(--studio-text-tertiary);
  cursor: pointer;
}

.node-index {
  font-size: 0.625rem;
  font-weight: 600;
  color: var(--studio-text-secondary);
}

.node-preview {
  flex: 1;
  font-size: 0.75rem;
  color: var(--studio-text);
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

.node-words {
  font-size: 0.625rem;
  color: var(--studio-text-tertiary);
}

.pyramid-node__children {
  padding: 0.5rem 0.625rem 0.5rem 1.5rem;
  border-top: 1px solid var(--studio-border);
  background: var(--studio-surface);
}

.child-preview {
  display: flex;
  gap: 0.5rem;
  padding: 0.25rem 0;
  font-size: 0.6875rem;
}

.child-index {
  color: var(--studio-text-tertiary);
}

.child-content {
  flex: 1;
  color: var(--studio-text-secondary);
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

/* Chunk Card */
.chunk-card {
  padding: 0.5rem;
  background: var(--studio-surface);
  border: 1px solid var(--studio-border);
  border-radius: 4px;
  cursor: pointer;
  transition: all 0.15s ease;
}

.chunk-card:hover {
  border-color: var(--studio-accent);
}

.chunk-card.selected {
  border-color: var(--studio-accent);
  background: rgba(99, 102, 241, 0.1);
}

.chunk-card.in-path {
  border-left: 3px solid var(--studio-accent);
}

.chunk-card__header {
  display: flex;
  justify-content: space-between;
  margin-bottom: 0.375rem;
}

.chunk-index {
  font-size: 0.625rem;
  font-weight: 600;
  color: var(--studio-text-secondary);
}

.chunk-words {
  font-size: 0.625rem;
  color: var(--studio-text-tertiary);
}

.chunk-card__preview {
  margin: 0;
  font-size: 0.6875rem;
  line-height: 1.4;
  color: var(--studio-text);
  overflow: hidden;
  display: -webkit-box;
  -webkit-line-clamp: 3;
  -webkit-box-orient: vertical;
}

.chunks-overflow {
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 0.75rem;
  font-size: 0.75rem;
  color: var(--studio-text-tertiary);
}

/* Selected Node Detail */
.selected-node-detail {
  position: sticky;
  bottom: 0;
  margin-top: 1rem;
  padding: 1rem;
  background: var(--studio-surface);
  border: 1px solid var(--studio-accent);
  border-radius: 8px;
  box-shadow: 0 -4px 12px rgba(0, 0, 0, 0.1);
}

.detail-header {
  display: flex;
  gap: 0.5rem;
  margin-bottom: 0.75rem;
}

.detail-type {
  font-size: 0.625rem;
  font-weight: 600;
  text-transform: uppercase;
  padding: 0.125rem 0.375rem;
  background: var(--studio-accent);
  border-radius: 3px;
  color: white;
}

.detail-level,
.detail-index {
  font-size: 0.6875rem;
  color: var(--studio-text-tertiary);
}

.detail-path {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  margin-bottom: 0.75rem;
}

.path-label {
  font-size: 0.6875rem;
  color: var(--studio-text-tertiary);
}

.path-crumbs {
  display: flex;
  gap: 0.25rem;
}

.path-crumb {
  padding: 0.25rem 0.5rem;
  background: var(--studio-panel-bg);
  border: 1px solid var(--studio-border);
  border-radius: 4px;
  font-size: 0.6875rem;
  color: var(--studio-text-secondary);
  cursor: pointer;
  transition: all 0.15s ease;
}

.path-crumb:hover {
  background: var(--studio-hover);
}

.path-crumb.current {
  background: var(--studio-accent);
  border-color: var(--studio-accent);
  color: white;
}

.detail-content {
  margin-bottom: 0.75rem;
}

.detail-content p {
  margin: 0;
  font-size: 0.8125rem;
  line-height: 1.6;
  color: var(--studio-text);
}

.detail-meta {
  display: flex;
  flex-wrap: wrap;
  gap: 1rem;
  margin-bottom: 0.5rem;
}

.meta-item {
  font-size: 0.75rem;
}

.meta-item .label {
  color: var(--studio-text-secondary);
}

.meta-item .value {
  margin-left: 0.25rem;
  font-weight: 500;
  color: var(--studio-text);
}

.detail-keypoints {
  padding-top: 0.5rem;
  border-top: 1px solid var(--studio-border);
}

.detail-keypoints .label {
  font-size: 0.6875rem;
  font-weight: 500;
  color: var(--studio-text-secondary);
}

.detail-keypoints ul {
  margin: 0.25rem 0 0;
  padding-left: 1rem;
  font-size: 0.75rem;
  color: var(--studio-text);
}

/* Compact Pyramid View */
.pyramid-compact {
  padding: 0.5rem;
}

.pyramid-compact__levels {
  display: flex;
  gap: 0.375rem;
  margin-bottom: 0.75rem;
}

.pyramid-compact__nodes {
  display: flex;
  flex-direction: column;
  gap: 0.375rem;
}

.compact-node {
  display: flex;
  gap: 0.5rem;
  padding: 0.375rem 0.5rem;
  background: var(--studio-surface);
  border: 1px solid var(--studio-border);
  border-radius: 4px;
  cursor: pointer;
  transition: all 0.15s ease;
}

.compact-node:hover {
  background: var(--studio-hover);
}

.compact-node.selected {
  border-color: var(--studio-accent);
  background: rgba(99, 102, 241, 0.1);
}

.nodes-overflow {
  padding: 0.5rem;
  text-align: center;
  font-size: 0.75rem;
  color: var(--studio-text-tertiary);
}

/* ═══════════════════════════════════════════════════════════════════
   BOOK NAVIGATION - Sidebar navigation for book projects
   ═══════════════════════════════════════════════════════════════════ */

.book-nav {
  display: flex;
  flex-direction: column;
  height: 100%;
  overflow: hidden;
}

.book-nav__header {
  display: flex;
  align-items: center;
  gap: 0.75rem;
  padding: 0.75rem;
  border-bottom: 1px solid var(--studio-border);
}

.book-nav__back {
  padding: 0.375rem 0.625rem;
  background: transparent;
  border: 1px solid var(--studio-border);
  border-radius: 4px;
  font-size: 0.75rem;
  color: var(--studio-text-secondary);
  cursor: pointer;
}

.book-nav__back:hover {
  background: var(--studio-hover);
}

.book-nav__title {
  flex: 1;
  min-width: 0;
}

.book-nav__title h2 {
  margin: 0;
  font-size: 0.9375rem;
  font-weight: 600;
  color: var(--studio-text);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.book-nav__status {
  padding: 0.125rem 0.5rem;
  border-radius: 10px;
  font-size: 0.625rem;
  font-weight: 600;
  text-transform: uppercase;
  color: white;
}

.book-nav__status--harvesting { background: #3b82f6; }
.book-nav__status--curating { background: #f59e0b; }
.book-nav__status--drafting { background: #6366f1; }
.book-nav__status--mastering { background: #22c55e; }
.book-nav__status--complete { background: #22c55e; }

.book-nav__stats {
  display: flex;
  gap: 0.75rem;
  padding: 0.5rem 0.75rem;
  font-size: 0.6875rem;
  color: var(--studio-text-tertiary);
  border-bottom: 1px solid var(--studio-border);
}

.book-nav__tabs {
  display: flex;
  padding: 0.5rem;
  gap: 0.25rem;
  border-bottom: 1px solid var(--studio-border);
}

.book-nav__tab {
  flex: 1;
  padding: 0.5rem;
  background: transparent;
  border: 1px solid var(--studio-border);
  border-radius: 6px;
  font-size: 0.75rem;
  color: var(--studio-text-secondary);
  cursor: pointer;
  transition: all 0.15s ease;
}

.book-nav__tab:hover {
  background: var(--studio-hover);
}

.book-nav__tab--active {
  background: var(--studio-accent);
  border-color: var(--studio-accent);
  color: white;
}

.book-nav__content {
  flex: 1;
  overflow-y: auto;
  padding: 0.5rem;
}

.book-nav__group {
  margin-bottom: 0.5rem;
}

.book-nav__group-header {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  width: 100%;
  padding: 0.5rem;
  background: var(--studio-surface);
  border: 1px solid var(--studio-border);
  border-radius: 6px;
  font-size: 0.75rem;
  color: var(--studio-text);
  cursor: pointer;
  transition: background 0.15s ease;
}

.book-nav__group-header:hover {
  background: var(--studio-hover);
}

.book-nav__group-icon {
  font-size: 0.625rem;
  color: var(--studio-text-tertiary);
}

.book-nav__group-title {
  flex: 1;
  font-weight: 500;
}

.book-nav__group-count {
  color: var(--studio-text-tertiary);
}

.book-nav__group-items {
  margin-top: 0.25rem;
  margin-left: 1rem;
}

.book-nav__item {
  display: flex;
  flex-direction: column;
  width: 100%;
  padding: 0.5rem;
  margin-bottom: 0.25rem;
  background: transparent;
  border: 1px solid var(--studio-border);
  border-radius: 4px;
  text-align: left;
  cursor: pointer;
  transition: all 0.15s ease;
}

.book-nav__item:hover {
  background: var(--studio-hover);
  border-color: var(--studio-accent);
}

.book-nav__item-title {
  font-size: 0.75rem;
  font-weight: 500;
  color: var(--studio-text);
  margin-bottom: 0.25rem;
}

.book-nav__item-preview {
  font-size: 0.6875rem;
  color: var(--studio-text-tertiary);
  line-height: 1.4;
}

.book-nav__section {
  margin-top: 1rem;
  padding-top: 0.75rem;
  border-top: 1px solid var(--studio-border);
}

.book-nav__section-title {
  margin: 0 0 0.5rem;
  font-size: 0.6875rem;
  font-weight: 600;
  text-transform: uppercase;
  color: var(--studio-text-tertiary);
}

.book-nav__thread {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 0.375rem 0.5rem;
  margin-bottom: 0.25rem;
  background: var(--studio-surface);
  border-left: 3px solid;
  border-radius: 0 4px 4px 0;
  font-size: 0.75rem;
}

.book-nav__thread-name {
  color: var(--studio-text);
}

.book-nav__thread-count {
  color: var(--studio-text-tertiary);
}

.book-nav__thinking-btn {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  width: 100%;
  padding: 0.75rem;
  background: var(--studio-accent);
  border: none;
  border-radius: 6px;
  color: white;
  font-size: 0.8125rem;
  cursor: pointer;
  transition: opacity 0.15s ease;
}

.book-nav__thinking-btn:hover {
  opacity: 0.9;
}

.book-nav__decision {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  padding: 0.375rem 0;
  font-size: 0.75rem;
  border-bottom: 1px solid var(--studio-border);
}

.book-nav__decision:last-child {
  border-bottom: none;
}

.book-nav__decision-type {
  padding: 0.125rem 0.375rem;
  background: var(--studio-surface);
  border-radius: 3px;
  font-size: 0.625rem;
  font-weight: 600;
  text-transform: uppercase;
  color: var(--studio-text-tertiary);
}

.book-nav__decision-title {
  color: var(--studio-text-secondary);
}

.book-nav__note {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  padding: 0.375rem 0.5rem;
  margin-bottom: 0.25rem;
  background: var(--studio-surface);
  border-radius: 4px;
  font-size: 0.75rem;
}

.book-nav__note--observation { border-left: 3px solid #3b82f6; }
.book-nav__note--suggestion { border-left: 3px solid #22c55e; }
.book-nav__note--question { border-left: 3px solid #f59e0b; }
.book-nav__note--reminder { border-left: 3px solid #ef4444; }

.book-nav__note-content {
  flex: 1;
  color: var(--studio-text-secondary);
}

.book-nav__note-resolved {
  color: #22c55e;
}

.book-nav__new-chapter {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 100%;
  padding: 0.625rem;
  margin-bottom: 0.75rem;
  background: transparent;
  border: 2px dashed var(--studio-border);
  border-radius: 8px;
  color: var(--studio-text-secondary);
  font-size: 0.8125rem;
  font-weight: 500;
  cursor: pointer;
  transition: all 0.15s ease;
}

.book-nav__new-chapter:hover {
  border-color: var(--studio-accent);
  color: var(--studio-accent);
  background: rgba(59, 130, 246, 0.05);
}

.book-nav__chapters {
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
}

.book-nav__chapter {
  display: flex;
  align-items: center;
  gap: 0.75rem;
  width: 100%;
  padding: 0.75rem;
  background: var(--studio-surface);
  border: 1px solid var(--studio-border);
  border-radius: 8px;
  text-align: left;
  cursor: pointer;
  transition: all 0.15s ease;
}

.book-nav__chapter:hover {
  background: var(--studio-hover);
  border-color: var(--studio-accent);
}

.book-nav__chapter-number {
  font-size: 0.75rem;
  font-weight: 600;
  color: var(--studio-accent);
}

.book-nav__chapter-info {
  flex: 1;
  min-width: 0;
}

.book-nav__chapter-title {
  display: block;
  font-size: 0.8125rem;
  font-weight: 500;
  color: var(--studio-text);
  margin-bottom: 0.125rem;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.book-nav__chapter-meta {
  font-size: 0.6875rem;
  color: var(--studio-text-tertiary);
}

.book-nav__chapter-status {
  font-size: 0.875rem;
}

.book-nav__chapter-status--outline { color: var(--studio-text-tertiary); }
.book-nav__chapter-status--drafting { color: #f59e0b; }
.book-nav__chapter-status--revising { color: #6366f1; }
.book-nav__chapter-status--complete { color: #22c55e; }

.book-nav__empty {
  text-align: center;
  padding: 2rem 1rem;
  color: var(--studio-text-tertiary);
}

.book-nav__empty p {
  margin: 0 0 0.25rem;
  font-size: 0.875rem;
}

.book-nav__empty span {
  font-size: 0.75rem;
}

.book-nav__outline-preview {
  font-size: 0.75rem;
  color: var(--studio-text-secondary);
  line-height: 1.5;
}

/* ═══════════════════════════════════════════════════════════════════
   BOOK CONTENT VIEW - Main workspace book content display
   ═══════════════════════════════════════════════════════════════════ */

.book-content-view {
  display: flex;
  flex-direction: column;
  height: 100%;
  background: var(--studio-bg);
}

.book-content-view__header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 1rem 1.5rem;
  background: var(--studio-surface);
  border-bottom: 1px solid var(--studio-border);
}

.book-content-view__header-left {
  display: flex;
  align-items: center;
  gap: 1rem;
}

.book-content-view__back {
  width: 32px;
  height: 32px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: transparent;
  border: 1px solid var(--studio-border);
  border-radius: 6px;
  font-size: 1rem;
  color: var(--studio-text-secondary);
  cursor: pointer;
}

.book-content-view__back:hover {
  background: var(--studio-hover);
  color: var(--studio-text);
}

.book-content-view__title-group {
  display: flex;
  align-items: center;
  gap: 0.75rem;
}

.book-content-view__type-badge {
  padding: 0.25rem 0.625rem;
  background: var(--studio-accent);
  border-radius: 12px;
  font-size: 0.6875rem;
  font-weight: 600;
  text-transform: uppercase;
  color: white;
}

.book-content-view__title {
  margin: 0;
  font-size: 1.25rem;
  font-weight: 600;
  color: var(--studio-text);
}

.book-content-view__project {
  font-size: 0.8125rem;
  color: var(--studio-text-tertiary);
}

.book-content-view__actions {
  display: flex;
  gap: 0.5rem;
}

.book-content-view__action {
  padding: 0.5rem 0.875rem;
  background: transparent;
  border: 1px solid var(--studio-border);
  border-radius: 6px;
  font-size: 0.8125rem;
  color: var(--studio-text-secondary);
  cursor: pointer;
  transition: all 0.15s ease;
}

.book-content-view__action:hover {
  background: var(--studio-hover);
  color: var(--studio-text);
}

.book-content-view__action--primary {
  background: var(--studio-accent);
  border-color: var(--studio-accent);
  color: white;
}

.book-content-view__action--primary:hover {
  opacity: 0.9;
  background: var(--studio-accent);
  color: white;
}

.book-content-view__action--active {
  background: var(--studio-accent);
  border-color: var(--studio-accent);
  color: white;
}

.book-content-view__body {
  flex: 1;
  display: flex;
  overflow: hidden;
}

.book-content-view__body--with-marginalia {
  gap: 1.5rem;
  padding-right: 1.5rem;
}

.book-content-view__content {
  flex: 1;
  overflow-y: auto;
  padding: 2rem;
}

.book-content-view__article {
  max-width: 700px;
  margin: 0 auto;
  font-family: var(--font-family-reading, Georgia, serif);
  font-size: 1.0625rem;
  line-height: 1.8;
  color: var(--studio-text);
}

.book-content-view__article h1 {
  font-size: 2rem;
  font-weight: 600;
  margin: 0 0 1.5rem;
}

.book-content-view__article h2 {
  font-size: 1.5rem;
  font-weight: 600;
  margin: 2rem 0 1rem;
}

.book-content-view__article h3 {
  font-size: 1.25rem;
  font-weight: 600;
  margin: 1.5rem 0 0.75rem;
}

.book-content-view__article p {
  margin: 0 0 1rem;
}

.book-content-view__article blockquote {
  margin: 1.5rem 0;
  padding: 1rem 1.25rem;
  background: var(--studio-quote-bg);
  border-left: 3px solid var(--studio-accent);
  font-style: italic;
}

.book-content-view__article hr {
  border: none;
  border-top: 1px solid var(--studio-border);
  margin: 2rem 0;
}

.book-content-view__epigraph {
  margin: 0 0 2rem;
  padding: 1.25rem;
  background: var(--studio-surface);
  border-left: 3px solid var(--studio-accent);
  font-style: italic;
}

.book-content-view__epigraph p {
  margin: 0;
}

.book-content-view__epigraph footer {
  margin-top: 0.75rem;
  font-size: 0.875rem;
  color: var(--studio-text-secondary);
}

.book-content-view__editor {
  width: 100%;
  height: 100%;
  min-height: 400px;
  padding: 1.5rem;
  font-family: var(--font-family-mono, monospace);
  font-size: 0.9375rem;
  line-height: 1.7;
  background: var(--studio-surface);
  border: 1px solid var(--studio-border);
  border-radius: 8px;
  color: var(--studio-text);
  resize: none;
}

.book-content-view__editor:focus {
  outline: none;
  border-color: var(--studio-accent);
}

.book-content-view__marginalia {
  width: 280px;
  flex-shrink: 0;
  padding: 1.5rem 0;
  overflow-y: auto;
}

.book-content-view__marginalia-title {
  margin: 0 0 1rem;
  font-size: 0.75rem;
  font-weight: 600;
  text-transform: uppercase;
  color: var(--studio-text-tertiary);
}

.book-content-view__metadata {
  padding: 1rem 1.5rem;
  background: var(--studio-surface);
  border-top: 1px solid var(--studio-border);
}

.book-content-view__metadata summary {
  display: flex;
  align-items: center;
  justify-content: space-between;
  cursor: pointer;
  font-size: 0.8125rem;
  font-weight: 600;
  color: var(--studio-text-secondary);
}

.book-content-view__metadata-stats {
  font-weight: 400;
  color: var(--studio-text-tertiary);
}

.book-content-view__metadata-content {
  padding-top: 1rem;
}

.book-content-view__metadata-section {
  margin-bottom: 1rem;
}

.book-content-view__metadata-section h4 {
  margin: 0 0 0.5rem;
  font-size: 0.75rem;
  font-weight: 600;
  color: var(--studio-text-secondary);
}

.book-content-view__metadata-empty {
  font-size: 0.75rem;
  color: var(--studio-text-tertiary);
}

.book-content-view__version-list {
  list-style: none;
  padding: 0;
  margin: 0;
}

.book-content-view__version-item {
  display: flex;
  align-items: center;
  gap: 0.75rem;
  padding: 0.5rem 0;
  border-bottom: 1px solid var(--studio-border);
  font-size: 0.75rem;
}

.book-content-view__version-item:last-child {
  border-bottom: none;
}

.book-content-view__version-number {
  padding: 0.125rem 0.375rem;
  background: var(--studio-accent);
  border-radius: 3px;
  font-weight: 600;
  color: white;
}

.book-content-view__version-changes {
  flex: 1;
  color: var(--studio-text);
}

.book-content-view__version-meta {
  color: var(--studio-text-tertiary);
}

/* Version badge in header */
.book-content-view__version-badge {
  padding: 0.125rem 0.5rem;
  background: var(--studio-accent);
  border-radius: 12px;
  font-size: 0.6875rem;
  font-weight: 600;
  color: white;
}

/* Save status indicator */
.book-content-view__save-status {
  font-size: 0.6875rem;
  font-weight: 500;
  padding: 0.125rem 0.5rem;
  border-radius: 3px;
}

.book-content-view__save-status--saving {
  color: var(--studio-text-secondary);
  animation: pulse 1s ease-in-out infinite;
}

.book-content-view__save-status--saved {
  color: #22c55e;
}

@keyframes pulse {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.5; }
}

/* Interactive version items */
.book-content-view__version-item {
  cursor: pointer;
  transition: background 0.15s ease;
}

.book-content-view__version-item:hover {
  background: var(--studio-hover);
}

.book-content-view__version-item--selected {
  background: rgba(var(--studio-accent-rgb, 180, 140, 20), 0.15);
  border-left: 3px solid var(--studio-accent);
  margin-left: -3px;
  padding-left: calc(0.5rem + 3px);
}

.book-content-view__version-item--current .book-content-view__version-number {
  background: #22c55e;
}

.book-content-view__version-revert {
  margin-top: 0.5rem;
  padding: 0.375rem 0.75rem;
  background: var(--studio-accent);
  color: white;
  border: none;
  border-radius: 4px;
  font-size: 0.6875rem;
  font-weight: 500;
  cursor: pointer;
  transition: background 0.15s ease;
}

.book-content-view__version-revert:hover {
  background: var(--studio-accent-hover, #7a5c12);
}

.book-content-view__section-list {
  list-style: none;
  padding: 0;
  margin: 0;
}

.book-content-view__section-list li {
  padding: 0.375rem 0;
  font-size: 0.75rem;
  color: var(--studio-text);
  border-bottom: 1px solid var(--studio-border);
}

.book-content-view__section-list li:last-child {
  border-bottom: none;
}

.book-content-view__section-passages {
  color: var(--studio-text-tertiary);
}

/* Marginalia Note */
.marginalia-note {
  padding: 0.75rem;
  margin-bottom: 0.75rem;
  background: var(--studio-surface);
  border-radius: 6px;
  border-left: 3px solid var(--studio-border);
}

.marginalia-note--note { border-left-color: #3b82f6; }
.marginalia-note--source { border-left-color: #22c55e; }
.marginalia-note--todo { border-left-color: #f59e0b; }
.marginalia-note--aui { border-left-color: #6366f1; }

.marginalia-note--resolved {
  opacity: 0.6;
}

.marginalia-note__header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 0.5rem;
}

.marginalia-note__icon {
  font-size: 0.875rem;
}

.marginalia-note__time {
  font-size: 0.625rem;
  color: var(--studio-text-tertiary);
}

.marginalia-note__content {
  font-size: 0.8125rem;
  line-height: 1.5;
  color: var(--studio-text-secondary);
}

.marginalia-note__source {
  margin-top: 0.5rem;
  font-size: 0.6875rem;
  color: var(--studio-text-tertiary);
}

/* ═══════════════════════════════════════════════════════════════════
   CONTAINER WORKSPACE - Unified container display
   ═══════════════════════════════════════════════════════════════════ */

.container-workspace {
  display: flex;
  flex-direction: column;
  height: 100%;
  overflow: hidden;
  background: var(--studio-bg, #f8f6f3);
}

.container-workspace__header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: var(--space-sm, 0.5rem) var(--space-md, 1rem);
  background: var(--studio-panel-bg, #f5f3ef);
  border-bottom: 1px solid var(--studio-border, #e5e2dc);
  min-height: 48px;
}

.container-workspace__header-left {
  display: flex;
  align-items: center;
  gap: 0.75rem;
}

.container-workspace__back {
  width: 32px;
  height: 32px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: transparent;
  border: 1px solid var(--studio-border, #e5e2dc);
  border-radius: 6px;
  color: var(--studio-text, #333);
  cursor: pointer;
  transition: all 0.15s ease;
  font-size: 1rem;
}

.container-workspace__back:hover {
  background: var(--studio-hover, rgba(0,0,0,0.05));
  border-color: var(--studio-accent, #8b7355);
}

.container-workspace__title-group {
  display: flex;
  flex-direction: column;
  gap: 0.125rem;
}

.container-workspace__type-badge {
  font-size: 0.6875rem;
  font-weight: 500;
  color: var(--studio-text-secondary, #666);
  text-transform: capitalize;
}

.container-workspace__title {
  font-size: 1rem;
  font-weight: 600;
  color: var(--studio-text, #333);
  margin: 0;
  line-height: 1.3;
}

.container-workspace__meta {
  font-size: 0.6875rem;
  color: var(--studio-text-tertiary, #999);
}

.container-workspace__actions {
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

.container-workspace__action {
  padding: 0.375rem 0.75rem;
  background: transparent;
  border: 1px solid var(--studio-border, #e5e2dc);
  border-radius: 4px;
  font-size: 0.75rem;
  color: var(--studio-text, #333);
  cursor: pointer;
  transition: all 0.15s ease;
}

.container-workspace__action:hover {
  background: var(--studio-hover, rgba(0,0,0,0.05));
}

.container-workspace__action--active {
  background: var(--studio-accent, #8b7355);
  color: white;
  border-color: var(--studio-accent, #8b7355);
}

.container-workspace__badge {
  padding: 0.25rem 0.5rem;
  background: var(--studio-surface, #fff);
  border: 1px solid var(--studio-border, #e5e2dc);
  border-radius: 4px;
  font-size: 0.6875rem;
  color: var(--studio-text-secondary, #666);
}

/* Quick action buttons (download, copy, md) */
.container-workspace__quick-actions {
  display: flex;
  align-items: center;
  gap: 0.25rem;
  margin-left: 0.5rem;
  padding: 0.125rem;
  background: var(--studio-surface, #fff);
  border: 1px solid var(--studio-border, #e5e2dc);
  border-radius: 4px;
}

.container-workspace__quick-btn {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 28px;
  height: 28px;
  font-size: 0.875rem;
  color: var(--studio-text-secondary, #666);
  background: transparent;
  border: none;
  border-radius: 4px;
  cursor: pointer;
  transition: all 0.15s ease;
}

.container-workspace__quick-btn:hover {
  color: var(--studio-text, #333);
  background: var(--studio-hover, rgba(0,0,0,0.05));
}

.container-workspace__quick-btn:active {
  transform: scale(0.95);
}

.container-workspace__quick-btn--md {
  font-size: 0.625rem;
  font-weight: 600;
  letter-spacing: 0.5px;
}

/* Content area */
.container-workspace__content {
  flex: 1;
  overflow-y: auto;
  padding: var(--space-md, 1rem) var(--space-lg, 1.5rem);
}

.container-workspace__content--markdown {
  max-width: min(50rem, 95%);  /* ~800px centered for readability */
  margin-left: auto;
  margin-right: auto;
  line-height: 1.7;
  font-size: 0.9375rem;
  color: var(--studio-text, #333);
  text-align: left;
}

.container-workspace__content--markdown h1 {
  font-size: 1.5rem;
  font-weight: 600;
  margin: 1.5rem 0 1rem;
  color: var(--studio-text, #333);
}

.container-workspace__content--markdown h2 {
  font-size: 1.25rem;
  font-weight: 600;
  margin: 1.25rem 0 0.75rem;
  color: var(--studio-text, #333);
}

.container-workspace__content--markdown p {
  margin: 0.75rem 0;
}

.container-workspace__content--markdown pre {
  background: var(--studio-surface, #fff);
  border: 1px solid var(--studio-border, #e5e2dc);
  border-radius: 6px;
  padding: 1rem;
  overflow-x: auto;
  font-size: 0.8125rem;
}

.container-workspace__content--markdown code {
  font-family: 'JetBrains Mono', monospace;
  font-size: 0.875em;
}

.container-workspace__content--markdown blockquote {
  border-left: 3px solid var(--studio-accent, #8b7355);
  margin: 1rem 0;
  padding-left: 1rem;
  color: var(--studio-text-secondary, #666);
  font-style: italic;
}

.container-workspace__content--markdown hr {
  border: none;
  border-top: 1px solid var(--studio-border, #e5e2dc);
  margin: 1.5rem 0;
}

.container-workspace__content--text {
  max-width: min(50rem, 95%);  /* ~800px centered for readability */
  margin-left: auto;
  margin-right: auto;
  white-space: pre-wrap;
  font-family: inherit;
  line-height: 1.7;
  color: var(--studio-text, #333);
  text-align: left;
}

/* Artifacts panel */
.container-workspace__artifacts {
  border-top: 1px solid var(--studio-border, #e5e2dc);
  padding: var(--space-md, 1rem);
  background: var(--studio-panel-bg, #f5f3ef);
}

.container-workspace__artifacts h3 {
  font-size: 0.75rem;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.05em;
  color: var(--studio-text-secondary, #666);
  margin: 0 0 0.75rem;
}

.container-workspace__artifact {
  margin-bottom: 0.5rem;
  background: var(--studio-surface, #fff);
  border: 1px solid var(--studio-border, #e5e2dc);
  border-radius: 6px;
}

.container-workspace__artifact summary {
  padding: 0.5rem 0.75rem;
  font-size: 0.8125rem;
  cursor: pointer;
  user-select: none;
}

.container-workspace__artifact summary:hover {
  background: var(--studio-hover, rgba(0,0,0,0.03));
}

.container-workspace__artifact-content {
  padding: 0.75rem;
  background: var(--studio-bg, #f8f6f3);
  border-top: 1px solid var(--studio-border, #e5e2dc);
  font-size: 0.75rem;
  overflow-x: auto;
  margin: 0;
}

/* Media view */
.container-workspace--media {
  background: var(--studio-surface, #fff);
}

.container-workspace__media-container {
  flex: 1;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: var(--space-md, 1rem);
  overflow: hidden;
  background: #1a1a1a;
}

.container-workspace__image {
  max-width: 100%;
  max-height: 100%;
  object-fit: contain;
  border-radius: 4px;
}

.container-workspace__video,
.container-workspace__audio {
  max-width: 100%;
  border-radius: 4px;
}

.container-workspace__metadata-panel {
  width: 280px;
  padding: var(--space-md, 1rem);
  background: var(--studio-panel-bg, #f5f3ef);
  border-left: 1px solid var(--studio-border, #e5e2dc);
  overflow-y: auto;
}

.container-workspace__metadata-panel h3 {
  font-size: 0.75rem;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.05em;
  color: var(--studio-text-secondary, #666);
  margin: 0 0 0.75rem;
}

.container-workspace__metadata-list {
  display: grid;
  grid-template-columns: auto 1fr;
  gap: 0.25rem 0.75rem;
  font-size: 0.75rem;
}

.container-workspace__metadata-list dt {
  color: var(--studio-text-tertiary, #999);
}

.container-workspace__metadata-list dd {
  color: var(--studio-text, #333);
  margin: 0;
  word-break: break-word;
}

/* Linked media thumbnails */
.container-workspace__linked-media {
  display: flex;
  gap: 0.5rem;
  padding: var(--space-sm, 0.5rem);
  border-top: 1px solid var(--studio-border, #e5e2dc);
  overflow-x: auto;
}

.container-workspace__media-thumb {
  width: 60px;
  height: 60px;
  border-radius: 4px;
  overflow: hidden;
  flex-shrink: 0;
}

.container-workspace__media-thumb img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

/* ═══════════════════════════════════════════════════════════════════
   GALLERY VIEW - OpenAI/Facebook Media Browser
   ═══════════════════════════════════════════════════════════════════ */

.gallery-view {
  display: flex;
  flex-direction: column;
  height: 100%;
  overflow: hidden;
}

.gallery-view__header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: var(--space-sm, 0.5rem);
  background: var(--studio-panel-bg, #f5f3ef);
  border-bottom: 1px solid var(--studio-border, #e5e2dc);
}

.gallery-view__tabs {
  display: flex;
  gap: 0.25rem;
}

.gallery-view__tab {
  padding: 0.375rem 0.75rem;
  font-size: 0.75rem;
  color: var(--studio-text-secondary, #666);
  background: transparent;
  border: 1px solid var(--studio-border, #e5e2dc);
  border-radius: 4px;
  cursor: pointer;
  transition: all 0.15s ease;
}

.gallery-view__tab:hover {
  background: var(--studio-hover, rgba(0,0,0,0.05));
}

.gallery-view__tab--active {
  background: var(--studio-accent, #8b7355);
  color: white;
  border-color: var(--studio-accent, #8b7355);
}

.gallery-view__controls {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 0.375rem 0.5rem;
  background: var(--studio-panel-bg, #f5f3ef);
  border-bottom: 1px solid var(--studio-border, #e5e2dc);
  font-size: 0.6875rem;
}

.gallery-view__count {
  color: var(--studio-text-secondary, #666);
}

.gallery-view__size-control {
  display: flex;
  align-items: center;
  gap: 0.375rem;
  color: var(--studio-text-secondary, #666);
}

.gallery-view__size-control input[type="range"] {
  width: 60px;
  height: 4px;
  cursor: pointer;
}

.gallery-view__grid {
  display: grid;
  gap: 6px;
  padding: 0.75rem;
  overflow-y: auto;
  flex: 1;
}

.gallery-view__item {
  position: relative;
  overflow: hidden;
  border-radius: 4px;
  cursor: pointer;
  background: var(--studio-hover, rgba(0,0,0,0.05));
  transition: transform 0.15s ease, box-shadow 0.15s ease;
}

.gallery-view__item:hover {
  transform: scale(1.02);
  box-shadow: 0 2px 8px rgba(0,0,0,0.15);
}

.gallery-view__item img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.gallery-view__loading,
.gallery-view__error,
.gallery-view__empty {
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 2rem;
  color: var(--studio-text-secondary, #666);
  font-size: 0.875rem;
}

.gallery-view__error {
  flex-direction: column;
  gap: 0.5rem;
}

.gallery-view__error button,
.gallery-view__load-more {
  padding: 0.5rem 1rem;
  font-size: 0.75rem;
  color: white;
  background: var(--studio-accent, #8b7355);
  border: none;
  border-radius: 4px;
  cursor: pointer;
}

.gallery-view__load-more {
  display: block;
  margin: 0.5rem auto 1rem;
}

/* Lightbox - Enhanced with ARIA and description panel */
.gallery-view__lightbox {
  position: fixed;
  inset: 0;
  z-index: 1000;
  display: flex;
  align-items: center;
  justify-content: center;
  background: rgba(0, 0, 0, 0.95);
  outline: none; /* Focus handled by ref */
}

.gallery-view__lightbox-close {
  position: absolute;
  top: 1rem;
  right: 1rem;
  width: 44px; /* WCAG touch target */
  height: 44px;
  font-size: 1.5rem;
  color: white;
  background: rgba(255, 255, 255, 0.2);
  border: none;
  border-radius: 50%;
  cursor: pointer;
  z-index: 10;
  transition: background 0.15s ease;
}

.gallery-view__lightbox-close:hover,
.gallery-view__lightbox-close:focus-visible {
  background: rgba(255, 255, 255, 0.3);
}

.gallery-view__lightbox-close:focus-visible {
  outline: 2px solid white;
  outline-offset: 2px;
}

/* Navigation buttons */
.gallery-view__lightbox-nav {
  position: absolute;
  top: 50%;
  transform: translateY(-50%);
  width: 48px;
  height: 48px;
  font-size: 2rem;
  color: white;
  background: rgba(255, 255, 255, 0.15);
  border: none;
  border-radius: 50%;
  cursor: pointer;
  z-index: 10;
  transition: background 0.15s ease, opacity 0.15s ease;
}

.gallery-view__lightbox-nav:hover:not(:disabled) {
  background: rgba(255, 255, 255, 0.25);
}

.gallery-view__lightbox-nav:disabled {
  opacity: 0.3;
  cursor: default;
}

.gallery-view__lightbox-nav:focus-visible {
  outline: 2px solid white;
  outline-offset: 2px;
}

.gallery-view__lightbox-nav--prev {
  left: 1rem;
}

.gallery-view__lightbox-nav--next {
  right: 1rem;
}

/* Content container */
.gallery-view__lightbox-content {
  display: flex;
  flex-direction: column;
  max-width: 90vw;
  max-height: 90vh;
  gap: 1rem;
}

.gallery-view__lightbox-image {
  max-width: 100%;
  max-height: calc(90vh - 200px);
  object-fit: contain;
  border-radius: 4px;
}

/* Info panel */
.gallery-view__lightbox-info {
  background: rgba(255, 255, 255, 0.1);
  backdrop-filter: blur(10px);
  border-radius: 8px;
  padding: 1rem;
  color: white;
  max-width: 600px;
  margin: 0 auto;
}

.gallery-view__lightbox-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 0.75rem;
  padding-bottom: 0.75rem;
  border-bottom: 1px solid rgba(255, 255, 255, 0.2);
}

.gallery-view__lightbox-title {
  margin: 0;
  font-size: 1rem;
  font-weight: 500;
}

.gallery-view__lightbox-date {
  font-size: 0.75rem;
  opacity: 0.7;
}

.gallery-view__lightbox-description {
  margin-bottom: 0.75rem;
  line-height: 1.5;
}

.gallery-view__lightbox-description p {
  margin: 0;
}

.gallery-view__lightbox-loading,
.gallery-view__lightbox-no-analysis {
  opacity: 0.6;
  font-style: italic;
  font-size: 0.875rem;
  margin: 0.5rem 0;
}

/* Tags */
.gallery-view__lightbox-tags {
  display: flex;
  flex-wrap: wrap;
  gap: 0.5rem;
  margin-bottom: 0.75rem;
}

.gallery-view__lightbox-tag {
  background: rgba(255, 255, 255, 0.2);
  padding: 0.25rem 0.5rem;
  border-radius: 4px;
  font-size: 0.75rem;
}

/* Objects */
.gallery-view__lightbox-objects {
  font-size: 0.8rem;
  opacity: 0.85;
  margin-bottom: 0.5rem;
}

/* Scene and Mood */
.gallery-view__lightbox-meta {
  display: flex;
  gap: 1.5rem;
  font-size: 0.8rem;
  opacity: 0.85;
  margin-bottom: 0.5rem;
}

.gallery-view__lightbox-meta-item {
  display: inline-flex;
  gap: 0.25rem;
}

.gallery-view__lightbox-label {
  font-weight: 500;
}

/* Keyboard hint */
.gallery-view__lightbox-hint {
  font-size: 0.7rem;
  opacity: 0.5;
  text-align: center;
  margin-top: 0.75rem;
  padding-top: 0.5rem;
  border-top: 1px solid rgba(255, 255, 255, 0.1);
}

/* Search bar */
.gallery-view__search-bar {
  display: flex;
  align-items: center;
  gap: var(--space-sm, 0.5rem);
  padding: var(--space-sm, 0.5rem);
  background: var(--studio-panel-bg, #f5f3ef);
  border-bottom: 1px solid var(--studio-border, #e5e2dc);
}

.gallery-view__search {
  flex: 1;
  padding: 0.375rem 0.75rem;
  font-size: 0.75rem;
  color: var(--studio-text, #1a1a1a);
  background: var(--studio-surface, #fff);
  border: 1px solid var(--studio-border, #e5e2dc);
  border-radius: 4px;
  outline: none;
  transition: border-color 0.15s ease;
}

.gallery-view__search:focus {
  border-color: var(--studio-accent, #8b7355);
}

.gallery-view__search::placeholder {
  color: var(--studio-text-tertiary, #999);
}

.gallery-view__search-spinner {
  width: 14px;
  height: 14px;
  border: 2px solid var(--studio-border, #e5e2dc);
  border-top-color: var(--studio-accent, #8b7355);
  border-radius: 50%;
  animation: spin 0.8s linear infinite;
}

/* Progress indicator */
.gallery-view__progress {
  display: flex;
  align-items: center;
  gap: var(--space-sm, 0.5rem);
  padding: var(--space-xs, 0.25rem) var(--space-sm, 0.5rem);
  background: rgba(var(--studio-accent-rgb, 139, 115, 85), 0.1);
  border-bottom: 1px solid var(--studio-border, #e5e2dc);
}

.gallery-view__progress-bar {
  flex: 1;
  height: 4px;
  background: var(--studio-border, #e5e2dc);
  border-radius: 2px;
  overflow: hidden;
}

.gallery-view__progress-fill {
  height: 100%;
  background: var(--studio-accent, #8b7355);
  transition: width 0.3s ease;
}

.gallery-view__progress-text {
  font-size: 0.6875rem;
  color: var(--studio-text-secondary, #666);
  white-space: nowrap;
}

/* Action button (Analyze All) */
.gallery-view__action {
  padding: 0.375rem 0.75rem;
  font-size: 0.75rem;
  color: white;
  background: var(--studio-accent, #8b7355);
  border: none;
  border-radius: 4px;
  cursor: pointer;
  transition: opacity 0.15s ease;
  white-space: nowrap;
}

.gallery-view__action:hover:not(:disabled) {
  opacity: 0.9;
}

.gallery-view__action:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

/* Category tags */
.gallery-view__tags {
  position: absolute;
  bottom: 4px;
  left: 4px;
  right: 4px;
  display: flex;
  gap: 2px;
  flex-wrap: wrap;
}

.gallery-view__tag {
  padding: 1px 4px;
  font-size: 0.5625rem;
  color: white;
  background: rgba(0, 0, 0, 0.6);
  border-radius: 2px;
  max-width: 60px;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

/* Analyzed item indicator */
.gallery-view__item--analyzed::after {
  content: '';
  position: absolute;
  top: 4px;
  right: 4px;
  width: 8px;
  height: 8px;
  background: var(--studio-success, #10b981);
  border-radius: 50%;
  border: 1px solid white;
}

/* ═══════════════════════════════════════════════════════════════════
   FACEBOOK TAB - Feed and Gallery Views
   ═══════════════════════════════════════════════════════════════════ */

.facebook-view {
  display: flex;
  flex-direction: column;
  height: 100%;
  overflow: hidden;
}

/* Header with tabs */
.facebook-view__header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 0.5rem;
  border-bottom: 1px solid var(--studio-border);
  background: var(--studio-panel-bg);
  flex-shrink: 0;
}

.facebook-view__tabs {
  display: flex;
  gap: 0.25rem;
}

.facebook-view__tab {
  padding: 0.375rem 0.75rem;
  font-size: 0.75rem;
  font-weight: 600;
  color: var(--studio-text-secondary);
  background: transparent;
  border: 1px solid var(--studio-border);
  border-radius: 4px;
  cursor: pointer;
  transition: all 0.15s ease;
}

.facebook-view__tab:hover {
  background: var(--studio-hover);
  color: var(--studio-text);
}

.facebook-view__tab--active {
  background: var(--studio-accent);
  color: white;
  border-color: var(--studio-accent);
}

.facebook-view__tab--graph {
  background: var(--studio-accent, #8b7355);
  color: white;
  border-color: var(--studio-accent, #8b7355);
}

.facebook-view__tab--graph:hover {
  background: var(--studio-accent-hover, #7a6548);
  border-color: var(--studio-accent-hover, #7a6548);
}

.facebook-view__period-btn {
  display: flex;
  align-items: center;
  gap: 0.375rem;
  padding: 0.375rem 0.625rem;
  font-size: 0.75rem;
  color: var(--studio-text);
  background: var(--studio-panel-bg);
  border: 1px solid var(--studio-border);
  border-radius: 4px;
  cursor: pointer;
}

.facebook-view__period-btn:hover {
  border-color: var(--studio-accent);
}

.facebook-view__period-count {
  font-size: 0.6875rem;
  color: var(--studio-text-secondary);
}

/* Period picker dropdown */
.facebook-view__period-picker {
  position: absolute;
  top: 100%;
  right: 0;
  width: 200px;
  max-height: 300px;
  overflow-y: auto;
  background: var(--studio-panel-bg);
  border: 1px solid var(--studio-border);
  border-radius: 6px;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
  z-index: 100;
}

.facebook-view__period-option {
  display: block;
  width: 100%;
  padding: 0.5rem 0.75rem;
  font-size: 0.75rem;
  color: var(--studio-text);
  background: transparent;
  border: none;
  border-bottom: 1px solid var(--studio-border);
  text-align: left;
  cursor: pointer;
}

.facebook-view__period-option:hover {
  background: var(--studio-hover);
}

.facebook-view__period-option--active {
  background: var(--studio-accent);
  color: white;
}

/* Feed View */
.facebook-view__feed {
  flex: 1;
  display: flex;
  flex-direction: column;
  overflow: hidden;
}

.facebook-view__filters {
  padding: 0.5rem;
  border-bottom: 1px solid var(--studio-border);
  flex-shrink: 0;
}

.facebook-view__search {
  width: 100%;
  padding: 0.375rem 0.625rem;
  margin-bottom: 0.5rem;
  font-size: 0.75rem;
  color: var(--studio-text);
  background: var(--studio-panel-bg);
  border: 1px solid var(--studio-border);
  border-radius: 4px;
}

.facebook-view__filter-row {
  display: flex;
  align-items: center;
  gap: 0.25rem;
  flex-wrap: wrap;
}

.facebook-view__filter-btn {
  padding: 0.25rem 0.5rem;
  font-size: 0.6875rem;
  color: var(--studio-text);
  background: var(--studio-panel-bg);
  border: 1px solid var(--studio-border);
  border-radius: 4px;
  cursor: pointer;
}

.facebook-view__filter-btn:hover {
  background: var(--studio-hover);
}

.facebook-view__filter-btn--active {
  background: var(--studio-accent);
  color: white;
  border-color: var(--studio-accent);
}

.facebook-view__checkbox {
  display: flex;
  align-items: center;
  gap: 0.25rem;
  margin-left: auto;
  font-size: 0.6875rem;
  color: var(--studio-text-secondary);
  cursor: pointer;
}

.facebook-view__feed-list {
  flex: 1;
  overflow-y: auto;
  padding: 0.5rem;
}

.facebook-view__item {
  padding: 0.625rem;
  margin-bottom: 0.5rem;
  background: var(--studio-panel-bg);
  border: 1px solid var(--studio-border);
  border-radius: 6px;
  cursor: pointer;
  transition: all 0.15s ease;
}

.facebook-view__item:hover {
  border-color: var(--studio-accent);
  background: var(--studio-hover);
}

.facebook-view__item-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 0.375rem;
}

.facebook-view__item-type {
  font-size: 0.625rem;
  font-weight: 600;
  text-transform: uppercase;
  padding: 0.125rem 0.375rem;
  border-radius: 3px;
}

.facebook-view__item-type--post {
  background: rgba(66, 103, 178, 0.15);
  color: #4267B2;
}

.facebook-view__item-type--comment {
  background: rgba(76, 175, 80, 0.15);
  color: #4CAF50;
}

.facebook-view__item-date {
  font-size: 0.6875rem;
  color: var(--studio-text-secondary);
}

.facebook-view__item-title {
  font-size: 0.8125rem;
  font-weight: 500;
  color: var(--studio-text);
  margin-bottom: 0.25rem;
}

.facebook-view__item-text {
  font-size: 0.75rem;
  line-height: 1.4;
  color: var(--studio-text);
}

.facebook-view__item-media {
  margin-top: 0.375rem;
  font-size: 0.6875rem;
  color: var(--studio-accent);
}

/* Gallery View */
.facebook-view__gallery {
  flex: 1;
  display: flex;
  flex-direction: column;
  overflow: hidden;
}

.facebook-view__stats {
  padding: 0.375rem 0.5rem;
  font-size: 0.6875rem;
  color: var(--studio-text-secondary);
  border-bottom: 1px solid var(--studio-border);
  flex-shrink: 0;
}

.facebook-view__stats-sep {
  margin: 0 0.375rem;
  opacity: 0.5;
}

.facebook-view__size-slider {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  padding: 0.375rem 0.5rem;
  font-size: 0.6875rem;
  color: var(--studio-text-secondary);
  border-bottom: 1px solid var(--studio-border);
  flex-shrink: 0;
}

.facebook-view__size-slider input[type="range"] {
  flex: 1;
  cursor: pointer;
}

.facebook-view__grid {
  flex: 1;
  overflow-y: auto;
  padding: 0.5rem;
  display: grid;
  gap: 4px;
  align-content: start;
}

.facebook-view__thumb {
  border-radius: 3px;
  overflow: hidden;
  background: var(--studio-panel-bg);
  border: 1px solid var(--studio-border);
  cursor: pointer;
  transition: border-color 0.15s ease;
}

.facebook-view__thumb:hover {
  border-color: var(--studio-accent);
}

.facebook-view__thumb img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.facebook-view__thumb-video {
  width: 100%;
  height: 100%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 0.625rem;
  color: var(--studio-text-secondary);
}

/* Common */
.facebook-view__loading {
  text-align: center;
  padding: 1rem;
  font-size: 0.75rem;
  color: var(--studio-text-secondary);
}

.facebook-view__empty {
  text-align: center;
  padding: 2rem;
  color: var(--studio-text-secondary);
}

.facebook-view__empty p {
  margin: 0 0 0.5rem 0;
  font-size: 0.875rem;
}

.facebook-view__empty span {
  font-size: 0.75rem;
  opacity: 0.7;
}

.facebook-view__error {
  padding: 0.75rem;
  margin-bottom: 0.5rem;
  background: rgba(220, 53, 69, 0.1);
  color: #dc3545;
  border-radius: 4px;
  font-size: 0.75rem;
}

.facebook-view__graph {
  flex: 1;
  display: flex;
  flex-direction: column;
  min-height: 0;
  overflow: hidden;
}

/* ═══════════════════════════════════════════════════════════════════
   NETWORK GRAPH - Force-directed social graph visualization
   ═══════════════════════════════════════════════════════════════════ */

.network-graph {
  position: relative;
  width: 100%;
  height: 100%;
  min-height: 500px;
  display: flex;
  flex-direction: column;
  background: var(--studio-bg);
  overflow: hidden;
}

.network-graph--loading,
.network-graph--error {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: var(--space-xlarge);
  gap: var(--space-medium);
}

.network-graph__spinner {
  width: 32px;
  height: 32px;
  border: 3px solid var(--studio-border);
  border-top-color: var(--studio-accent);
  border-radius: var(--radius-full);
  animation: network-graph-spin 1s linear infinite;
}

@keyframes network-graph-spin {
  from { transform: rotate(0deg); }
  to { transform: rotate(360deg); }
}

.network-graph__loading-text {
  font-size: var(--text-size-small);
  color: var(--studio-text-secondary);
}

.network-graph__error-icon {
  width: 48px;
  height: 48px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.5rem;
  font-weight: 700;
  color: var(--color-status-error);
  background: rgba(220, 53, 69, 0.1);
  border-radius: var(--radius-full);
}

.network-graph__error-text {
  font-size: var(--text-size-small);
  color: var(--color-status-error);
}

.network-graph__retry-btn {
  padding: var(--space-small) var(--space-medium);
  font-size: var(--text-size-small);
  font-weight: 500;
  background: var(--studio-accent);
  color: white;
  border: none;
  border-radius: var(--radius-medium);
  cursor: pointer;
  transition: background var(--duration-fast) var(--ease-out);
}

.network-graph__retry-btn:hover {
  background: var(--studio-accent-hover);
}

/* Controls */
.network-graph__controls {
  display: flex;
  flex-wrap: wrap;
  align-items: center;
  gap: var(--space-medium);
  padding: var(--space-small) var(--space-medium);
  background: var(--studio-quote-bg);
  border-bottom: 1px solid var(--studio-border);
  z-index: 10;
}

.network-graph__control-group {
  display: flex;
  align-items: center;
  gap: var(--space-small);
}

.network-graph__label {
  font-size: 0.6875rem;
  color: var(--studio-text-secondary);
  white-space: nowrap;
}

.network-graph__slider {
  width: 80px;
  height: 4px;
  appearance: none;
  background: var(--studio-border);
  border-radius: 2px;
  cursor: pointer;
}

.network-graph__slider::-webkit-slider-thumb {
  appearance: none;
  width: 14px;
  height: 14px;
  background: var(--studio-accent);
  border-radius: var(--radius-full);
  cursor: pointer;
}

.network-graph__checkbox {
  display: flex;
  align-items: center;
  gap: var(--space-tiny);
  font-size: 0.6875rem;
  color: var(--studio-text-secondary);
  cursor: pointer;
}

.network-graph__btn {
  padding: var(--space-tiny) var(--space-small);
  font-size: 0.6875rem;
  font-weight: 500;
  background: var(--studio-panel-bg);
  color: var(--studio-text);
  border: 1px solid var(--studio-border);
  border-radius: var(--radius-small);
  cursor: pointer;
  transition: all var(--duration-fast) var(--ease-out);
}

.network-graph__btn:hover {
  background: var(--studio-accent);
  color: white;
  border-color: var(--studio-accent);
}

/* Stats Bar */
.network-graph__stats {
  display: flex;
  flex-wrap: wrap;
  align-items: center;
  gap: var(--space-medium);
  padding: var(--space-tiny) var(--space-medium);
  background: var(--studio-panel-bg);
  border-bottom: 1px solid var(--studio-border);
  font-size: 0.6875rem;
  color: var(--studio-text-secondary);
}

.network-graph__stat {
  display: flex;
  align-items: center;
  gap: var(--space-tiny);
}

.network-graph__stat strong {
  color: var(--studio-text);
}

.network-graph__stat-type {
  display: flex;
  align-items: center;
  gap: 4px;
}

.network-graph__stat-dot {
  width: 8px;
  height: 8px;
  border-radius: var(--radius-full);
}

/* SVG Canvas */
.network-graph__svg {
  flex: 1;
  width: 100%;
  cursor: grab;
  user-select: none;
}

.network-graph__svg:active {
  cursor: grabbing;
}

/* Links */
.network-graph__link {
  pointer-events: none;
}

/* Nodes */
.network-graph__node-group {
  cursor: pointer;
}

.network-graph__node {
  fill: var(--studio-accent);
  stroke: var(--studio-bg);
  stroke-width: 2;
  transition: all var(--duration-fast) var(--ease-out);
}

.network-graph__node--self {
  fill: var(--color-status-success);
  stroke-width: 3;
}

.network-graph__node--discovered {
  fill: var(--color-status-warning);
}

.network-graph__node--hovered {
  stroke: var(--studio-text);
  stroke-width: 3;
  filter: brightness(1.2);
}

.network-graph__node--selected {
  stroke: var(--studio-accent);
  stroke-width: 4;
}

/* Node Labels */
.network-graph__label-text {
  font-size: 10px;
  fill: var(--studio-text-secondary);
  font-family: var(--font-family-body);
  pointer-events: none;
}

.network-graph__label-text--self {
  font-size: 12px;
  font-weight: 600;
  fill: var(--studio-text);
}

/* Detail Panel */
.network-graph__detail {
  position: absolute;
  top: var(--space-medium);
  right: var(--space-medium);
  padding: var(--space-medium);
  background: var(--studio-panel-bg);
  border: 1px solid var(--studio-border);
  border-radius: var(--radius-large);
  box-shadow: var(--shadow-large);
  min-width: 180px;
  z-index: 20;
}

.network-graph__detail-name {
  font-size: 0.9375rem;
  font-weight: 600;
  color: var(--studio-text);
  margin: 0 0 var(--space-small) 0;
}

.network-graph__detail-stat {
  margin: 0;
  font-size: 0.75rem;
  color: var(--studio-text-secondary);
  line-height: 1.5;
}

.network-graph__detail-stat strong {
  color: var(--studio-text);
}

/* Legend */
.network-graph__legend {
  position: absolute;
  bottom: var(--space-medium);
  left: var(--space-medium);
  padding: var(--space-small) var(--space-medium);
  background: var(--studio-panel-bg);
  border: 1px solid var(--studio-border);
  border-radius: var(--radius-medium);
  box-shadow: var(--shadow-medium);
  z-index: 20;
}

.network-graph__legend-title {
  font-size: 0.6875rem;
  font-weight: 600;
  color: var(--studio-text);
  margin-bottom: var(--space-tiny);
}

.network-graph__legend-item {
  display: flex;
  align-items: center;
  gap: var(--space-small);
  font-size: 0.625rem;
  color: var(--studio-text-secondary);
  padding: 2px 0;
}

.network-graph__legend-circle {
  width: 10px;
  height: 10px;
  border-radius: var(--radius-full);
  border: 2px solid var(--studio-bg);
}

.network-graph__legend-circle--self {
  background: var(--color-status-success);
}

.network-graph__legend-circle--friend {
  background: var(--studio-accent);
}

.network-graph__legend-circle--discovered {
  background: var(--color-status-warning);
}

/* Lightbox */
.facebook-lightbox {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0, 0, 0, 0.95);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 10000;
}

.facebook-lightbox__close {
  position: fixed;
  top: 1rem;
  right: 1rem;
  padding: 0.5rem 1rem;
  font-size: 0.875rem;
  font-weight: 600;
  color: #000;
  background: rgba(255, 255, 255, 0.9);
  border: none;
  border-radius: 4px;
  cursor: pointer;
  z-index: 10001;
}

.facebook-lightbox__close:hover {
  background: #fff;
}

.facebook-lightbox__nav {
  position: fixed;
  top: 50%;
  transform: translateY(-50%);
  width: 50px;
  height: 50px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 2rem;
  font-weight: 300;
  color: #000;
  background: rgba(255, 255, 255, 0.9);
  border: none;
  border-radius: 50%;
  cursor: pointer;
  z-index: 10001;
}

.facebook-lightbox__nav:hover {
  background: #fff;
}

.facebook-lightbox__nav--prev {
  left: 1.5rem;
}

.facebook-lightbox__nav--next {
  right: 1.5rem;
}

.facebook-lightbox__image {
  max-width: 90vw;
  max-height: 85vh;
  object-fit: contain;
  cursor: zoom-in;
  transition: none;
}

.facebook-lightbox__image--zoomed {
  max-width: none;
  max-height: none;
  cursor: zoom-out;
}

.facebook-lightbox__info {
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  padding: 1rem;
  background: linear-gradient(transparent, rgba(0, 0, 0, 0.8));
  color: #fff;
  text-align: center;
}

.facebook-lightbox__counter {
  font-size: 0.875rem;
  font-weight: 600;
  margin-bottom: 0.25rem;
}

.facebook-lightbox__filename {
  font-size: 0.75rem;
  opacity: 0.8;
  margin-bottom: 0.25rem;
}

.facebook-lightbox__meta {
  font-size: 0.6875rem;
  opacity: 0.6;
}

.facebook-lightbox__context {
  margin-top: 0.75rem;
  padding-top: 0.75rem;
  border-top: 1px solid rgba(255, 255, 255, 0.2);
  text-align: left;
  max-width: 600px;
  margin-left: auto;
  margin-right: auto;
}

.facebook-lightbox__context-loading {
  font-size: 0.75rem;
  opacity: 0.6;
  margin-top: 0.5rem;
}

.facebook-lightbox__related {
  font-size: 0.75rem;
}

.facebook-lightbox__related strong {
  display: block;
  margin-bottom: 0.25rem;
  opacity: 0.8;
}

.facebook-lightbox__related-link {
  display: block;
  padding: 0.25rem 0;
  color: var(--studio-accent, #a87e5c);
  background: none;
  border: none;
  text-align: left;
  cursor: pointer;
  font-size: 0.6875rem;
}

.facebook-lightbox__related-link:hover {
  text-decoration: underline;
}

.facebook-lightbox__albums {
  margin-top: 0.5rem;
  font-size: 0.6875rem;
  opacity: 0.7;
}

/* ═══════════════════════════════════════════════════════════════════
   EXPLORE TAB
   ═══════════════════════════════════════════════════════════════════ */

.explore-tab {
  display: flex;
  flex-direction: column;
  gap: 1rem;
}

.explore-search {
  position: relative;
}

.explore-search__input {
  width: 100%;
  padding: 0.75rem 1rem 0.75rem 2.5rem;
  font-size: 0.875rem;
  color: var(--studio-text);
  background: var(--studio-panel-bg);
  border: 1px solid var(--studio-border);
  border-radius: 8px;
  transition: border-color 0.15s ease;
}

.explore-search__input:focus {
  outline: none;
  border-color: var(--studio-accent);
}

.explore-search__icon {
  position: absolute;
  left: 0.875rem;
  top: 50%;
  transform: translateY(-50%);
  font-size: 1rem;
  color: var(--studio-text-secondary);
  pointer-events: none;
}

.explore-search__aui-badge {
  position: absolute;
  right: 0.5rem;
  top: 50%;
  transform: translateY(-50%);
  padding: 0.25rem 0.5rem;
  font-size: 0.7rem;
  font-weight: 600;
  color: var(--color-primary, var(--studio-accent));
  background: var(--color-primary-soft, rgba(99, 102, 241, 0.1));
  border-radius: 4px;
  pointer-events: none;
  animation: aui-badge-pulse 2s ease-in-out infinite;
}

@keyframes aui-badge-pulse {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.7; }
}

.explore-results {
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
}

.explore-result {
  padding: 0.75rem;
  background: var(--studio-panel-bg);
  border: 1px solid var(--studio-border);
  border-radius: 6px;
  cursor: pointer;
  transition: all 0.15s ease;
}

.explore-result:hover {
  border-color: var(--studio-accent);
  background: var(--studio-hover);
}

.explore-result__score {
  font-size: 0.6875rem;
  font-weight: 600;
  padding: 0.125rem 0.375rem;
  border-radius: 3px;
  margin-bottom: 0.375rem;
  display: inline-block;
}

.explore-result__score--high {
  background: rgba(34, 197, 94, 0.15);
  color: #16a34a;
}

.explore-result__score--medium {
  background: rgba(245, 158, 11, 0.15);
  color: #d97706;
}

.explore-result__score--low {
  background: rgba(107, 114, 128, 0.15);
  color: #6b7280;
}

.explore-result__text {
  font-size: 0.875rem;
  line-height: 1.4;
  color: var(--studio-text);
}

.explore-result__source {
  font-size: 0.75rem;
  color: var(--studio-text-secondary);
  margin-bottom: 0.25rem;
}

.explore-result--clickable {
  cursor: pointer;
}

.explore-result--clickable:hover {
  border-color: var(--studio-accent);
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
}

.explore-result--clickable:focus {
  outline: 2px solid var(--studio-accent);
  outline-offset: 2px;
}

/* Explore Setup Banner */
.explore-setup {
  display: flex;
  gap: 1rem;
  padding: 1rem;
  background: var(--color-bg-secondary, var(--studio-panel-bg));
  border: 1px solid var(--color-border, var(--studio-border));
  border-radius: 8px;
  margin-bottom: 1rem;
}

.explore-setup__icon {
  font-size: 2rem;
  flex-shrink: 0;
}

.explore-setup__content {
  flex: 1;
}

.explore-setup__content h4 {
  margin: 0 0 0.5rem 0;
  font-size: 1rem;
  color: var(--color-text-primary, var(--studio-text));
}

.explore-setup__content p {
  margin: 0 0 0.75rem 0;
  font-size: 0.875rem;
  color: var(--color-text-secondary, var(--studio-text-secondary));
}

.explore-setup__warning {
  padding: 0.5rem;
  background: var(--color-warning-soft, rgba(245, 158, 11, 0.1));
  border-radius: 4px;
  font-size: 0.8rem;
  color: var(--color-warning, #d97706);
}

.explore-setup__warning code {
  font-family: monospace;
  background: rgba(0,0,0,0.1);
  padding: 0.125rem 0.25rem;
  border-radius: 2px;
}

.explore-setup__button {
  padding: 0.5rem 1rem;
  min-height: 44px;
  background: var(--color-primary, var(--studio-accent));
  color: white;
  border: none;
  border-radius: 6px;
  font-size: 0.875rem;
  font-weight: 500;
  cursor: pointer;
  transition: background 0.15s ease;
}

.explore-setup__button:hover {
  background: var(--color-primary-hover, #4f46e5);
}

/* Explore Building Progress */
.explore-building {
  padding: 1rem;
  background: var(--color-bg-secondary, var(--studio-panel-bg));
  border: 1px solid var(--color-primary, var(--studio-accent));
  border-radius: 8px;
  margin-bottom: 1rem;
}

.explore-building__header {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  font-weight: 500;
  margin-bottom: 0.75rem;
}

.explore-building__icon {
  animation: spin 1s linear infinite;
}

@keyframes spin {
  from { transform: rotate(0deg); }
  to { transform: rotate(360deg); }
}

.explore-building__progress {
  display: flex;
  align-items: center;
  gap: 0.75rem;
  margin-bottom: 0.5rem;
}

.explore-building__bar {
  flex: 1;
  height: 8px;
  background: var(--color-bg-tertiary, rgba(0,0,0,0.1));
  border-radius: 4px;
  overflow: hidden;
}

.explore-building__fill {
  height: 100%;
  background: var(--color-primary, var(--studio-accent));
  transition: width 0.3s ease;
}

.explore-building__percent {
  font-size: 0.875rem;
  font-weight: 500;
  min-width: 3rem;
  text-align: right;
}

.explore-building__phase {
  font-size: 0.75rem;
  color: var(--color-text-secondary, var(--studio-text-secondary));
}

.tool-panel__stats {
  display: block;
  margin-top: 0.5rem;
  font-size: 0.75rem;
  color: var(--color-text-tertiary, var(--studio-text-muted));
}

/* ═══════════════════════════════════════════════════════════════════
   SOCIAL GRAPH - Force-directed relationship visualization
   ═══════════════════════════════════════════════════════════════════ */

.social-graph {
  position: relative;
  width: 100%;
  height: 100%;
  min-height: 500px;
  display: flex;
  flex-direction: column;
  background: var(--color-surface-primary);
  overflow: hidden;
}

.social-graph--loading,
.social-graph--error {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: var(--space-huge);
  gap: var(--space-medium);
}

.social-graph__spinner {
  width: 32px;
  height: 32px;
  border: var(--border-width-thick) solid var(--color-border-subtle);
  border-top-color: var(--color-primary);
  border-radius: var(--radius-full);
  animation: social-graph-spin 1s linear infinite;
}

@keyframes social-graph-spin {
  from { transform: rotate(0deg); }
  to { transform: rotate(360deg); }
}

.social-graph__status {
  font-size: var(--text-size-body);
  color: var(--color-text-secondary);
}

.social-graph__status--error {
  color: var(--color-status-error);
}

.social-graph__error-icon {
  width: 48px;
  height: 48px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: var(--text-size-heading-2);
  font-weight: var(--font-weight-bold);
  color: var(--color-status-error);
  background: var(--color-status-error-subtle);
  border-radius: var(--radius-full);
}

/* Header */
.social-graph__header {
  display: flex;
  align-items: center;
  gap: var(--space-medium);
  padding: var(--space-medium) var(--space-large);
  background: var(--color-surface-secondary);
  border-bottom: var(--border-width-thin) solid var(--color-border-subtle);
}

.social-graph__close {
  padding: var(--space-small) var(--space-medium);
  font-size: var(--text-size-body);
  font-weight: var(--font-weight-medium);
  color: var(--color-text-primary);
  background: var(--color-surface-tertiary);
  border: var(--border-width-thin) solid var(--color-border-default);
  border-radius: var(--radius-medium);
  cursor: pointer;
  transition: all var(--duration-fast) var(--ease-out);
}

.social-graph__close:hover {
  background: var(--color-primary);
  color: var(--color-text-inverse);
  border-color: var(--color-primary);
}

.social-graph__title {
  font-size: var(--text-size-heading-3);
  font-weight: var(--font-weight-semibold);
  color: var(--color-text-primary);
  margin: 0;
}

.social-graph__stats {
  display: flex;
  gap: var(--space-medium);
  margin-left: auto;
}

.social-graph__stat {
  font-size: var(--text-size-small);
  color: var(--color-text-secondary);
}

.social-graph__stat strong {
  color: var(--color-text-primary);
}

/* Controls */
.social-graph__controls {
  display: flex;
  flex-wrap: wrap;
  align-items: center;
  gap: var(--space-large);
  padding: var(--space-small) var(--space-large);
  background: var(--color-surface-tertiary);
  border-bottom: var(--border-width-thin) solid var(--color-border-subtle);
}

.social-graph__zoom-controls {
  display: flex;
  align-items: center;
  gap: var(--space-small);
  padding-right: var(--space-large);
  border-right: var(--border-width-thin) solid var(--color-border-subtle);
}

.social-graph__zoom-btn {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 32px;
  height: 32px;
  font-size: 1.25rem;
  font-weight: bold;
  color: var(--color-text-primary);
  background: var(--color-surface-secondary);
  border: var(--border-width-thin) solid var(--color-border-subtle);
  border-radius: var(--radius-small);
  cursor: pointer;
  transition: all var(--duration-fast) var(--ease-out);
}

.social-graph__zoom-btn:hover {
  background: var(--color-primary);
  color: white;
  border-color: var(--color-primary);
}

.social-graph__zoom-level {
  min-width: 50px;
  text-align: center;
  font-size: var(--text-size-small);
  font-weight: var(--font-weight-semibold);
  color: var(--color-text-secondary);
}

.social-graph__control {
  display: flex;
  align-items: center;
  gap: var(--space-small);
}

.social-graph__label {
  font-size: var(--text-size-small);
  color: var(--color-text-secondary);
  white-space: nowrap;
}

.social-graph__slider {
  width: 100px;
  height: var(--space-tiny);
  appearance: none;
  background: var(--color-border-default);
  border-radius: var(--radius-tiny);
  cursor: pointer;
}

.social-graph__slider::-webkit-slider-thumb {
  appearance: none;
  width: 14px;
  height: 14px;
  background: var(--color-primary);
  border-radius: var(--radius-full);
  cursor: pointer;
}

.social-graph__checkbox {
  display: flex;
  align-items: center;
  gap: var(--space-tiny);
  font-size: var(--text-size-small);
  color: var(--color-text-secondary);
  cursor: pointer;
}

.social-graph__action {
  padding: var(--space-small) var(--space-medium);
  font-size: var(--text-size-small);
  font-weight: var(--font-weight-medium);
  background: var(--color-primary);
  color: var(--color-text-inverse);
  border: none;
  border-radius: var(--radius-medium);
  cursor: pointer;
  transition: background var(--duration-fast) var(--ease-out);
  min-height: var(--touch-target);
}

.social-graph__action:hover {
  background: var(--color-primary-hover);
}

.social-graph__action--secondary {
  background: var(--color-surface-secondary);
  color: var(--color-text-primary);
  border: var(--border-width-thin) solid var(--color-border-default);
}

.social-graph__action--secondary:hover {
  background: var(--color-surface-tertiary);
}

/* Canvas */
.social-graph__canvas {
  flex: 1;
  width: 100%;
  cursor: grab;
  user-select: none;
}

.social-graph__canvas:active {
  cursor: grabbing;
}

/* Links */
.social-graph__link {
  stroke: var(--color-archive-facebook);
  pointer-events: none;
}

/* Nodes */
.social-graph__node-group {
  cursor: pointer;
}

.social-graph__node {
  fill: var(--color-primary);
  stroke: var(--color-surface-primary);
  stroke-width: 2;
  transition: all var(--duration-fast) var(--ease-out);
}

.social-graph__node--self {
  fill: var(--color-sic-high);
  stroke-width: 3;
}

.social-graph__node--discovered {
  fill: var(--color-status-warning);
}

.social-graph__node--hovered {
  stroke: var(--color-text-primary);
  stroke-width: 3;
  filter: brightness(1.15);
}

.social-graph__node--selected {
  stroke: var(--color-accent);
  stroke-width: 4;
}

/* Node Labels */
.social-graph__node-label {
  font-size: var(--text-size-micro);
  fill: var(--color-text-secondary);
  font-family: var(--font-family-body);
  pointer-events: none;
}

.social-graph__node-label--self {
  font-size: var(--text-size-small);
  font-weight: var(--font-weight-semibold);
  fill: var(--color-text-primary);
}

/* Detail Panel */
.social-graph__detail {
  position: absolute;
  top: var(--space-large);
  right: var(--space-large);
  padding: var(--space-medium);
  background: var(--color-surface-elevated);
  border: var(--border-width-thin) solid var(--color-border-subtle);
  border-radius: var(--radius-large);
  box-shadow: var(--shadow-large);
  min-width: 200px;
  z-index: var(--z-raised);
}

.social-graph__detail-name {
  font-size: var(--text-size-large);
  font-weight: var(--font-weight-semibold);
  color: var(--color-text-primary);
  margin: 0 0 var(--space-small) 0;
}

.social-graph__detail-stats {
  display: grid;
  grid-template-columns: auto 1fr;
  gap: var(--space-tiny) var(--space-small);
  margin: 0;
  font-size: var(--text-size-small);
}

.social-graph__detail-stats dt {
  color: var(--color-text-tertiary);
}

.social-graph__detail-stats dd {
  margin: 0;
  color: var(--color-text-primary);
  font-weight: var(--font-weight-medium);
}

/* Legend */
.social-graph__legend {
  position: absolute;
  bottom: var(--space-large);
  left: var(--space-large);
  padding: var(--space-small) var(--space-medium);
  background: var(--color-surface-elevated);
  border: var(--border-width-thin) solid var(--color-border-subtle);
  border-radius: var(--radius-medium);
  box-shadow: var(--shadow-medium);
  z-index: var(--z-raised);
}

.social-graph__legend-title {
  font-size: var(--text-size-small);
  font-weight: var(--font-weight-semibold);
  color: var(--color-text-primary);
  margin: 0 0 var(--space-tiny) 0;
}

.social-graph__legend-item {
  display: flex;
  align-items: center;
  gap: var(--space-small);
  font-size: var(--text-size-small);
  color: var(--color-text-secondary);
  padding: var(--space-micro) 0;
}

.social-graph__legend-dot {
  width: 10px;
  height: 10px;
  border-radius: var(--radius-full);
  border: var(--border-width-medium) solid var(--color-surface-primary);
}

.social-graph__legend-dot--self {
  background: var(--color-sic-high);
}

.social-graph__legend-dot--friend {
  background: var(--color-primary);
}

.social-graph__legend-dot--discovered {
  background: var(--color-status-warning);
}

/* ═══════════════════════════════════════════════════════════════════
   GUTENBERG VIEW - Public Domain Book Browser
   ═══════════════════════════════════════════════════════════════════ */

.gutenberg-view {
  display: flex;
  flex-direction: column;
  height: 100%;
  overflow: hidden;
}

.gutenberg-view__search {
  padding: var(--space-sm) var(--space-md);
  border-bottom: 1px solid var(--color-border, var(--studio-border));
  flex-shrink: 0;
}

.gutenberg-view__search-row {
  display: flex;
  gap: var(--space-xs);
}

.gutenberg-view__search-input {
  flex: 1;
  padding: var(--space-xs) var(--space-sm);
  border: 1px solid var(--color-border, var(--studio-border));
  border-radius: var(--radius-sm, 4px);
  font-size: 0.875rem;
  background: var(--color-bg-secondary, var(--studio-bg-secondary));
  color: var(--color-text-primary, var(--studio-text-primary));
}

.gutenberg-view__search-input:focus {
  outline: none;
  border-color: var(--color-primary);
}

.gutenberg-view__search-btn {
  padding: var(--space-xs) var(--space-sm);
  background: var(--color-primary);
  color: var(--color-text-on-primary, white);
  border: none;
  border-radius: var(--radius-sm, 4px);
  font-size: 0.875rem;
  cursor: pointer;
  min-width: 60px;
  min-height: 44px;
  display: flex;
  align-items: center;
  justify-content: center;
}

.gutenberg-view__search-btn:hover:not(:disabled) {
  opacity: 0.9;
}

.gutenberg-view__search-btn:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

.gutenberg-view__error {
  padding: var(--space-sm) var(--space-md);
  background: var(--color-error-bg, rgba(220, 38, 38, 0.1));
  color: var(--color-error);
  font-size: 0.875rem;
}

.gutenberg-view__content {
  flex: 1;
  overflow-y: auto;
  min-height: 0;
}

.gutenberg-view__step {
  display: flex;
  flex-direction: column;
  height: 100%;
}

.gutenberg-view__step-header {
  padding: var(--space-sm) var(--space-md);
  border-bottom: 1px solid var(--color-border, var(--studio-border));
  background: var(--color-bg-secondary, var(--studio-bg-secondary));
  flex-shrink: 0;
}

.gutenberg-view__step-header--nav {
  display: flex;
  align-items: center;
  gap: var(--space-sm);
}

.gutenberg-view__back-btn {
  padding: var(--space-xs);
  background: none;
  border: none;
  font-size: 1.25rem;
  cursor: pointer;
  color: var(--color-text-secondary, var(--studio-text-secondary));
  line-height: 1;
  min-width: 44px;
  min-height: 44px;
  display: flex;
  align-items: center;
  justify-content: center;
}

.gutenberg-view__back-btn:hover {
  color: var(--color-text-primary, var(--studio-text-primary));
}

.gutenberg-view__step-info {
  display: flex;
  flex-direction: column;
  min-width: 0;
}

.gutenberg-view__step-title {
  font-weight: 600;
  font-size: 0.875rem;
  color: var(--color-text-primary, var(--studio-text-primary));
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.gutenberg-view__step-subtitle {
  font-size: 0.75rem;
  color: var(--color-text-secondary, var(--studio-text-secondary));
}

.gutenberg-view__list {
  flex: 1;
  overflow-y: auto;
}

.gutenberg-view__list-item {
  padding: var(--space-sm) var(--space-md);
  border-bottom: 1px solid var(--color-border-subtle, var(--studio-border-subtle));
  cursor: pointer;
  transition: background-color 0.15s ease;
}

.gutenberg-view__list-item:hover {
  background: var(--color-bg-hover, var(--studio-bg-hover));
}

.gutenberg-view__list-item--selected {
  background: var(--color-primary-subtle, rgba(139, 92, 246, 0.1));
}

.gutenberg-view__list-item-title {
  font-size: 0.875rem;
  font-weight: 500;
  color: var(--color-text-primary, var(--studio-text-primary));
  margin-bottom: var(--space-micro, 2px);
}

.gutenberg-view__list-item-meta {
  font-size: 0.75rem;
  color: var(--color-text-secondary, var(--studio-text-secondary));
}

.gutenberg-view__loading {
  padding: var(--space-lg);
  text-align: center;
  color: var(--color-text-secondary, var(--studio-text-secondary));
  font-size: 0.875rem;
}

.gutenberg-view__preview-text {
  flex: 1;
  padding: var(--space-md);
  overflow-y: auto;
  font-family: var(--font-prose, Georgia, serif);
  font-size: 0.9375rem;
  line-height: 1.7;
  color: var(--color-text-primary, var(--studio-text-primary));
  white-space: pre-wrap;
}

.gutenberg-view__action-footer {
  padding: var(--space-sm) var(--space-md);
  border-top: 1px solid var(--color-border, var(--studio-border));
  background: var(--color-bg-secondary, var(--studio-bg-secondary));
  flex-shrink: 0;
}

.gutenberg-view__use-btn {
  width: 100%;
  padding: var(--space-sm);
  background: var(--color-primary);
  color: var(--color-text-on-primary, white);
  border: none;
  border-radius: var(--radius-sm, 4px);
  font-size: 0.875rem;
  font-weight: 500;
  cursor: pointer;
  min-height: 44px;
}

.gutenberg-view__use-btn:hover {
  opacity: 0.9;
}

/* ═══════════════════════════════════════════════════════════════════
   FILES VIEW - Local Folder Browser
   ═══════════════════════════════════════════════════════════════════ */

.files-view {
  display: flex;
  flex-direction: column;
  height: 100%;
  overflow: hidden;
}

/* Empty State */
.files-view--empty {
  justify-content: center;
  align-items: center;
  padding: var(--space-xl);
}

.files-view__empty-state {
  display: flex;
  flex-direction: column;
  align-items: center;
  text-align: center;
  max-width: 300px;
}

.files-view__empty-icon {
  font-size: 3rem;
  margin-bottom: var(--space-md);
}

.files-view__empty-title {
  font-size: 1.125rem;
  font-weight: 600;
  color: var(--studio-text-primary, #1a1a1a);
  margin: 0 0 var(--space-sm);
}

.files-view__empty-text {
  font-size: 0.875rem;
  color: var(--studio-text-secondary, #666);
  margin: 0 0 var(--space-lg);
  line-height: 1.5;
}

.files-view__error {
  font-size: 0.875rem;
  color: var(--color-error, #dc2626);
  margin: 0 0 var(--space-md);
  padding: var(--space-sm);
  background: rgba(220, 38, 38, 0.1);
  border-radius: var(--radius-md);
}

.files-view__open-button {
  padding: var(--space-sm) var(--space-lg);
  font-size: 0.875rem;
  font-weight: 500;
  color: white;
  background: var(--color-primary, #4a7c59);
  border: none;
  border-radius: var(--radius-md);
  cursor: pointer;
  transition: background 0.15s ease;
}

.files-view__open-button:hover {
  background: var(--color-primary-hover, #3d6a4a);
}

.files-view__privacy-note {
  font-size: 0.75rem;
  color: var(--studio-text-tertiary, #999);
  margin-top: var(--space-md);
}

/* Indexing State */
.files-view--indexing {
  justify-content: center;
  align-items: center;
  padding: var(--space-xl);
}

.files-view__indexing-state {
  display: flex;
  flex-direction: column;
  align-items: center;
  text-align: center;
  max-width: 300px;
}

.files-view__indexing-icon {
  font-size: 2rem;
  margin-bottom: var(--space-md);
  animation: spin 1s linear infinite;
}

@keyframes spin {
  from { transform: rotate(0deg); }
  to { transform: rotate(360deg); }
}

.files-view__indexing-title {
  font-size: 1rem;
  font-weight: 500;
  color: var(--studio-text-primary, #1a1a1a);
  margin: 0 0 var(--space-md);
}

.files-view__progress-bar {
  width: 100%;
  height: 6px;
  background: var(--studio-border, #e5e2dc);
  border-radius: 3px;
  overflow: hidden;
  margin-bottom: var(--space-sm);
}

.files-view__progress-fill {
  height: 100%;
  background: var(--color-primary, #4a7c59);
  transition: width 0.3s ease;
}

.files-view__progress-text {
  font-size: 0.75rem;
  color: var(--studio-text-secondary, #666);
  margin: 0;
}

/* Browsing State */
.files-view--browsing {
  display: flex;
  flex-direction: column;
}

.files-view__header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: var(--space-sm);
  background: var(--studio-panel-bg, #f5f3ef);
  border-bottom: 1px solid var(--studio-border, #e5e2dc);
  gap: var(--space-sm);
}

.files-view__breadcrumb {
  display: flex;
  align-items: center;
  gap: var(--space-xs);
  min-width: 0;
}

.files-view__back-button {
  padding: var(--space-xs) var(--space-sm);
  font-size: 0.75rem;
  color: var(--studio-text-secondary, #666);
  background: transparent;
  border: 1px solid var(--studio-border, #e5e2dc);
  border-radius: var(--radius-sm);
  cursor: pointer;
  flex-shrink: 0;
}

.files-view__back-button:hover {
  background: var(--studio-hover, rgba(0,0,0,0.05));
}

.files-view__folder-name {
  font-size: 0.875rem;
  font-weight: 500;
  color: var(--studio-text-primary, #1a1a1a);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.files-view__actions {
  display: flex;
  gap: var(--space-xs);
  flex-shrink: 0;
}

.files-view__search {
  padding: var(--space-xs) var(--space-sm);
  font-size: 0.75rem;
  border: 1px solid var(--studio-border, #e5e2dc);
  border-radius: var(--radius-sm);
  width: 120px;
  background: var(--studio-surface, white);
}

.files-view__refresh-button {
  padding: var(--space-xs);
  font-size: 0.875rem;
  background: transparent;
  border: 1px solid var(--studio-border, #e5e2dc);
  border-radius: var(--radius-sm);
  cursor: pointer;
  line-height: 1;
}

.files-view__refresh-button:hover {
  background: var(--studio-hover, rgba(0,0,0,0.05));
}

/* Stats Bar */
.files-view__stats {
  display: flex;
  gap: var(--space-md);
  padding: var(--space-xs) var(--space-sm);
  font-size: 0.7rem;
  color: var(--studio-text-tertiary, #999);
  background: var(--studio-surface-alt, #faf9f7);
  border-bottom: 1px solid var(--studio-border, #e5e2dc);
}

/* Content Area */
.files-view__content {
  display: flex;
  flex: 1;
  min-height: 0;
  overflow: hidden;
}

/* File List */
.files-view__list {
  flex: 1;
  overflow-y: auto;
  padding: var(--space-xs);
  display: flex;
  flex-direction: column;
  gap: 2px;
  min-width: 0;
}

.files-view__item {
  display: flex;
  align-items: center;
  gap: var(--space-sm);
  padding: var(--space-xs) var(--space-sm);
  font-size: 0.8rem;
  text-align: left;
  background: transparent;
  border: none;
  border-radius: var(--radius-sm);
  cursor: pointer;
  width: 100%;
  transition: background 0.1s ease;
}

.files-view__item:hover {
  background: var(--studio-hover, rgba(0,0,0,0.05));
}

.files-view__item--selected {
  background: var(--color-primary-light, rgba(74, 124, 89, 0.1));
}

.files-view__item--folder .files-view__name {
  font-weight: 500;
}

.files-view__icon {
  flex-shrink: 0;
  font-size: 1rem;
  line-height: 1;
}

.files-view__name {
  flex: 1;
  min-width: 0;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  color: var(--studio-text-primary, #1a1a1a);
}

.files-view__meta {
  flex-shrink: 0;
  font-size: 0.7rem;
  color: var(--studio-text-tertiary, #999);
}

.files-view__empty-folder {
  padding: var(--space-lg);
  text-align: center;
  color: var(--studio-text-tertiary, #999);
  font-size: 0.875rem;
}

/* Preview Panel */
.files-view__preview {
  width: 200px;
  flex-shrink: 0;
  border-left: 1px solid var(--studio-border, #e5e2dc);
  background: var(--studio-surface-alt, #faf9f7);
  overflow-y: auto;
  padding: var(--space-sm);
}

.files-view__preview-header {
  display: flex;
  align-items: flex-start;
  gap: var(--space-sm);
  margin-bottom: var(--space-md);
}

.files-view__preview-title {
  font-size: 0.875rem;
  font-weight: 500;
  color: var(--studio-text-primary, #1a1a1a);
  margin: 0;
  word-break: break-word;
}

.files-view__preview-meta {
  font-size: 0.75rem;
  margin: 0 0 var(--space-md);
}

.files-view__preview-meta dt {
  color: var(--studio-text-tertiary, #999);
  margin-bottom: 2px;
}

.files-view__preview-meta dd {
  color: var(--studio-text-secondary, #666);
  margin: 0 0 var(--space-sm);
}

.files-view__preview-content h4 {
  font-size: 0.75rem;
  font-weight: 500;
  color: var(--studio-text-secondary, #666);
  margin: 0 0 var(--space-xs);
}

.files-view__preview-text {
  font-size: 0.7rem;
  line-height: 1.5;
  color: var(--studio-text-secondary, #666);
  background: var(--studio-surface, white);
  padding: var(--space-sm);
  border-radius: var(--radius-sm);
  max-height: 200px;
  overflow-y: auto;
  white-space: pre-wrap;
  word-break: break-word;
  margin: 0;
}

.files-view__preview-note {
  font-size: 0.75rem;
  color: var(--studio-text-tertiary, #999);
  font-style: italic;
}

.files-view__no-selection {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  height: 100%;
  text-align: center;
  color: var(--studio-text-tertiary, #999);
}

.files-view__no-selection-icon {
  font-size: 1.5rem;
  margin-bottom: var(--space-sm);
}

/* Error Banner */
.files-view__error-banner {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: var(--space-sm) var(--space-md);
  margin: 0 var(--space-xs) var(--space-xs);
  background: rgba(var(--color-error-rgb, 220, 38, 38), 0.1);
  border: 1px solid var(--color-error, #dc2626);
  border-radius: var(--radius-sm);
  font-size: 0.8rem;
  color: var(--color-error, #dc2626);
}

.files-view__error-banner button {
  background: transparent;
  border: none;
  font-size: 1rem;
  cursor: pointer;
  color: inherit;
  padding: 0 var(--space-xs);
}

/* File with extractable content indicator */
.files-view__item--has-content {
  position: relative;
}

.files-view__item--has-content::after {
  content: '';
  position: absolute;
  right: var(--space-sm);
  top: 50%;
  transform: translateY(-50%);
  width: 6px;
  height: 6px;
  border-radius: 50%;
  background: var(--color-success, #16a34a);
  opacity: 0.6;
}

/* Hover Tooltip */
.files-view__tooltip {
  position: fixed;
  z-index: 200;
  bottom: 60px;
  left: 50%;
  transform: translateX(-50%);
  width: min(400px, 90vw);
  padding: var(--space-sm);
  background: var(--bg-elevated, #fff);
  border: 1px solid var(--studio-border, #e5e2dc);
  border-radius: var(--radius-md);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
  font-size: 0.8rem;
}

.files-view__tooltip-header {
  display: flex;
  align-items: center;
  gap: var(--space-sm);
  margin-bottom: var(--space-xs);
}

.files-view__tooltip-header strong {
  word-break: break-word;
  color: var(--studio-text-primary, #1a1a1a);
}

.files-view__tooltip-meta {
  display: flex;
  flex-wrap: wrap;
  gap: var(--space-sm);
  color: var(--studio-text-tertiary, #999);
  font-size: 0.75rem;
  margin-bottom: var(--space-xs);
}

.files-view__tooltip-preview {
  font-family: var(--font-mono, monospace);
  font-size: 0.7rem;
  line-height: 1.4;
  color: var(--studio-text-secondary, #666);
  background: var(--bg-tertiary, #f5f5f0);
  padding: var(--space-sm);
  border-radius: var(--radius-sm);
  margin: var(--space-xs) 0;
  max-height: 100px;
  overflow: hidden;
  white-space: pre-wrap;
  word-break: break-word;
}

.files-view__tooltip-hint {
  font-size: 0.7rem;
  color: var(--color-primary, #4a7c59);
  margin: var(--space-xs) 0 0;
  text-align: center;
}

/* Hide old preview panel (now using tooltip) */
.files-view__preview {
  display: none;
}

/* ═══════════════════════════════════════════════════════════════════
   SYMMETRIC MENUBAR - Floating bottom navigation
   ═══════════════════════════════════════════════════════════════════ */

/* ═══════════════════════════════════════════════════════════════════
   CORNER ASSISTANT - Book-Margin Help Button
   Subtle, book-safe, non-intrusive
   ═══════════════════════════════════════════════════════════════════ */

.corner-assistant {
  position: fixed;
  bottom: var(--space-xl, 2rem);
  right: var(--space-xl, 2rem);
  width: 36px;
  height: 36px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: var(--studio-surface, #faf8f5);
  border: 1px solid var(--studio-border, #e5e2dc);
  border-radius: var(--radius-full, 9999px);
  color: var(--studio-text-tertiary, #999);
  cursor: pointer;
  transition: all 0.2s ease, right 0.3s ease; /* Smooth slide when panel opens */
  z-index: 100;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
  font-size: 1rem;
  font-weight: 500;
}

.corner-assistant:hover {
  background: var(--studio-hover, #f0ede8);
  color: var(--studio-text-secondary, #666);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
  transform: scale(1.05);
}

.corner-assistant--open {
  background: var(--studio-accent, #6366f1);
  color: white;
  border-color: var(--studio-accent, #6366f1);
}

.corner-assistant--open:hover {
  background: var(--studio-accent-hover, #5558e3);
  color: white;
}

.corner-assistant:focus {
  outline: none;
}

.corner-assistant:focus-visible {
  outline: 2px solid var(--studio-accent, #6366f1);
  outline-offset: 2px;
}

.corner-assistant__icon {
  line-height: 1;
}

/* Backdrop for closing menu */
.corner-assistant__backdrop {
  position: fixed;
  inset: 0;
  z-index: 99;
}

/* Popover menu */
.corner-assistant__menu {
  position: fixed;
  bottom: calc(var(--space-xl, 2rem) + 44px);
  right: var(--space-xl, 2rem);
  min-width: 160px;
  padding: var(--space-xs, 0.25rem);
  background: var(--studio-surface, #faf8f5);
  border: 1px solid var(--studio-border, #e5e2dc);
  border-radius: var(--radius-lg, 0.75rem);
  box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12);
  z-index: 101;
  animation: corner-menu-in 0.15s ease;
  transition: right 0.3s ease; /* Smooth slide with button */
}

@keyframes corner-menu-in {
  from {
    opacity: 0;
    transform: translateY(8px) scale(0.95);
  }
  to {
    opacity: 1;
    transform: translateY(0) scale(1);
  }
}

.corner-assistant__item {
  display: flex;
  align-items: center;
  gap: var(--space-sm, 0.5rem);
  width: 100%;
  padding: var(--space-sm, 0.5rem) var(--space-md, 1rem);
  font-size: 0.875rem;
  color: var(--studio-text, #2c2825);
  background: transparent;
  border: none;
  border-radius: var(--radius-md, 0.5rem);
  cursor: pointer;
  text-align: left;
  transition: background 0.1s ease;
}

.corner-assistant__item:hover {
  background: var(--studio-hover, #f0ede8);
}

.corner-assistant__item.active {
  color: var(--studio-accent, #6366f1);
  font-weight: 500;
}

.corner-assistant__item-icon {
  font-size: 0.75rem;
  opacity: 0.6;
}

.corner-assistant__divider {
  height: 1px;
  margin: var(--space-xs, 0.25rem) var(--space-sm, 0.5rem);
  background: var(--studio-border, #e5e2dc);
}

.corner-assistant__shortcuts {
  padding: var(--space-xs, 0.25rem) var(--space-md, 1rem);
  display: flex;
  flex-direction: column;
  gap: 2px;
}

.corner-assistant__shortcut {
  display: flex;
  align-items: center;
  gap: var(--space-xs, 0.25rem);
  font-size: 0.6875rem;
  color: var(--studio-text-tertiary, #999);
}

.corner-assistant__shortcut kbd {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  min-width: 18px;
  height: 18px;
  padding: 0 4px;
  font-family: inherit;
  font-size: 0.625rem;
  background: var(--studio-bg, #f5f2ed);
  border: 1px solid var(--studio-border, #e5e2dc);
  border-radius: 3px;
}

/* Mobile adjustments */
@media (max-width: 767px) {
  .corner-assistant {
    bottom: var(--space-lg, 1.5rem);
    right: var(--space-lg, 1.5rem);
    width: 40px;
    height: 40px;
  }

  .corner-assistant__menu {
    bottom: calc(var(--space-lg, 1.5rem) + 48px);
    right: var(--space-lg, 1.5rem);
  }
}

/* Dark mode */
[data-theme="dark"] .corner-assistant {
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
}

[data-theme="dark"] .corner-assistant__menu {
  box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
}

/* ═══════════════════════════════════════════════════════════════════
   AUI FLOATING CHAT PANEL
   ═══════════════════════════════════════════════════════════════════ */

.corner-assistant__chat {
  position: fixed;
  bottom: calc(var(--space-xl, 2rem) + 50px);
  right: var(--space-xl, 2rem);
  width: 380px;
  max-width: calc(100vw - var(--space-xl, 2rem) * 2);
  max-height: min(500px, calc(100vh - 120px));
  background: var(--studio-surface, #fafaf9);
  border: 1px solid var(--studio-border, #e5e2dc);
  border-radius: var(--radius-lg, 0.75rem);
  box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12);
  display: flex;
  flex-direction: column;
  z-index: 200;
  transition: right 0.3s ease;
}

/* Header */
.corner-assistant__chat-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: var(--space-sm, 0.5rem) var(--space-md, 1rem);
  border-bottom: 1px solid var(--studio-border, #e5e2dc);
  flex-shrink: 0;
}

.corner-assistant__chat-title {
  display: flex;
  align-items: center;
  gap: var(--space-xs, 0.25rem);
  font-weight: 500;
  color: var(--studio-text, #1a1a1a);
}

.corner-assistant__chat-icon {
  color: var(--studio-accent, #7c3aed);
}

.corner-assistant__chat-status {
  color: var(--studio-accent, #7c3aed);
  animation: pulse 1s ease-in-out infinite;
  font-size: 0.75rem;
  margin-left: var(--space-xs);
}

.corner-assistant__chat-actions {
  display: flex;
  align-items: center;
  gap: var(--space-xs, 0.25rem);
}

.corner-assistant__chat-action,
.corner-assistant__chat-close {
  width: 28px;
  height: 28px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: transparent;
  border: none;
  border-radius: var(--radius-sm, 0.25rem);
  color: var(--studio-text-secondary, #666);
  cursor: pointer;
  font-size: 1rem;
  transition: background 0.15s ease, color 0.15s ease;
}

.corner-assistant__chat-action:hover,
.corner-assistant__chat-close:hover {
  background: var(--studio-hover, rgba(0, 0, 0, 0.04));
  color: var(--studio-text, #1a1a1a);
}

.corner-assistant__chat-close {
  font-size: 1.25rem;
}

/* Messages */
.corner-assistant__chat-messages {
  flex: 1;
  padding: var(--space-sm, 0.5rem);
  overflow-y: auto;
  display: flex;
  flex-direction: column;
  gap: var(--space-xs, 0.25rem);
}

.corner-assistant__chat-welcome {
  text-align: center;
  padding: var(--space-lg, 1.5rem) var(--space-md, 1rem);
  color: var(--studio-text-secondary, #666);
  font-size: var(--text-sm, 0.875rem);
}

.corner-assistant__chat-welcome p {
  margin: 0 0 var(--space-sm, 0.5rem);
}

.corner-assistant__chat-hint {
  font-style: italic;
  opacity: 0.7;
}

.corner-assistant__chat-msg {
  padding: var(--space-xs, 0.25rem) var(--space-sm, 0.5rem);
  border-radius: var(--radius-sm, 0.25rem);
  font-size: var(--text-sm, 0.875rem);
  line-height: 1.4;
}

.corner-assistant__chat-msg--user {
  background: var(--studio-accent, #7c3aed);
  color: white;
  align-self: flex-end;
  max-width: 85%;
  border-radius: var(--radius-md, 0.5rem) var(--radius-md, 0.5rem) var(--radius-xs, 0.125rem) var(--radius-md, 0.5rem);
}

.corner-assistant__chat-msg--assistant {
  background: var(--studio-bg-secondary, #f5f5f4);
  color: var(--studio-text, #1a1a1a);
  align-self: flex-start;
  max-width: 90%;
}

.corner-assistant__chat-msg--assistant p {
  margin: 0;
}

.corner-assistant__chat-msg--system {
  font-style: italic;
  color: var(--studio-text-secondary, #666);
  text-align: center;
  font-size: var(--text-xs, 0.75rem);
}

.corner-assistant__chat-msg--loading {
  align-self: flex-start;
  padding: var(--space-sm);
}

/* Loading animation */
.corner-assistant__loading-dots {
  display: flex;
  gap: 4px;
}

.corner-assistant__loading-dots span {
  animation: bounce 1.4s infinite ease-in-out;
  color: var(--studio-text-secondary, #666);
  font-size: 0.5rem;
}

.corner-assistant__loading-dots span:nth-child(1) { animation-delay: 0s; }
.corner-assistant__loading-dots span:nth-child(2) { animation-delay: 0.2s; }
.corner-assistant__loading-dots span:nth-child(3) { animation-delay: 0.4s; }

@keyframes bounce {
  0%, 80%, 100% { transform: translateY(0); }
  40% { transform: translateY(-4px); }
}

/* Tool results */
.corner-assistant__tool-results {
  display: flex;
  flex-direction: column;
  gap: var(--space-xs, 0.25rem);
}

.corner-assistant__tool-result {
  display: flex;
  align-items: flex-start;
  gap: var(--space-xs, 0.25rem);
  padding: var(--space-xs, 0.25rem);
  border-radius: var(--radius-sm, 0.25rem);
  background: var(--studio-bg-secondary, #f5f5f4);
  font-size: var(--text-sm, 0.875rem);
}

.corner-assistant__tool-result.success .corner-assistant__tool-status {
  color: var(--color-success, #22c55e);
}

.corner-assistant__tool-result.error .corner-assistant__tool-status {
  color: var(--color-error, #ef4444);
}

.corner-assistant__tool-status {
  flex-shrink: 0;
  font-weight: 600;
}

.corner-assistant__tool-message {
  flex: 1;
}

/* Collapsible teaching */
.corner-assistant__teaching {
  margin-top: var(--space-xs, 0.25rem);
  font-size: var(--text-xs, 0.75rem);
  color: var(--studio-text-secondary, #666);
}

.corner-assistant__teaching summary {
  cursor: pointer;
  color: var(--studio-accent, #7c3aed);
  font-weight: 500;
}

.corner-assistant__teaching summary:hover {
  text-decoration: underline;
}

.corner-assistant__teaching ol {
  margin: var(--space-xs) 0 0 var(--space-md);
  padding: 0;
}

.corner-assistant__teaching li {
  margin-bottom: 2px;
}

.corner-assistant__teaching-shortcut {
  margin-top: var(--space-xs);
  font-family: monospace;
}

/* Input area */
.corner-assistant__chat-input {
  display: flex;
  align-items: flex-end;
  gap: var(--space-xs, 0.25rem);
  padding: var(--space-sm, 0.5rem);
  border-top: 1px solid var(--studio-border, #e5e2dc);
  flex-shrink: 0;
}

.corner-assistant__chat-input textarea {
  flex: 1;
  padding: var(--space-xs, 0.25rem) var(--space-sm, 0.5rem);
  border: 1px solid var(--studio-border, #e5e2dc);
  border-radius: var(--radius-sm, 0.25rem);
  font-size: var(--text-sm, 0.875rem);
  font-family: inherit;
  resize: none;
  min-height: 40px;
  max-height: 120px;
  background: var(--studio-bg, white);
  color: var(--studio-text, #1a1a1a);
}

.corner-assistant__chat-input textarea:focus {
  outline: none;
  border-color: var(--studio-accent, #7c3aed);
  box-shadow: 0 0 0 2px rgba(124, 58, 237, 0.1);
}

.corner-assistant__chat-input textarea::placeholder {
  color: var(--studio-text-secondary, #666);
}

.corner-assistant__chat-send {
  width: 36px;
  height: 36px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: var(--studio-accent, #7c3aed);
  color: white;
  border: none;
  border-radius: var(--radius-sm, 0.25rem);
  cursor: pointer;
  font-size: 1rem;
  font-weight: 600;
  transition: opacity 0.15s ease, transform 0.15s ease;
}

.corner-assistant__chat-send:hover:not(:disabled) {
  transform: translateY(-1px);
}

.corner-assistant__chat-send:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

/* Archive notice */
.corner-assistant__chat-notice {
  padding: var(--space-xs, 0.25rem) var(--space-sm, 0.5rem);
  text-align: center;
  font-size: var(--text-xs, 0.75rem);
  color: var(--studio-text-secondary, #666);
  background: var(--studio-bg-secondary, #f5f5f4);
  border-radius: 0 0 var(--radius-lg, 0.75rem) var(--radius-lg, 0.75rem);
}

/* Dark mode */
[data-theme="dark"] .corner-assistant__chat {
  background: var(--studio-surface-dark, #1a1a1a);
  border-color: var(--studio-border-dark, #333);
  box-shadow: 0 8px 24px rgba(0, 0, 0, 0.4);
}

[data-theme="dark"] .corner-assistant__chat-header {
  border-color: var(--studio-border-dark, #333);
}

[data-theme="dark"] .corner-assistant__chat-title {
  color: var(--studio-text-light, #f5f5f5);
}

[data-theme="dark"] .corner-assistant__chat-msg--assistant {
  background: rgba(255, 255, 255, 0.05);
  color: var(--studio-text-light, #f5f5f5);
}

[data-theme="dark"] .corner-assistant__tool-result {
  background: rgba(255, 255, 255, 0.05);
}

[data-theme="dark"] .corner-assistant__chat-input {
  border-color: var(--studio-border-dark, #333);
}

[data-theme="dark"] .corner-assistant__chat-input textarea {
  background: rgba(255, 255, 255, 0.05);
  border-color: var(--studio-border-dark, #333);
  color: var(--studio-text-light, #f5f5f5);
}

[data-theme="dark"] .corner-assistant__chat-notice {
  background: rgba(255, 255, 255, 0.03);
}

/* ═══════════════════════════════════════════════════════════════════
   SYMMETRIC MENUBAR - Floating bottom menubar (DEPRECATED - use CornerAssistant)
   ═══════════════════════════════════════════════════════════════════ */

.symmetric-menubar {
  position: fixed;
  bottom: var(--space-md);
  left: 50%;
  transform: translateX(-50%);
  display: flex;
  align-items: center;
  gap: var(--space-sm);
  padding: var(--space-xs) var(--space-sm);
  background: var(--studio-surface, white);
  border: 1px solid var(--studio-border, #e5e2dc);
  border-radius: var(--radius-xl, 1rem);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1), 0 0 0 1px rgba(0, 0, 0, 0.05);
  z-index: 100;
  min-width: 280px;
  max-width: calc(100vw - var(--space-xl));
}

.symmetric-menubar__button {
  display: flex;
  align-items: center;
  gap: var(--space-xs);
  padding: var(--space-sm) var(--space-md);
  font-size: 0.8rem;
  font-weight: 500;
  color: var(--studio-text-secondary, #666);
  background: transparent;
  border: none;
  border-radius: var(--radius-md);
  cursor: pointer;
  transition: all 0.15s ease;
  white-space: nowrap;
}

.symmetric-menubar__button:hover {
  background: var(--studio-hover, rgba(0, 0, 0, 0.05));
  color: var(--studio-text-primary, #1a1a1a);
}

.symmetric-menubar__button:focus {
  outline: none;
}

.symmetric-menubar__button:focus-visible {
  outline: 2px solid var(--color-primary, #4a7c59);
  outline-offset: 2px;
}

.symmetric-menubar__button--active {
  color: var(--color-primary, #4a7c59);
  background: var(--color-primary-light, rgba(74, 124, 89, 0.1));
}

.symmetric-menubar__button--left {
  border-right: 1px solid var(--studio-border, #e5e2dc);
  padding-right: var(--space-md);
  margin-right: var(--space-xs);
}

.symmetric-menubar__button--right {
  border-left: 1px solid var(--studio-border, #e5e2dc);
  padding-left: var(--space-md);
  margin-left: var(--space-xs);
}

.symmetric-menubar__icon {
  font-size: 0.75rem;
  line-height: 1;
}

.symmetric-menubar__label {
  font-size: 0.8rem;
}

.symmetric-menubar__center {
  flex: 1;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  min-width: 0;
  padding: 0 var(--space-sm);
}

.symmetric-menubar__title {
  font-size: 0.875rem;
  font-weight: 500;
  color: var(--studio-text-primary, #1a1a1a);
  margin: 0;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  max-width: 200px;
}

.symmetric-menubar__subtitle {
  font-size: 0.7rem;
  color: var(--studio-text-tertiary, #999);
}

/* Updated center layout for title group + split button */
.symmetric-menubar__center {
  flex: 1;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: var(--space-sm);
  min-width: 0;
  padding: 0 var(--space-sm);
}

.symmetric-menubar__title-group {
  display: flex;
  flex-direction: column;
  align-items: center;
  min-width: 0;
}

/* Split-screen toggle button */
.symmetric-menubar__split-btn {
  display: flex;
  align-items: center;
  justify-content: center;
  min-width: var(--touch-target-min, 44px);
  min-height: var(--touch-target-min, 44px);
  background: var(--bg-tertiary, #f0f0f0);
  border: 1px solid var(--studio-border, #e5e2dc);
  border-radius: var(--radius-md);
  cursor: pointer;
  transition: background 0.15s ease, border-color 0.15s ease, transform 0.1s ease;
}

.symmetric-menubar__split-btn:hover {
  background: var(--bg-secondary, #f5f5f0);
  border-color: var(--color-primary, #4a7c59);
}

.symmetric-menubar__split-btn:active {
  transform: scale(0.95);
}

.symmetric-menubar__split-btn:focus {
  outline: none;
}

.symmetric-menubar__split-btn:focus-visible {
  outline: 2px solid var(--color-primary, #4a7c59);
  outline-offset: 2px;
}

.symmetric-menubar__split-btn--active {
  background: var(--color-primary, #4a7c59);
  border-color: var(--color-primary, #4a7c59);
  color: white;
}

.symmetric-menubar__split-btn--active:hover {
  background: var(--color-primary-hover, #3d6a4a);
}

.symmetric-menubar__split-icon {
  font-size: 1rem;
  line-height: 1;
}

.symmetric-menubar__mode-badge {
  position: absolute;
  top: -0.5rem;
  right: -0.5rem;
  font-size: 0.625rem;
  padding: 2px 6px;
  background: var(--color-info, #3b82f6);
  color: white;
  border-radius: var(--radius-full);
  text-transform: uppercase;
  letter-spacing: 0.05em;
}

/* Mobile adjustments */
@media (max-width: 767px) {
  .symmetric-menubar {
    bottom: var(--space-sm);
    min-width: unset;
    width: calc(100vw - var(--space-lg));
    max-width: 400px;
    padding: var(--space-xs);
  }

  .symmetric-menubar__label {
    display: none;
  }

  .symmetric-menubar__button {
    padding: var(--space-sm);
  }

  .symmetric-menubar__icon {
    font-size: 1rem;
  }

  .symmetric-menubar__title {
    max-width: 120px;
  }
}

/* ═══════════════════════════════════════════════════════════════════
   BOTTOM SHEET HANDLE - Mobile panel header
   ═══════════════════════════════════════════════════════════════════ */

.bottom-sheet-handle {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: var(--space-xs);
  padding: var(--space-sm) var(--space-lg);
  background: transparent;
  border: none;
  cursor: pointer;
  width: 100%;
}

.bottom-sheet-handle__bar {
  width: 40px;
  height: 4px;
  background: var(--studio-border, #e5e2dc);
  border-radius: 2px;
  transition: background 0.15s ease;
}

.bottom-sheet-handle:hover .bottom-sheet-handle__bar {
  background: var(--studio-text-tertiary, #999);
}

.bottom-sheet-handle__label {
  font-size: 0.75rem;
  font-weight: 500;
  color: var(--studio-text-secondary, #666);
  text-transform: uppercase;
  letter-spacing: 0.05em;
}

.bottom-sheet-handle--open .bottom-sheet-handle__bar {
  background: var(--color-primary, #4a7c59);
}

/* ═══════════════════════════════════════════════════════════════════
   PANEL RESIZER - Draggable resize handle between panels
   ═══════════════════════════════════════════════════════════════════ */

.panel-resizer {
  position: absolute;
  top: 0;
  bottom: 0;
  width: 8px;
  z-index: 100;
  cursor: col-resize;
  display: flex;
  align-items: center;
  justify-content: center;
  user-select: none;
  touch-action: none;
}

.panel-resizer--left {
  right: -4px;
}

.panel-resizer--right {
  left: -4px;
}

.panel-resizer__handle {
  width: 4px;
  height: 40px;
  background: var(--studio-border, #e5e2dc);
  border-radius: 2px;
  opacity: 0;
  transition: opacity 0.15s ease, background 0.15s ease, height 0.15s ease;
}

.panel-resizer:hover .panel-resizer__handle {
  opacity: 1;
  height: 60px;
}

.panel-resizer:active .panel-resizer__handle,
.panel-resizer--dragging .panel-resizer__handle {
  opacity: 1;
  height: 80px;
  background: var(--color-primary, #4a7c59);
}

/* Focus state for keyboard accessibility */
.panel-resizer:focus {
  outline: none;
}

.panel-resizer:focus-visible .panel-resizer__handle {
  opacity: 1;
  background: var(--color-primary, #4a7c59);
}

/* Hide on mobile - panels are full-width bottom sheets */
@media (max-width: 767px) {
  .panel-resizer {
    display: none;
  }
}

/* ═══════════════════════════════════════════════════════════════════
   MOBILE BOTTOM SHEET - Panel as full-width bottom drawer
   ═══════════════════════════════════════════════════════════════════ */

.studio-panel--bottom-sheet {
  position: fixed;
  left: 0;
  right: 0;
  bottom: 0;
  top: auto;
  width: 100%;
  max-height: calc(100vh - 60px);
  border-radius: var(--radius-xl) var(--radius-xl) 0 0;
  box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.15);
  transform: translateY(calc(100% - 60px));
  transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  z-index: 200;
  background: var(--bg-primary, #fff);
}

.studio-panel--bottom-sheet.studio-panel--open {
  transform: translateY(0);
}

/* Bottom sheet handle */
.studio-panel__sheet-handle {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: var(--space-xs);
  padding: var(--space-sm) var(--space-lg);
  background: transparent;
  border: none;
  cursor: pointer;
  width: 100%;
  min-height: var(--touch-target-min, 44px);
}

.studio-panel__sheet-bar {
  width: 40px;
  height: 4px;
  background: var(--studio-border, #e5e2dc);
  border-radius: 2px;
  transition: background 0.15s ease;
}

.studio-panel__sheet-handle:hover .studio-panel__sheet-bar {
  background: var(--studio-text-tertiary, #999);
}

.studio-panel--open .studio-panel__sheet-bar {
  background: var(--color-primary, #4a7c59);
}

.studio-panel__sheet-label {
  font-size: 0.75rem;
  font-weight: 500;
  color: var(--studio-text-secondary, #666);
  text-transform: uppercase;
  letter-spacing: 0.05em;
}

/* Mobile backdrop */
.studio-panel__backdrop--mobile {
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  z-index: 199;
  animation: fadeIn 0.2s ease;
}

@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

/* Ensure bottom sheet content is scrollable */
.studio-panel--bottom-sheet .studio-panel__content {
  max-height: calc(100vh - 120px);
  overflow-y: auto;
  -webkit-overflow-scrolling: touch;
}

/* Hide hover triggers on mobile */
@media (max-width: 767px) {
  .studio-panel__trigger {
    display: none;
  }

  .studio-panel:not(.studio-panel--bottom-sheet) {
    display: none;
  }
}

/* ═══════════════════════════════════════════════════════════════════
   SPLIT SCREEN WORKSPACE - Two-pane side-by-side layout
   ═══════════════════════════════════════════════════════════════════ */

/* Desktop split workspace */
.split-workspace--desktop {
  display: flex;
  width: 100%;
  height: 100%;
  min-height: 0;
  overflow: hidden;
}

.split-workspace__pane {
  display: flex;
  flex-direction: column;
  min-width: 0;
  min-height: 0;
  overflow: hidden;
  background: var(--bg-primary, #fff);
}

.split-workspace__pane--left {
  border-right: 1px solid var(--studio-border, #e5e2dc);
}

.split-workspace__pane--right {
  flex: 1;
}

.split-workspace__pane-content {
  flex: 1;
  overflow: auto;
  min-height: 0;
  /* Center content within pane */
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: var(--space-lg) var(--space-md);
}

/* Content container inside pane - max width for readability */
.split-workspace__pane-content > * {
  width: 100%;
  max-width: min(50rem, 95%); /* ~800px */
  text-align: left;
}

/* Split pane header */
.split-workspace__header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: var(--space-sm) var(--space-md);
  border-bottom: 1px solid var(--studio-border, #e5e2dc);
  background: var(--bg-secondary, #f5f5f0);
  flex-shrink: 0;
}

.split-workspace__header-text {
  display: flex;
  align-items: baseline;
  gap: var(--space-sm);
  min-width: 0;
  overflow: hidden;
}

.split-workspace__title {
  margin: 0;
  font-size: 0.875rem;
  font-weight: 600;
  color: var(--studio-text-primary, #1a1a1a);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.split-workspace__subtitle {
  font-size: 0.75rem;
  color: var(--studio-text-tertiary, #999);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.split-workspace__header-actions {
  display: flex;
  align-items: center;
  gap: var(--space-sm);
  flex-shrink: 0;
}

.split-workspace__badge {
  padding: 2px 6px;
  font-size: 0.625rem;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.05em;
  background: var(--color-info, #60a5fa);
  color: #fff;
  border-radius: var(--radius-sm);
}

.split-workspace__close {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 24px;
  height: 24px;
  background: transparent;
  border: none;
  cursor: pointer;
  font-size: 1rem;
  color: var(--studio-text-tertiary, #999);
  border-radius: var(--radius-sm);
  transition: background 0.15s ease, color 0.15s ease;
}

.split-workspace__close:hover {
  background: var(--bg-tertiary, #eee);
  color: var(--studio-text-primary, #1a1a1a);
}

/* ═══════════════════════════════════════════════════════════════════
   SPLIT DIVIDER - Draggable divider between panes
   ═══════════════════════════════════════════════════════════════════ */

.split-divider {
  position: relative;
  width: 8px;
  flex-shrink: 0;
  cursor: col-resize;
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 10;
  user-select: none;
  touch-action: none;
  background: transparent;
}

.split-divider__handle {
  width: 4px;
  height: 100%;
  display: flex;
  align-items: center;
  justify-content: center;
  background: transparent;
  transition: background 0.15s ease;
}

.split-divider__grip {
  width: 4px;
  height: 48px;
  background: var(--studio-border, #e5e2dc);
  border-radius: 2px;
  opacity: 0;
  transition: opacity 0.15s ease, background 0.15s ease, height 0.15s ease;
}

.split-divider:hover .split-divider__grip {
  opacity: 1;
  height: 64px;
}

.split-divider:active .split-divider__grip,
.split-divider--dragging .split-divider__grip {
  opacity: 1;
  height: 80px;
  background: var(--color-primary, #4a7c59);
}

.split-divider:focus {
  outline: none;
}

.split-divider:focus-visible .split-divider__grip {
  opacity: 1;
  background: var(--color-primary, #4a7c59);
}

/* ═══════════════════════════════════════════════════════════════════
   MOBILE SPLIT WORKSPACE - Tab-based pane switching
   ═══════════════════════════════════════════════════════════════════ */

.split-workspace--mobile {
  display: flex;
  flex-direction: column;
  width: 100%;
  height: 100%;
  position: relative;
}

.split-workspace__tabs {
  display: flex;
  flex-shrink: 0;
  background: var(--bg-secondary, #f5f5f0);
  border-bottom: 1px solid var(--studio-border, #e5e2dc);
}

.split-workspace__tab {
  flex: 1;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: var(--space-xs);
  padding: var(--space-sm) var(--space-md);
  background: transparent;
  border: none;
  cursor: pointer;
  min-height: var(--touch-target-min, 44px);
  transition: background 0.15s ease;
}

.split-workspace__tab:hover {
  background: var(--bg-tertiary, #eee);
}

.split-workspace__tab:focus {
  outline: none;
}

.split-workspace__tab:focus-visible {
  outline: 2px solid var(--color-primary, #4a7c59);
  outline-offset: -2px;
}

.split-workspace__tab--active {
  background: var(--bg-primary, #fff);
  border-bottom: 2px solid var(--color-primary, #4a7c59);
  margin-bottom: -1px;
}

.split-workspace__tab-title {
  font-size: 0.875rem;
  font-weight: 500;
  color: var(--studio-text-secondary, #666);
}

.split-workspace__tab--active .split-workspace__tab-title {
  color: var(--studio-text-primary, #1a1a1a);
}

.split-workspace__tab-badge {
  padding: 2px 6px;
  font-size: 0.625rem;
  font-weight: 600;
  text-transform: uppercase;
  background: var(--color-info, #60a5fa);
  color: #fff;
  border-radius: var(--radius-sm);
}

.split-workspace__mobile-content {
  flex: 1;
  overflow: auto;
  min-height: 0;
}

.split-workspace__exit-mobile {
  position: absolute;
  top: var(--space-xs);
  right: var(--space-xs);
  min-width: var(--touch-target-min, 44px);
  min-height: var(--touch-target-min, 44px);
  display: flex;
  align-items: center;
  justify-content: center;
  background: var(--bg-tertiary, #eee);
  border: none;
  cursor: pointer;
  font-size: 1.25rem;
  color: var(--studio-text-tertiary, #999);
  border-radius: var(--radius-full);
  transition: background 0.15s ease, color 0.15s ease;
  z-index: 10;
}

.split-workspace__exit-mobile:hover {
  background: var(--bg-secondary, #f5f5f0);
  color: var(--studio-text-primary, #1a1a1a);
}

/* Split pane inner content */
.split-pane {
  height: 100%;
  overflow: auto;
}

.split-pane[data-readonly] {
  background: var(--bg-secondary, #f5f5f0);
}

.split-pane__content {
  padding: var(--space-md) var(--space-lg);
  max-width: 65ch;
  margin: 0 auto;
  line-height: 1.7;
  color: var(--studio-text-primary, #1a1a1a);
}

.split-pane__content h1,
.split-pane__content h2,
.split-pane__content h3 {
  margin-top: var(--space-lg);
  margin-bottom: var(--space-sm);
}

.split-pane__content p {
  margin-bottom: var(--space-md);
}

.split-pane__content code {
  background: var(--bg-tertiary, #eee);
  padding: 2px 6px;
  border-radius: var(--radius-sm);
  font-size: 0.9em;
}

.split-pane__content pre {
  background: var(--bg-tertiary, #eee);
  padding: var(--space-md);
  border-radius: var(--radius-md);
  overflow-x: auto;
  margin: var(--space-md) 0;
}

.split-pane__content blockquote {
  border-left: 3px solid var(--color-primary, #4a7c59);
  padding-left: var(--space-md);
  margin: var(--space-md) 0;
  color: var(--studio-text-secondary, #666);
  font-style: italic;
}

/* Hide split divider on mobile */
@media (max-width: 767px) {
  .split-divider {
    display: none;
  }

  .split-workspace--desktop {
    display: none;
  }
}

/* ═══════════════════════════════════════════════════════════════════
   HIGHLIGHT LAYERS - AI Detection, GPTZero, Tell-phrases, Diff
   ═══════════════════════════════════════════════════════════════════ */

/* Base highlight styling */
.highlight {
  transition: background-color 0.15s ease;
  cursor: pointer;
  position: relative;
}

.highlight::after {
  content: attr(data-tooltip);
  position: absolute;
  bottom: 100%;
  left: 50%;
  transform: translateX(-50%);
  padding: var(--space-xs) var(--space-sm);
  background: var(--bg-elevated, #333);
  color: var(--text-inverse, #fff);
  font-size: 0.75rem;
  border-radius: var(--radius-sm);
  white-space: nowrap;
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.15s ease;
  z-index: 100;
}

.highlight:hover::after {
  opacity: 1;
}

/* AI Detection - Score-based gradient colors */
.highlight--ai-high {
  background-color: rgba(var(--color-error-rgb, 220, 38, 38), 0.25);
  border-bottom: 2px solid var(--color-error, #dc2626);
}

.highlight--ai-medium {
  background-color: rgba(var(--color-warning-rgb, 217, 119, 6), 0.2);
  border-bottom: 2px solid var(--color-warning, #d97706);
}

.highlight--ai-low {
  background-color: rgba(var(--color-success-rgb, 22, 163, 74), 0.15);
  border-bottom: 2px solid var(--color-success, #16a34a);
}

/* GPTZero flagged sentences (premium) */
.highlight--gptzero {
  background-color: rgba(249, 115, 22, 0.15);
  outline: 2px dashed rgba(249, 115, 22, 0.6);
  outline-offset: 1px;
}

/* Tell-phrases - underline style */
.highlight--tell-phrase {
  text-decoration: underline;
  text-decoration-style: dotted;
  text-decoration-color: var(--color-info, #3b82f6);
  text-underline-offset: 3px;
}

.highlight--tell-phrase-ai {
  text-decoration-color: var(--color-error, #dc2626);
}

.highlight--tell-phrase-human {
  text-decoration-color: var(--color-success, #16a34a);
}

/* Diff highlights - Added/Removed/Changed */
.highlight--diff-add {
  background-color: rgba(var(--color-success-rgb, 22, 163, 74), 0.2);
  border-left: 3px solid var(--color-success, #16a34a);
  padding-left: var(--space-xs);
}

.highlight--diff-remove {
  background-color: rgba(var(--color-error-rgb, 220, 38, 38), 0.15);
  text-decoration: line-through;
  color: var(--color-error, #dc2626);
  opacity: 0.7;
}

.highlight--diff-change {
  background-color: rgba(var(--color-info-rgb, 59, 130, 246), 0.15);
  border-bottom: 2px dashed var(--color-info, #3b82f6);
}

/* Stylometry - Pattern highlights */
.highlight--stylometry {
  background-color: rgba(139, 92, 246, 0.15);
  border-bottom: 1px solid rgba(139, 92, 246, 0.5);
}

/* Highlightable text container */
.highlightable-text {
  line-height: 1.7;
  word-wrap: break-word;
  white-space: pre-wrap;
}

.highlightable-text--prose {
  font-family: var(--font-prose, Georgia, serif);
  font-size: 1.1rem;
}

.highlightable-text--code {
  font-family: var(--font-mono, monospace);
  font-size: 0.9rem;
  white-space: pre;
}

/* Sentence blocks (for sentence-level analysis) */
.sentence-highlight {
  display: inline;
  padding: 2px 0;
  border-radius: 2px;
  transition: all 0.15s ease;
}

.sentence-highlight:hover {
  filter: brightness(1.1);
}

.sentence-highlight--selected {
  outline: 2px solid var(--color-primary, #4a7c59);
  outline-offset: 2px;
}

/* Metrics sidebar within content pane */
.metrics-sidebar {
  position: absolute;
  right: 0;
  top: 0;
  bottom: 0;
  width: 280px;
  background: var(--bg-secondary, #f5f5f0);
  border-left: 1px solid var(--studio-border, #e5e2dc);
  transform: translateX(100%);
  transition: transform 0.25s ease;
  z-index: 50;
  overflow-y: auto;
}

.metrics-sidebar--open {
  transform: translateX(0);
}

.metrics-sidebar__header {
  padding: var(--space-md);
  border-bottom: 1px solid var(--studio-border, #e5e2dc);
  display: flex;
  justify-content: space-between;
  align-items: center;
  position: sticky;
  top: 0;
  background: var(--bg-secondary, #f5f5f0);
}

.metrics-sidebar__title {
  font-size: 0.875rem;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.05em;
  color: var(--studio-text-secondary, #666);
}

.metrics-sidebar__close {
  min-width: var(--touch-target-min, 44px);
  min-height: var(--touch-target-min, 44px);
  display: flex;
  align-items: center;
  justify-content: center;
  background: transparent;
  border: none;
  cursor: pointer;
  color: var(--studio-text-secondary, #666);
  border-radius: var(--radius-md);
}

.metrics-sidebar__close:hover {
  background: var(--studio-hover, rgba(0, 0, 0, 0.05));
}

.metrics-sidebar__content {
  padding: var(--space-md);
}

/* Score display in sidebar */
.metric-score {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: var(--space-sm);
  background: var(--bg-primary, #fff);
  border-radius: var(--radius-md);
  margin-bottom: var(--space-sm);
}

.metric-score__label {
  font-size: 0.8125rem;
  color: var(--studio-text-secondary, #666);
}

.metric-score__value {
  font-size: 1rem;
  font-weight: 600;
}

.metric-score__value--high { color: var(--color-error, #dc2626); }
.metric-score__value--medium { color: var(--color-warning, #d97706); }
.metric-score__value--low { color: var(--color-success, #16a34a); }

/* Score bar visualization */
.metric-bar {
  height: 8px;
  background: var(--bg-tertiary, #eee);
  border-radius: 4px;
  overflow: hidden;
  margin-top: var(--space-xs);
}

.metric-bar__fill {
  height: 100%;
  border-radius: 4px;
  transition: width 0.3s ease;
}

.metric-bar__fill--high { background: var(--color-error, #dc2626); }
.metric-bar__fill--medium { background: var(--color-warning, #d97706); }
.metric-bar__fill--low { background: var(--color-success, #16a34a); }

/* Metrics sidebar sections */
.metrics-sidebar__section {
  margin-bottom: var(--space-lg);
}

.metrics-sidebar__section h4 {
  font-size: 0.75rem;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.05em;
  color: var(--studio-text-tertiary, #999);
  margin-bottom: var(--space-sm);
}

.metrics-sidebar__layers {
  list-style: none;
  margin: 0;
  padding: 0;
}

.metrics-sidebar__layer {
  display: inline-block;
  padding: var(--space-xs) var(--space-sm);
  margin: 2px;
  background: var(--bg-tertiary, #f0f0f0);
  border-radius: var(--radius-sm);
  font-size: 0.75rem;
  text-transform: capitalize;
}

/* Analyzable markdown container */
.analyzable-markdown-container {
  position: relative;
  overflow: hidden;
}

.analyzable-markdown-container__content {
  padding-right: 0;
  transition: padding-right 0.25s ease;
}

.analyzable-markdown-container--with-metrics .analyzable-markdown-container__content {
  padding-right: 280px;
}

.analyzable-markdown {
  line-height: 1.75;
}

.analyzable-markdown--markdown {
  /* Standard markdown rendering */
}

.analyzable-markdown--highlight {
  /* Highlighted text mode */
}

/* ═══════════════════════════════════════════════════════════════════
   SPLIT MODE TOOLBAR
   ═══════════════════════════════════════════════════════════════════ */

.split-mode-toolbar {
  position: fixed;
  bottom: var(--space-xl, 32px);
  left: 50%;
  transform: translateX(-50%);
  display: flex;
  align-items: center;
  gap: var(--space-small, 8px);
  padding: var(--space-small, 8px) var(--space-medium, 16px);
  background: var(--color-surface-elevated, #fff);
  border: var(--border-width-thin, 1px) solid var(--color-border-subtle, #e5e2dc);
  border-radius: var(--radius-large, 12px);
  box-shadow: var(--shadow-medium, 0 4px 12px rgba(0, 0, 0, 0.08));
  opacity: 0.85;
  pointer-events: auto;
  transition: opacity var(--duration-normal, 0.2s) var(--ease-out, ease-out),
              transform 0.1s ease-out;
  z-index: 1000;
  cursor: grab;
  user-select: none;
  touch-action: none;
}

.split-mode-toolbar:active {
  cursor: grabbing;
}

.split-mode-toolbar--dragging {
  opacity: 1;
  box-shadow: var(--shadow-large, 0 8px 24px rgba(0, 0, 0, 0.15));
  transition: none; /* Disable transition while dragging */
}

/* Custom position when dragged (transform is updated via JS) */
.split-mode-toolbar--custom-position {
  left: auto;
  bottom: auto;
}

.split-mode-toolbar:hover,
.split-mode-toolbar--visible {
  opacity: 1;
}

/* WCAG 2.4.7: Visible focus indicator for keyboard navigation */
.split-mode-toolbar:focus-visible {
  opacity: 1;
  outline: 3px solid var(--color-primary, #4a7c59);
  outline-offset: 2px;
}

.split-mode-toolbar__section {
  display: flex;
  align-items: center;
  gap: var(--space-tiny, 4px);
}

.split-mode-toolbar__section-label {
  font-size: var(--text-size-small, 0.75rem);
  font-weight: var(--font-weight-medium, 500);
  color: var(--color-text-secondary, #666);  /* WCAG AA: 4.5:1+ contrast */
  text-transform: uppercase;
  letter-spacing: var(--letter-spacing-wide, 0.05em);
  margin-right: var(--space-small, 8px);
  white-space: nowrap;
}

.split-mode-toolbar__divider {
  width: var(--border-width-thin, 1px);
  height: 20px;
  background: var(--color-border-subtle, #e5e2dc);
  margin: 0 var(--space-small, 8px);
  flex-shrink: 0;
}

.split-mode-toolbar__button,
.split-mode-toolbar__toggle {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: var(--space-tiny, 4px);
  padding: var(--space-small, 8px) var(--space-medium, 12px);
  border: var(--border-width-thin, 1px) solid transparent;
  border-radius: var(--radius-medium, 6px);
  background: transparent;
  color: var(--color-text-secondary, #666);
  font-family: var(--font-family-body, system-ui, sans-serif);
  font-size: var(--text-size-small, 0.8125rem);
  font-weight: var(--font-weight-medium, 500);
  cursor: pointer;
  transition: all var(--duration-fast, 0.15s) var(--ease-out, ease-out);
  min-height: 44px; /* WCAG AA touch target minimum */
  min-width: 44px;  /* WCAG AAA: Square touch targets */
  white-space: nowrap;
}

.split-mode-toolbar__button:hover,
.split-mode-toolbar__toggle:hover {
  background: var(--color-surface-tertiary, rgba(0, 0, 0, 0.04));
  color: var(--color-text-primary, #333);
}

.split-mode-toolbar__button:focus-visible,
.split-mode-toolbar__toggle:focus-visible {
  outline: 2px solid var(--color-primary, #4a7c59);
  outline-offset: 2px;
  background: var(--color-surface-tertiary, rgba(0, 0, 0, 0.04));
}

.split-mode-toolbar__button:active,
.split-mode-toolbar__toggle:active {
  transform: scale(0.98);
}

.split-mode-toolbar__button--active {
  background: var(--color-primary, #4a7c59);
  color: var(--color-text-inverse, #fff);
  border-color: var(--color-primary, #4a7c59);
  font-weight: var(--font-weight-semibold, 600);
}

.split-mode-toolbar__button--active:hover {
  background: var(--color-primary-hover, #3d6749);
  color: var(--color-text-inverse, #fff);
}

.split-mode-toolbar__toggle--active {
  background: var(--color-primary-subtle, rgba(74, 124, 89, 0.12));
  border-color: var(--color-primary, #4a7c59);
  color: var(--color-primary, #4a7c59);
  font-weight: var(--font-weight-semibold, 600);
}

.split-mode-toolbar__toggle--active:hover {
  background: var(--color-primary, #4a7c59);
  color: var(--color-text-inverse, #fff);
}

.split-mode-toolbar__icon {
  font-size: 1rem;
  line-height: 1;
  flex-shrink: 0;
}

.split-mode-toolbar__label {
  display: none;
}

@media (min-width: 768px) {
  .split-mode-toolbar__label {
    display: inline;
  }
}

.split-mode-toolbar__badge {
  padding: var(--space-tiny, 4px) var(--space-small, 8px);
  background: var(--color-surface-tertiary, #f0f0f0);
  border: var(--border-width-thin, 1px) solid var(--color-border-subtle, #e5e2dc);
  border-radius: var(--radius-full, 9999px);
  font-size: var(--text-size-small, 0.75rem);
  color: var(--color-text-tertiary, #888);
  font-weight: var(--font-weight-medium, 500);
  white-space: nowrap;
}

/* Show toolbar fully when hovering workspace */
.split-workspace:hover .split-mode-toolbar {
  opacity: 1;
}

/* ═══════════════════════════════════════════════════════════════════
   DIFF VIEW
   ═══════════════════════════════════════════════════════════════════ */

.diff-view {
  display: flex;
  flex-direction: column;
  height: 100%;
  background: var(--bg-primary, #fff);
}

.diff-view__header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: var(--space-sm) var(--space-md);
  border-bottom: 1px solid var(--studio-border, #e5e2dc);
  background: var(--bg-secondary, #f5f5f0);
}

.diff-view__stats {
  display: flex;
  gap: var(--space-md);
}

.diff-view__stat {
  font-size: 0.875rem;
  color: var(--studio-text-secondary, #666);
}

.diff-view__stat--improved {
  color: var(--color-success, #16a34a);
}

.diff-view__stat--worse {
  color: var(--color-error, #dc2626);
}

/* Inline diff mode */
.diff-view__inline {
  flex: 1;
  padding: var(--space-md);
  line-height: 1.75;
  overflow-y: auto;
}

.diff-segment {
  transition: background-color 0.15s ease;
}

.diff-segment--unchanged {
  /* Normal text */
}

.diff-segment--removed {
  background-color: rgba(var(--color-error-rgb, 220, 38, 38), 0.2);
  text-decoration: line-through;
  color: var(--color-error, #dc2626);
  cursor: pointer;
}

.diff-segment--added {
  background-color: rgba(var(--color-success-rgb, 22, 163, 74), 0.2);
  color: var(--color-success-dark, #15803d);
  cursor: pointer;
}

.diff-segment--removed:hover,
.diff-segment--added:hover {
  filter: brightness(0.95);
}

/* Side-by-side mode */
.diff-view__side-by-side {
  display: flex;
  flex: 1;
  overflow: hidden;
}

.diff-view__pane {
  flex: 1;
  display: flex;
  flex-direction: column;
  min-width: 0;
}

.diff-view__pane-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: var(--space-sm) var(--space-md);
  border-bottom: 1px solid var(--studio-border, #e5e2dc);
  background: var(--bg-secondary, #f5f5f0);
}

.diff-view__pane-title {
  font-weight: 600;
  font-size: 0.875rem;
}

.diff-view__score {
  font-size: 0.875rem;
  padding: var(--space-xs) var(--space-sm);
  border-radius: var(--radius-sm);
  background: var(--bg-tertiary, #eee);
}

.diff-view__score--improved {
  background: rgba(var(--color-success-rgb, 22, 163, 74), 0.15);
  color: var(--color-success, #16a34a);
}

.diff-view__pane-content {
  flex: 1;
  padding: var(--space-md);
  overflow-y: auto;
  line-height: 1.75;
}

.diff-view__pane--original {
  border-right: 1px solid var(--studio-border, #e5e2dc);
}

.diff-view__divider {
  width: 4px;
  background: var(--studio-border, #e5e2dc);
  cursor: col-resize;
}

.diff-view__text {
  white-space: pre-wrap;
  word-wrap: break-word;
}

.diff-view__change {
  background-color: rgba(var(--color-warning-rgb, 217, 119, 6), 0.2);
  border-bottom: 2px solid var(--color-warning, #d97706);
  cursor: pointer;
}

.diff-view__change:hover {
  background-color: rgba(var(--color-warning-rgb, 217, 119, 6), 0.3);
}

/* Mobile: Stack side-by-side vertically */
@media (max-width: 768px) {
  .diff-view__side-by-side {
    flex-direction: column;
  }

  .diff-view__pane--original {
    border-right: none;
    border-bottom: 1px solid var(--studio-border, #e5e2dc);
    max-height: 50%;
  }

  .diff-view__divider {
    width: 100%;
    height: 4px;
    cursor: row-resize;
  }
}

/* Reduced motion for highlights */
@media (prefers-reduced-motion: reduce) {
  .highlight,
  .sentence-highlight,
  .metrics-sidebar,
  .metric-bar__fill {
    transition: none;
  }
}
/**
 * ImageCard Component Styles
 * 
 * Display images with metadata, supporting:
 * - Collapsed state (thumbnail ~300px)
 * - Expanded state (larger image up to 800px)
 * - Responsive layout (desktop: 2-col, mobile: stacked)
 * - Book-like sepia aesthetic
 * 
 * Following Design System Protocol:
 * - All spacing from --space-* tokens
 * - All colors from --color-* variables
 * - Mobile-first responsive design
 * - CSS variables with proper fallbacks
 * - BEM naming convention
 */

/* ═══════════════════════════════════════════════════════════════════
   IMAGE CARD - Main container
   ═══════════════════════════════════════════════════════════════════ */

.image-card {
  display: flex;
  flex-direction: column;
  background: var(--color-surface-elevated);
  border: var(--border-width-thin) solid var(--color-border-subtle);
  border-radius: var(--radius-large);
  overflow: hidden;
  box-shadow: var(--shadow-medium);
  transition:
    box-shadow var(--duration-normal) var(--ease-out),
    border-color var(--duration-normal) var(--ease-out);
  font-family: var(--font-family-body);
  color: var(--color-text-primary);
}

.image-card:hover {
  box-shadow: var(--shadow-large);
  border-color: var(--color-border-default);
}

.image-card:focus-within {
  box-shadow: var(--shadow-large), var(--shadow-focus);
}


/* ═══════════════════════════════════════════════════════════════════
   IMAGE CARD - Header with title and actions
   ═══════════════════════════════════════════════════════════════════ */

.image-card__header {
  display: flex;
  align-items: center;
  gap: var(--space-medium);
  padding: var(--space-medium);
  border-bottom: var(--border-width-thin) solid var(--color-border-subtle);
  background: var(--color-surface-secondary);
  flex-shrink: 0;
}

@media (prefers-reduced-motion: no-preference) {
  .image-card__header {
    transition: background var(--duration-fast) var(--ease-out);
  }
}

.image-card--expanded .image-card__header {
  background: var(--color-surface-tertiary);
  border-bottom-color: var(--color-border-default);
}


/* ─────────────────────────────────────────────────────────────────
   Back button
   ───────────────────────────────────────────────────────────────── */

.image-card__back {
  display: flex;
  align-items: center;
  justify-content: center;
  min-width: var(--touch-target);
  min-height: var(--touch-target);
  padding: 0;
  border: none;
  background: var(--color-surface-tertiary);
  color: var(--color-text-primary);
  border-radius: var(--radius-medium);
  font-size: var(--text-size-large);
  cursor: pointer;
  transition:
    background-color var(--duration-fast) var(--ease-out),
    color var(--duration-fast) var(--ease-out);
  flex-shrink: 0;
}

.image-card__back:hover {
  background: var(--color-primary);
  color: var(--color-text-inverse);
}

.image-card__back:focus-visible {
  outline: var(--border-width-medium) solid var(--color-border-focus);
  outline-offset: var(--space-tiny);
}

.image-card__back:active {
  transform: scale(0.95);
}


/* ─────────────────────────────────────────────────────────────────
   Title group (badge + filename)
   ───────────────────────────────────────────────────────────────── */

.image-card__title-group {
  display: flex;
  align-items: center;
  gap: var(--space-small);
  flex: 1;
  min-width: 0;
  overflow: hidden;
}

.image-card__type-badge {
  font-size: var(--text-size-small);
  white-space: nowrap;
  flex-shrink: 0;
}

.image-card__title {
  margin: 0;
  font-size: var(--text-size-large);
  font-weight: var(--font-weight-semibold);
  color: var(--color-text-primary);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  line-height: var(--line-height-tight);
}


/* ─────────────────────────────────────────────────────────────────
   Action buttons (expand, download)
   ───────────────────────────────────────────────────────────────── */

.image-card__actions {
  display: flex;
  align-items: center;
  gap: var(--space-small);
  flex-shrink: 0;
}

.image-card__action {
  display: flex;
  align-items: center;
  justify-content: center;
  min-width: var(--touch-target);
  min-height: var(--touch-target);
  padding: 0;
  border: var(--border-width-thin) solid var(--color-border-default);
  background: var(--color-surface-primary);
  color: var(--color-text-secondary);
  border-radius: var(--radius-medium);
  font-size: var(--text-size-body);
  cursor: pointer;
  transition:
    background-color var(--duration-fast) var(--ease-out),
    border-color var(--duration-fast) var(--ease-out),
    color var(--duration-fast) var(--ease-out);
}

.image-card__action:hover {
  background: var(--color-surface-tertiary);
  border-color: var(--color-border-strong);
  color: var(--color-text-primary);
}

.image-card__action:focus-visible {
  outline: var(--border-width-medium) solid var(--color-border-focus);
  outline-offset: var(--space-tiny);
}

.image-card__action:active {
  transform: scale(0.92);
}


/* ═══════════════════════════════════════════════════════════════════
   IMAGE CARD BODY - Main content area with responsive layout
   ═══════════════════════════════════════════════════════════════════ */

.image-card__body {
  display: flex;
  flex-direction: column;
  flex: 1;
  min-height: 0;
  overflow: hidden;
  gap: var(--space-medium);
  padding: var(--space-medium);
}

/* Mobile-first: stacked layout */
@media (min-width: 768px) {
  .image-card__body {
    flex-direction: row;
    gap: var(--space-large);
  }
}


/* ═══════════════════════════════════════════════════════════════════
   IMAGE CARD FIGURE - Image container with constrained sizing
   ═══════════════════════════════════════════════════════════════════ */

.image-card__figure {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  margin: 0;
  padding: 0;
  border-radius: var(--radius-medium);
  overflow: hidden;
  background: var(--color-surface-sunken);
  border: var(--border-width-thin) solid var(--color-border-subtle);
  position: relative;
  cursor: pointer;
  flex-shrink: 0;
  transition:
    border-color var(--duration-normal) var(--ease-out),
    transform var(--duration-normal) var(--ease-out);
}

.image-card__figure:hover {
  border-color: var(--color-border-default);
  transform: scale(1.01);
}

/* Collapsed state: constrained thumbnail */
.image-card:not(.image-card--expanded) .image-card__figure {
  max-width: 300px;
  max-height: 300px;
  width: 100%;
  aspect-ratio: 1 / 1;
  align-self: center;
}

/* Expanded state: larger image */
.image-card--expanded .image-card__figure {
  max-width: clamp(300px, 100%, 800px);
  max-height: 600px;
  width: 100%;
  aspect-ratio: auto;
}

/* Tablet and up: fixed widths in 2-col layout */
@media (min-width: 768px) {
  .image-card:not(.image-card--expanded) .image-card__figure {
    max-width: 280px;
    max-height: 280px;
  }

  .image-card--expanded .image-card__figure {
    min-width: 400px;
    max-width: 600px;
  }
}

/* Desktop: even larger expanded state */
@media (min-width: 1024px) {
  .image-card--expanded .image-card__figure {
    max-width: 800px;
  }
}


/* ─────────────────────────────────────────────────────────────────
   Image element itself
   ───────────────────────────────────────────────────────────────── */

.image-card__image {
  width: 100%;
  height: 100%;
  object-fit: cover;
  display: block;
}


/* ─────────────────────────────────────────────────────────────────
   Caption (click to expand)
   ───────────────────────────────────────────────────────────────── */

.image-card__caption {
  position: absolute;
  bottom: 0;
  left: 0;
  right: 0;
  padding: var(--space-small) var(--space-medium);
  background: linear-gradient(
    to top,
    hsl(0, 0%, 0%, 0.6),
    transparent
  );
  color: var(--color-text-inverse);
  font-size: var(--text-size-small);
  text-align: center;
  opacity: 0;
  transition: opacity var(--duration-normal) var(--ease-out);
}

.image-card__figure:hover .image-card__caption {
  opacity: 1;
}


/* ═══════════════════════════════════════════════════════════════════
   IMAGE CARD METADATA - Sidebar with details (right on desktop, below on mobile)
   ═══════════════════════════════════════════════════════════════════ */

.image-card__metadata {
  display: flex;
  flex-direction: column;
  gap: var(--space-large);
  min-width: 0;
  overflow-y: auto;
}

/* Mobile: full width below image */
@media (min-width: 768px) {
  .image-card__metadata {
    flex-shrink: 0;
    width: 280px;
    max-height: 100%;
    border-left: var(--border-width-thin) solid var(--color-border-subtle);
    padding-left: var(--space-medium);
  }

  .image-card:not(.image-card--expanded) .image-card__metadata {
    width: 260px;
  }

  .image-card--expanded .image-card__metadata {
    width: 280px;
  }
}

@media (min-width: 1024px) {
  .image-card--expanded .image-card__metadata {
    width: 320px;
  }
}


/* ─────────────────────────────────────────────────────────────────
   Details section title
   ───────────────────────────────────────────────────────────────── */

.image-card__section-title {
  margin: 0;
  font-size: var(--text-size-body);
  font-weight: var(--font-weight-semibold);
  color: var(--color-text-primary);
  text-transform: uppercase;
  letter-spacing: var(--letter-spacing-wide);
  padding-bottom: var(--space-small);
  border-bottom: var(--border-width-thin) solid var(--color-border-subtle);
}


/* ─────────────────────────────────────────────────────────────────
   Details list (dimensions, size, date, source)
   ───────────────────────────────────────────────────────────────── */

.image-card__details {
  margin: 0;
  padding: 0;
  display: grid;
  grid-template-columns: max-content 1fr;
  gap: var(--space-small) var(--space-medium);
  font-size: var(--text-size-small);
  line-height: var(--line-height-normal);
}

.image-card__details dt {
  font-weight: var(--font-weight-semibold);
  color: var(--color-text-secondary);
  text-align: left;
}

.image-card__details dd {
  margin: 0;
  color: var(--color-text-primary);
  word-break: break-word;
  font-family: var(--font-family-mono);
}


/* ─────────────────────────────────────────────────────────────────
   Context sections (generation prompt, AI description, associated text)
   ───────────────────────────────────────────────────────────────── */

.image-card__context-section {
  display: flex;
  flex-direction: column;
  gap: var(--space-small);
  padding: var(--space-medium);
  background: var(--color-surface-secondary);
  border-radius: var(--radius-medium);
  border-left: var(--border-width-thick) solid var(--color-accent);
}

.image-card__context-title {
  margin: 0;
  font-size: var(--text-size-body);
  font-weight: var(--font-weight-semibold);
  color: var(--color-text-primary);
}


/* ─────────────────────────────────────────────────────────────────
   DALL-E generation prompt quote block
   ───────────────────────────────────────────────────────────────── */

.image-card__quote {
  margin: 0;
  padding: 0;
  font-family: var(--font-family-reading);
  font-size: var(--text-size-body);
  font-style: italic;
  color: var(--color-text-secondary);
  line-height: var(--line-height-relaxed);
}


/* ─────────────────────────────────────────────────────────────────
   AI description paragraph
   ───────────────────────────────────────────────────────────────── */

.image-card__description {
  margin: 0;
  font-size: var(--text-size-body);
  color: var(--color-text-primary);
  line-height: var(--line-height-normal);
}


/* ─────────────────────────────────────────────────────────────────
   Associated text (post text, context)
   ───────────────────────────────────────────────────────────────── */

.image-card__associated-text {
  margin: 0;
  font-size: var(--text-size-small);
  color: var(--color-text-secondary);
  line-height: var(--line-height-normal);
  max-height: 200px;
  overflow-y: auto;
}


/* ═══════════════════════════════════════════════════════════════════
   EXPANDED STATE CHANGES
   ═══════════════════════════════════════════════════════════════════ */

.image-card--expanded {
  border-color: var(--color-border-strong);
}

/* In expanded state, reflow body for better prominence */
@media (min-width: 768px) {
  .image-card--expanded .image-card__body {
    gap: var(--space-xlarge);
  }
}


/* ═══════════════════════════════════════════════════════════════════
   REDUCED MOTION SUPPORT
   ═══════════════════════════════════════════════════════════════════ */

@media (prefers-reduced-motion: reduce) {
  .image-card,
  .image-card__back,
  .image-card__action,
  .image-card__figure,
  .image-card__caption {
    transition-duration: 0.01ms !important;
  }

  .image-card__back:active,
  .image-card__action:active {
    transform: none;
  }

  .image-card__figure:hover {
    transform: none;
  }
}


/* ═══════════════════════════════════════════════════════════════════
   DARK MODE ADJUSTMENTS
   ═══════════════════════════════════════════════════════════════════ */

@media (prefers-color-scheme: dark) {
  /* Enhanced contrast for dark mode */
  .image-card__figure {
    border-color: var(--color-border-default);
  }

  .image-card__metadata {
    border-left-color: var(--color-border-default);
  }

  .image-card__context-section {
    border-left-color: var(--color-accent);
  }
}


/* ═══════════════════════════════════════════════════════════════════
   SEPIA THEME SPECIFIC
   ═══════════════════════════════════════════════════════════════════ */

[data-theme="sepia"] .image-card__context-section {
  background: var(--color-surface-secondary);
  border-left-color: var(--color-accent-warm, var(--color-primary, hsl(35, 80%, 50%)));
}

[data-theme="sepia"] .image-card__quote {
  color: var(--color-text-secondary);
  font-weight: var(--font-weight-medium);
}


/* ═══════════════════════════════════════════════════════════════════
   SCROLLBAR STYLING (metadata panel overflow)
   ═══════════════════════════════════════════════════════════════════ */

.image-card__metadata::-webkit-scrollbar {
  width: 4px;
}

.image-card__metadata::-webkit-scrollbar-track {
  background: transparent;
}

.image-card__metadata::-webkit-scrollbar-thumb {
  background: var(--color-border-default);
  border-radius: var(--radius-full);
}

.image-card__metadata::-webkit-scrollbar-thumb:hover {
  background: var(--color-border-strong);
}

.image-card__associated-text::-webkit-scrollbar {
  width: 3px;
}

.image-card__associated-text::-webkit-scrollbar-track {
  background: transparent;
}

.image-card__associated-text::-webkit-scrollbar-thumb {
  background: var(--color-border-subtle);
  border-radius: var(--radius-full);
}

.image-card__associated-text::-webkit-scrollbar-thumb:hover {
  background: var(--color-border-default);
}

/* ============================================================
   ELECTRON - ChatGPT-style Traffic Light Integration
   No separate title bar - traffic lights sit in the app's topbar
   ============================================================ */

/* Full-height container for Electron */
.electron-container {
  display: flex;
  flex-direction: column;
  height: 100vh;
  width: 100vw;
  overflow: hidden;
}

/* Make studio fill Electron container properly */
.electron-container .studio {
  min-height: auto;
  height: 100%;
  display: flex;
  flex-direction: column;
  overflow: hidden;
}

/* Make studio__main scroll properly */
.electron-container .studio__main {
  flex: 1;
  min-height: 0; /* Critical: Allow flex item to shrink below content size */
  overflow-y: auto;
  -webkit-overflow-scrolling: touch;
}

/* ============================================================
   macOS-specific: Traffic light accommodation
   ============================================================ */

/* Topbar becomes the drag region for window movement */
.electron-container--mac .studio-topbar {
  -webkit-app-region: drag;
  /* Extra padding on left for traffic lights (red/yellow/green) */
  padding-left: 80px;
}

/* All interactive elements must be excluded from drag region */
.electron-container--mac .studio-topbar button,
.electron-container--mac .studio-topbar a,
.electron-container--mac .studio-topbar input,
.electron-container--mac .studio-topbar select,
.electron-container--mac .studio-topbar [role="button"],
.electron-container--mac .studio-topbar .theme-toggle,
.electron-container--mac .studio-topbar .studio-topbar__btn,
.electron-container--mac .studio-topbar .studio-topbar__nav,
.electron-container--mac .studio-topbar .studio-topbar__breadcrumb {
  -webkit-app-region: no-drag;
}

/* No-drag utility class */
.no-drag {
  -webkit-app-region: no-drag;
}

/* Legacy support */
.window-container {
  display: flex;
  flex-direction: column;
  height: 100vh;
  width: 100vw;
  overflow: hidden;
}

.window-title-bar {
  -webkit-app-region: drag;
  padding-left: 80px;
}

.window-title-bar button,
.window-title-bar a,
.window-title-bar input,
.window-title-bar select,
.window-title-bar [role="button"] {
  -webkit-app-region: no-drag;
}

/* ═══════════════════════════════════════════════════════════════════
   QUEUE TAB COMPONENTS
   ═══════════════════════════════════════════════════════════════════ */

/* Queue Tab Container */
.queue-tab {
  display: flex;
  flex-direction: column;
  height: 100%;
  overflow: hidden;
}

.queue-tab--unavailable {
  display: flex;
  align-items: center;
  justify-content: center;
}

.queue-tab__message {
  text-align: center;
  color: var(--studio-text-muted, #666);
}

.queue-tab__message h3 {
  margin: 0 0 0.5rem;
  font-size: 1rem;
  font-weight: 500;
}

.queue-tab__message p {
  margin: 0;
  font-size: 0.875rem;
}

/* Status Bar */
.queue-tab__status-bar {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 0.5rem 0.75rem;
  background: var(--studio-panel-bg, #f5f3ef);
  border-bottom: 1px solid var(--studio-border, #e5e2dc);
}

.queue-tab__status-info {
  display: flex;
  gap: 1rem;
}

.queue-tab__status-item {
  font-size: 0.75rem;
  color: var(--studio-text, #1a1a1a);
}

.queue-tab__status-label {
  color: var(--studio-text-muted, #666);
  margin-right: 0.25rem;
}

.queue-tab__status-value {
  font-weight: 500;
}

.queue-tab__controls {
  display: flex;
  gap: 0.5rem;
}

.queue-tab__control-btn {
  padding: 0.375rem 0.75rem;
  font-size: 0.75rem;
  color: var(--studio-text, #1a1a1a);
  background: var(--studio-surface, #fff);
  border: 1px solid var(--studio-border, #e5e2dc);
  border-radius: 4px;
  cursor: pointer;
  transition: background 0.15s ease, border-color 0.15s ease;
  min-height: 32px;
}

.queue-tab__control-btn:hover {
  background: var(--studio-hover, #ede9e3);
}

.queue-tab__control-btn:disabled {
  opacity: 0.5;
  cursor: default;
}

.queue-tab__control-btn--resume {
  background: var(--studio-accent, #8b7355);
  color: white;
  border-color: var(--studio-accent, #8b7355);
}

.queue-tab__control-btn--resume:hover {
  background: var(--studio-accent-hover, #7a6348);
}

/* Sections */
.queue-tab__section {
  padding: 0.75rem;
  border-bottom: 1px solid var(--studio-border, #e5e2dc);
}

.queue-tab__section-title {
  margin: 0 0 0.5rem;
  font-size: 0.8rem;
  font-weight: 500;
  color: var(--studio-text-muted, #666);
}

.queue-tab__jobs-list {
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
}

.queue-tab__empty {
  padding: 2rem;
  text-align: center;
  color: var(--studio-text-muted, #666);
  font-size: 0.875rem;
}

/* ─────────────────────────────────────────────────────────────────
   Batch Job Form
   ───────────────────────────────────────────────────────────────── */

.batch-job-form {
  padding: 0.75rem;
  border-bottom: 1px solid var(--studio-border, #e5e2dc);
  background: var(--studio-panel-bg, #f5f3ef);
}

.batch-job-form__title {
  margin: 0 0 0.75rem;
  font-size: 0.9rem;
  font-weight: 500;
  color: var(--studio-text, #1a1a1a);
}

.batch-job-form__field {
  margin-bottom: 0.75rem;
}

.batch-job-form__label {
  display: block;
  margin-bottom: 0.25rem;
  font-size: 0.75rem;
  font-weight: 500;
  color: var(--studio-text, #1a1a1a);
}

.batch-job-form__select {
  width: 100%;
  padding: 0.5rem;
  font-size: 0.8rem;
  color: var(--studio-text, #1a1a1a);
  background: var(--studio-surface, #fff);
  border: 1px solid var(--studio-border, #e5e2dc);
  border-radius: 4px;
  outline: none;
}

.batch-job-form__select:focus {
  border-color: var(--studio-accent, #8b7355);
}

.batch-job-form__hint {
  margin: 0.25rem 0 0;
  font-size: 0.7rem;
  color: var(--studio-text-muted, #666);
}

.batch-job-form__range-wrapper {
  display: flex;
  align-items: center;
  gap: 0.75rem;
}

.batch-job-form__range {
  flex: 1;
  height: 4px;
  accent-color: var(--studio-accent, #8b7355);
}

.batch-job-form__range-value {
  font-size: 0.75rem;
  color: var(--studio-text-muted, #666);
  min-width: 70px;
}

/* Dropzone */
.batch-job-form__dropzone {
  position: relative;
  border: 2px dashed var(--studio-border, #e5e2dc);
  border-radius: 6px;
  background: var(--studio-surface, #fff);
  transition: border-color 0.15s ease, background 0.15s ease;
}

.batch-job-form__dropzone:hover {
  border-color: var(--studio-accent, #8b7355);
  background: var(--studio-hover, #ede9e3);
}

.batch-job-form__file-input {
  position: absolute;
  inset: 0;
  opacity: 0;
  cursor: pointer;
}

.batch-job-form__dropzone-label {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 1.5rem;
  color: var(--studio-text-muted, #666);
  font-size: 0.8rem;
  text-align: center;
  cursor: pointer;
}

.batch-job-form__dropzone-icon {
  font-size: 1.5rem;
  margin-bottom: 0.5rem;
}

.batch-job-form__clear-btn {
  margin-top: 0.5rem;
  padding: 0.25rem 0.5rem;
  font-size: 0.7rem;
  color: var(--studio-text-muted, #666);
  background: transparent;
  border: none;
  cursor: pointer;
  text-decoration: underline;
}

.batch-job-form__clear-btn:hover {
  color: var(--studio-text, #1a1a1a);
}

/* Messages */
.batch-job-form__message {
  padding: 0.5rem 0.75rem;
  margin-bottom: 0.75rem;
  font-size: 0.75rem;
  border-radius: 4px;
}

.batch-job-form__message--error {
  background: rgba(220, 53, 69, 0.1);
  color: #dc3545;
  border: 1px solid rgba(220, 53, 69, 0.2);
}

.batch-job-form__message--success {
  background: rgba(40, 167, 69, 0.1);
  color: #28a745;
  border: 1px solid rgba(40, 167, 69, 0.2);
}

/* Submit Button */
.batch-job-form__submit {
  width: 100%;
  padding: 0.625rem 1rem;
  font-size: 0.8rem;
  font-weight: 500;
  color: white;
  background: var(--studio-accent, #8b7355);
  border: none;
  border-radius: 4px;
  cursor: pointer;
  transition: background 0.15s ease;
  min-height: 44px; /* WCAG touch target */
}

.batch-job-form__submit:hover:not(:disabled) {
  background: var(--studio-accent-hover, #7a6348);
}

.batch-job-form__submit:disabled {
  opacity: 0.5;
  cursor: default;
}

/* ─────────────────────────────────────────────────────────────────
   Job Progress Card
   ───────────────────────────────────────────────────────────────── */

.job-progress-card {
  padding: 0.75rem;
  background: var(--studio-surface, #fff);
  border: 1px solid var(--studio-border, #e5e2dc);
  border-radius: 6px;
}

.job-progress-card--processing {
  border-left: 3px solid var(--studio-accent, #8b7355);
}

.job-progress-card--pending,
.job-progress-card--paused {
  border-left: 3px solid var(--studio-text-muted, #666);
}

.job-progress-card__header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 0.5rem;
}

.job-progress-card__title {
  margin: 0;
  font-size: 0.85rem;
  font-weight: 500;
  color: var(--studio-text, #1a1a1a);
}

.job-progress-card__status {
  font-size: 0.7rem;
  padding: 0.125rem 0.375rem;
  border-radius: 3px;
  text-transform: uppercase;
  font-weight: 500;
}

.job-progress-card__status--processing {
  background: rgba(139, 115, 85, 0.1);
  color: var(--studio-accent, #8b7355);
}

.job-progress-card__status--pending,
.job-progress-card__status--paused {
  background: rgba(108, 117, 125, 0.1);
  color: var(--studio-text-muted, #666);
}

/* Progress Bar */
.job-progress-card__progress-wrapper {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  margin-bottom: 0.5rem;
}

.job-progress-card__progress-bar {
  flex: 1;
  height: 8px;
  background: var(--studio-hover, #ede9e3);
  border-radius: 4px;
  overflow: hidden;
}

.job-progress-card__progress-fill {
  height: 100%;
  background: var(--studio-accent, #8b7355);
  transition: width 0.3s ease;
}

.job-progress-card__progress-text {
  font-size: 0.7rem;
  color: var(--studio-text-muted, #666);
  min-width: 80px;
  text-align: right;
}

/* Current File */
.job-progress-card__current-file {
  font-size: 0.7rem;
  color: var(--studio-text-muted, #666);
  margin-bottom: 0.5rem;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.job-progress-card__current-file .job-progress-card__value {
  font-family: var(--font-mono, monospace);
}

/* Stats */
.job-progress-card__stats {
  display: flex;
  gap: 1rem;
  margin-bottom: 0.5rem;
  font-size: 0.7rem;
}

.job-progress-card__stat {
  color: var(--studio-text-muted, #666);
}

.job-progress-card__stat-label {
  margin-right: 0.25rem;
}

.job-progress-card__stat--success .job-progress-card__stat-value {
  color: #28a745;
}

.job-progress-card__stat--error .job-progress-card__stat-value {
  color: #dc3545;
}

/* Actions */
.job-progress-card__actions {
  display: flex;
  gap: 0.5rem;
  margin-top: 0.5rem;
}

.job-progress-card__cancel-btn {
  padding: 0.375rem 0.75rem;
  font-size: 0.7rem;
  color: #dc3545;
  background: transparent;
  border: 1px solid #dc3545;
  border-radius: 4px;
  cursor: pointer;
  transition: background 0.15s ease;
  min-height: 32px;
}

.job-progress-card__cancel-btn:hover {
  background: rgba(220, 53, 69, 0.1);
}

/* Messages */
.job-progress-card__pending-msg,
.job-progress-card__paused-msg {
  font-size: 0.7rem;
  color: var(--studio-text-muted, #666);
  font-style: italic;
  margin-top: 0.5rem;
}

/* ─────────────────────────────────────────────────────────────────
   Job History List
   ───────────────────────────────────────────────────────────────── */

.job-history-list {
  list-style: none;
  margin: 0;
  padding: 0;
}

.job-history-list__item {
  border: 1px solid var(--studio-border, #e5e2dc);
  border-radius: 4px;
  margin-bottom: 0.25rem;
  overflow: hidden;
}

.job-history-list__item--completed {
  border-left: 3px solid #28a745;
}

.job-history-list__item--failed {
  border-left: 3px solid #dc3545;
}

.job-history-list__item--cancelled {
  border-left: 3px solid var(--studio-text-muted, #666);
}

/* Summary Button */
.job-history-list__summary {
  display: flex;
  align-items: center;
  width: 100%;
  padding: 0.5rem 0.75rem;
  background: var(--studio-surface, #fff);
  border: none;
  cursor: pointer;
  text-align: left;
  font-size: 0.75rem;
  gap: 0.5rem;
  transition: background 0.15s ease;
}

.job-history-list__summary:hover {
  background: var(--studio-hover, #ede9e3);
}

.job-history-list__icon {
  font-size: 0.9rem;
  width: 1.25rem;
  text-align: center;
}

.job-history-list__icon--completed {
  color: #28a745;
}

.job-history-list__icon--failed {
  color: #dc3545;
}

.job-history-list__icon--cancelled {
  color: var(--studio-text-muted, #666);
}

.job-history-list__type {
  flex: 1;
  font-weight: 500;
  color: var(--studio-text, #1a1a1a);
}

.job-history-list__count {
  color: var(--studio-text-muted, #666);
  min-width: 40px;
  text-align: center;
}

.job-history-list__time {
  color: var(--studio-text-muted, #666);
  min-width: 60px;
  text-align: right;
}

.job-history-list__expand-icon {
  color: var(--studio-text-muted, #666);
  width: 1rem;
  text-align: center;
}

/* Details */
.job-history-list__details {
  padding: 0.75rem;
  background: var(--studio-panel-bg, #f5f3ef);
  border-top: 1px solid var(--studio-border, #e5e2dc);
}

.job-history-list__detail-row {
  display: flex;
  gap: 0.5rem;
  font-size: 0.7rem;
  margin-bottom: 0.25rem;
}

.job-history-list__detail-label {
  color: var(--studio-text-muted, #666);
  min-width: 60px;
}

.job-history-list__detail-value {
  color: var(--studio-text, #1a1a1a);
}

.job-history-list__detail-value--success {
  color: #28a745;
}

.job-history-list__detail-value--error {
  color: #dc3545;
}

.job-history-list__detail-row--error {
  color: #dc3545;
}

/* Failures List */
.job-history-list__failures {
  margin-top: 0.5rem;
}

.job-history-list__failure-list {
  list-style: none;
  margin: 0.25rem 0 0;
  padding: 0;
}

.job-history-list__failure-item {
  font-size: 0.65rem;
  color: #dc3545;
  padding: 0.125rem 0;
}

.job-history-list__failure-file {
  font-family: var(--font-mono, monospace);
}

.job-history-list__failure-error {
  display: block;
  font-style: italic;
  opacity: 0.8;
}

.job-history-list__failure-more {
  color: var(--studio-text-muted, #666);
  font-style: italic;
}

/* Actions */
.job-history-list__actions {
  display: flex;
  gap: 0.5rem;
  margin-top: 0.5rem;
  padding-top: 0.5rem;
  border-top: 1px solid var(--studio-border, #e5e2dc);
}

.job-history-list__delete-btn {
  padding: 0.25rem 0.5rem;
  font-size: 0.7rem;
  color: var(--studio-text-muted, #666);
  background: transparent;
  border: 1px solid var(--studio-border, #e5e2dc);
  border-radius: 4px;
  cursor: pointer;
  transition: color 0.15s ease, border-color 0.15s ease;
}

.job-history-list__delete-btn:hover {
  color: #dc3545;
  border-color: #dc3545;
}

/* ═══════════════════════════════════════════════════════════════════ */
/* QUEUE - Agent Proposals                                             */
/* ═══════════════════════════════════════════════════════════════════ */

.queue-proposals {
  margin: 1rem 0;
  padding: 0.75rem;
  background: var(--studio-bg-secondary, #f8f5f1);
  border: 1px solid var(--studio-border, #e5e2dc);
  border-radius: 6px;
}

.queue-proposals__title {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  margin: 0 0 0.75rem;
  font-size: 0.85rem;
  font-weight: 600;
  color: var(--studio-text-primary, #1a1918);
}

.queue-proposals__count {
  background: var(--studio-accent, #4a90d9);
  color: white;
  padding: 0.125rem 0.375rem;
  border-radius: 10px;
  font-size: 0.7rem;
  font-weight: 500;
}

.queue-proposals__loading,
.queue-proposals__empty {
  font-size: 0.75rem;
  color: var(--studio-text-muted, #666);
  text-align: center;
  padding: 0.75rem;
}

.queue-proposals__list {
  list-style: none;
  margin: 0;
  padding: 0;
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
}

/* Individual proposal */
.queue-proposal {
  background: var(--studio-bg-primary, #fff);
  border: 1px solid var(--studio-border, #e5e2dc);
  border-radius: 4px;
  padding: 0.625rem;
  transition: border-color 0.15s ease;
}

.queue-proposal:hover {
  border-color: var(--studio-accent, #4a90d9);
}

.queue-proposal--processing {
  opacity: 0.6;
  pointer-events: none;
}

/* Urgency indicators */
.queue-proposal[data-urgency="high"],
.queue-proposal[data-urgency="critical"] {
  border-left: 3px solid #dc3545;
}

.queue-proposal[data-urgency="normal"] {
  border-left: 3px solid var(--studio-accent, #4a90d9);
}

.queue-proposal[data-urgency="low"] {
  border-left: 3px solid var(--studio-text-muted, #999);
}

/* Proposal header */
.queue-proposal__header {
  display: flex;
  align-items: flex-start;
  gap: 0.5rem;
}

.queue-proposal__urgency {
  flex-shrink: 0;
  font-size: 0.875rem;
  line-height: 1;
  padding-top: 0.125rem;
}

.queue-proposal[data-urgency="critical"] .queue-proposal__urgency {
  color: #dc3545;
  font-weight: 700;
}

.queue-proposal[data-urgency="high"] .queue-proposal__urgency {
  color: #fd7e14;
}

.queue-proposal[data-urgency="normal"] .queue-proposal__urgency {
  color: var(--studio-accent, #4a90d9);
}

.queue-proposal[data-urgency="low"] .queue-proposal__urgency {
  color: var(--studio-text-muted, #999);
}

.queue-proposal__info {
  flex: 1;
  min-width: 0;
}

.queue-proposal__title-btn {
  display: flex;
  align-items: center;
  justify-content: space-between;
  width: 100%;
  padding: 0;
  margin: 0;
  font-size: 0.8rem;
  font-weight: 500;
  color: var(--studio-text-primary, #1a1918);
  background: transparent;
  border: none;
  cursor: pointer;
  text-align: left;
}

.queue-proposal__title-btn:hover {
  color: var(--studio-accent, #4a90d9);
}

.queue-proposal__expand-icon {
  flex-shrink: 0;
  font-size: 0.75rem;
  color: var(--studio-text-muted, #666);
}

.queue-proposal__meta {
  display: flex;
  gap: 0.5rem;
  margin-top: 0.25rem;
  font-size: 0.65rem;
  color: var(--studio-text-muted, #666);
}

.queue-proposal__agent {
  font-weight: 500;
}

/* Proposal details (expanded) */
.queue-proposal__details {
  margin: 0.5rem 0 0 1.25rem;
  padding-top: 0.5rem;
  border-top: 1px dashed var(--studio-border, #e5e2dc);
}

.queue-proposal__description {
  margin: 0 0 0.5rem;
  font-size: 0.75rem;
  color: var(--studio-text-primary, #1a1918);
  line-height: 1.4;
}

.queue-proposal__action-type,
.queue-proposal__project {
  font-size: 0.65rem;
  color: var(--studio-text-muted, #666);
  margin-bottom: 0.25rem;
}

.queue-proposal__action-type code {
  background: var(--studio-bg-secondary, #f8f5f1);
  padding: 0.125rem 0.25rem;
  border-radius: 2px;
  font-family: var(--font-mono, monospace);
}

/* Proposal actions */
.queue-proposal__actions {
  display: flex;
  gap: 0.5rem;
  margin-top: 0.5rem;
}

.queue-proposal__btn {
  flex: 1;
  min-height: 44px; /* WCAG touch target */
  padding: 0.5rem 0.75rem;
  font-size: 0.75rem;
  font-weight: 500;
  border-radius: 4px;
  cursor: pointer;
  transition: background-color 0.15s ease, border-color 0.15s ease;
}

.queue-proposal__btn:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

.queue-proposal__btn--approve {
  background: var(--studio-accent, #4a90d9);
  color: white;
  border: 1px solid var(--studio-accent, #4a90d9);
}

.queue-proposal__btn--approve:hover:not(:disabled) {
  background: #3a80c9;
}

.queue-proposal__btn--reject {
  background: transparent;
  color: var(--studio-text-muted, #666);
  border: 1px solid var(--studio-border, #e5e2dc);
}

.queue-proposal__btn--reject:hover:not(:disabled) {
  color: #dc3545;
  border-color: #dc3545;
}

/* ═══════════════════════════════════════════════════════════════════
   HARVEST QUEUE PANEL - Passage curation and bucket management
   ═══════════════════════════════════════════════════════════════════ */

.harvest-panel {
  display: flex;
  flex-direction: column;
  height: 100%;
  overflow: hidden;
}

.harvest-panel--empty {
  align-items: center;
  justify-content: center;
  text-align: center;
  color: var(--studio-text-muted, #666);
  padding: var(--space-lg, 1.5rem);
}

.harvest-panel__hint {
  font-size: 0.75rem;
  margin-top: 0.5rem;
  opacity: 0.7;
}

.harvest-panel__header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 0.75rem 1rem;
  border-bottom: 1px solid var(--studio-border, #e5e2dc);
}

.harvest-panel__title {
  font-size: 0.875rem;
  font-weight: 600;
  margin: 0;
}

.harvest-panel__count {
  font-size: 0.75rem;
  color: var(--studio-text-muted, #666);
  background: var(--studio-bg-secondary, #f8f5f1);
  padding: 0.125rem 0.5rem;
  border-radius: 9999px;
}

.harvest-panel__buckets {
  flex: 1;
  overflow-y: auto;
  padding: 0.5rem;
}

/* Bucket container */
.harvest-bucket {
  margin-bottom: 0.5rem;
  border: 1px solid var(--studio-border, #e5e2dc);
  border-radius: 6px;
  background: var(--studio-bg-primary, #fff);
}

/* Bucket header */
.bucket-header {
  display: flex;
  flex-wrap: wrap;
  align-items: center;
  gap: 0.5rem;
  padding: 0.5rem 0.75rem;
  background: var(--studio-bg-secondary, #f8f5f1);
  border-radius: 5px 5px 0 0;
}

.bucket-header__toggle {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  background: none;
  border: none;
  padding: 0;
  cursor: pointer;
  font: inherit;
  color: inherit;
}

.bucket-header__icon {
  font-size: 0.625rem;
  opacity: 0.6;
}

.bucket-header__title {
  font-weight: 500;
  font-size: 0.8125rem;
}

.bucket-header__status {
  font-size: 0.625rem;
  padding: 0.125rem 0.375rem;
  border-radius: 9999px;
  text-transform: uppercase;
  font-weight: 500;
}

.bucket-header__status--collecting {
  background: #e3f2fd;
  color: #1976d2;
}

.bucket-header__status--reviewing {
  background: #fff3e0;
  color: #f57c00;
}

.bucket-header__status--staged {
  background: #e8f5e9;
  color: #388e3c;
}

.bucket-header__stats {
  display: flex;
  gap: 0.5rem;
  margin-left: auto;
}

.bucket-stat {
  font-size: 0.6875rem;
  color: var(--studio-text-muted, #666);
}

.bucket-stat--approved {
  color: #388e3c;
}

.bucket-stat--gems {
  color: #7b1fa2;
}

.bucket-header__progress {
  width: 100%;
  height: 4px;
  background: var(--studio-border, #e5e2dc);
  border-radius: 2px;
  overflow: hidden;
  position: relative;
  margin-top: 0.25rem;
}

.bucket-header__progress-bar {
  height: 100%;
  background: var(--studio-accent, #4a90d9);
  transition: width 0.3s ease;
}

.bucket-header__progress-text {
  position: absolute;
  right: 0;
  top: -1rem;
  font-size: 0.625rem;
  color: var(--studio-text-muted, #666);
}

.bucket-header__actions {
  display: flex;
  gap: 0.25rem;
}

.bucket-action {
  padding: 0.25rem 0.5rem;
  font-size: 0.6875rem;
  border-radius: 4px;
  cursor: pointer;
  transition: all 0.15s ease;
  min-height: 28px;
}

.bucket-action--stage {
  background: #e8f5e9;
  border: 1px solid #a5d6a7;
  color: #2e7d32;
}

.bucket-action--stage:hover {
  background: #c8e6c9;
}

.bucket-action--commit {
  background: var(--studio-accent, #4a90d9);
  border: 1px solid var(--studio-accent, #4a90d9);
  color: white;
}

.bucket-action--commit:hover {
  background: #3a80c9;
}

.bucket-action--discard {
  background: transparent;
  border: 1px solid var(--studio-border, #e5e2dc);
  color: var(--studio-text-muted, #666);
}

.bucket-action--discard:hover {
  border-color: #dc3545;
  color: #dc3545;
}

/* Bucket content */
.harvest-bucket__content {
  border-top: 1px solid var(--studio-border, #e5e2dc);
}

.harvest-bucket__tabs {
  display: flex;
  border-bottom: 1px solid var(--studio-border, #e5e2dc);
}

.harvest-tab {
  flex: 1;
  padding: 0.5rem;
  font-size: 0.6875rem;
  background: none;
  border: none;
  cursor: pointer;
  color: var(--studio-text-muted, #666);
  transition: all 0.15s ease;
}

.harvest-tab:hover {
  background: var(--studio-bg-secondary, #f8f5f1);
}

.harvest-tab--active {
  color: var(--studio-accent, #4a90d9);
  border-bottom: 2px solid var(--studio-accent, #4a90d9);
  margin-bottom: -1px;
}

.harvest-bucket__passages {
  max-height: 300px;
  overflow-y: auto;
  padding: 0.5rem;
}

.harvest-empty {
  text-align: center;
  padding: 1rem;
  color: var(--studio-text-muted, #666);
  font-size: 0.75rem;
}

/* Passage card */
.harvest-card {
  display: flex;
  align-items: flex-start;
  gap: 0.5rem;
  padding: 0.5rem;
  margin-bottom: 0.5rem;
  border: 1px solid var(--studio-border, #e5e2dc);
  border-radius: 4px;
  background: var(--studio-bg-primary, #fff);
  cursor: pointer;
  transition: border-color 0.15s ease, box-shadow 0.15s ease;
}

.harvest-card:hover {
  border-color: var(--studio-accent, #4a90d9);
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
}

.harvest-card--gem {
  border-left: 3px solid #7b1fa2;
  background: #faf5fc;
}

.harvest-card--approved {
  border-left: 3px solid #388e3c;
  background: #f6fbf6;
}

.harvest-card--rejected {
  border-left: 3px solid #dc3545;
  background: #fdf6f6;
  opacity: 0.7;
}

.harvest-card__content {
  flex: 1;
  min-width: 0;
}

.harvest-card__source {
  font-size: 0.625rem;
  color: var(--studio-text-muted, #666);
  margin-bottom: 0.25rem;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.harvest-card__text {
  font-size: 0.75rem;
  line-height: 1.4;
  color: var(--studio-text-primary, #1a1a1a);
}

.harvest-card__meta {
  font-size: 0.625rem;
  color: var(--studio-text-muted, #666);
  margin-top: 0.25rem;
}

.harvest-card__actions {
  display: flex;
  flex-direction: column;
  gap: 0.25rem;
}

.harvest-btn {
  width: 32px;
  height: 32px;
  min-height: 32px;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 4px;
  border: 1px solid var(--studio-border, #e5e2dc);
  background: var(--studio-bg-primary, #fff);
  cursor: pointer;
  font-size: 0.875rem;
  transition: all 0.15s ease;
}

.harvest-btn:hover {
  transform: scale(1.05);
}

.harvest-btn--gem:hover {
  border-color: #7b1fa2;
  background: #faf5fc;
}

.harvest-btn--approve:hover {
  border-color: #388e3c;
  background: #e8f5e9;
}

.harvest-btn--reject:hover {
  border-color: #dc3545;
  background: #ffebee;
}

.harvest-btn--undo:hover {
  border-color: var(--studio-accent, #4a90d9);
  background: #e3f2fd;
}
